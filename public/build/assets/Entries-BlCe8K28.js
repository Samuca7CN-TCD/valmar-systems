import{m as Z,k as M,r as U,c as C,o as r,w,e as _,b as h,n as j,f as F,t as u,a as e,h as K,d as c,s as f,u as l,v as q,F as L,g as B,x as G,T as W,Z as X,z as Y}from"./app-nxAEGYom.js";import{a as ee,b as te,_ as se}from"./AppLayout-CD0ic9x9.js";import{_ as oe}from"./CreateUpdateModal-Cr9-t6ta.js";import{_ as ae}from"./PrimaryButton-DeVtbJBJ.js";import{_ as ne}from"./SecondaryButton-BQZMIPc2.js";import{f as Q,t as P}from"./general-D_37hS-e.js";import{_ as re}from"./SelectSearchService-RkxmkWxh.js";import{_ as ie,r as le}from"./SelectSearchItem-IJP0EuTf.js";/* empty css                    */import{r as de}from"./PlusIcon-C0zORJhm.js";import{r as ce}from"./PencilIcon-BWmfVFjA.js";import{r as me}from"./BanknotesIcon-BbnfpIH-.js";import{r as H}from"./EyeIcon-DwYvHqED.js";import{_ as ue}from"./FloatButton-SJT_ARUZ.js";import{r as pe}from"./MagnifyingGlassIcon-DL4qMqmq.js";import{r as _e}from"./XMarkIcon-B7I7P2AW.js";import"./Modal-BAbBhbNO.js";import"./PrinterIcon-CEXel4vh.js";const ye={class:"pb-12 space-y-12 divide-y-2"},he={class:"py-4"},ve=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Informações Básicas",-1),xe=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Informações sobre a entrada como nome do funcionário, data da entrada e observações",-1),fe={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"},be={class:"sm:col-span-6"},ge=e("label",{for:"entry-date",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Data do Entrada",-1),we={class:"mt-2"},$e=["max","disabled"],ke={key:0,class:"text-red-500 text-sm"},Ce={class:"sm:col-span-6"},qe=e("label",{for:"entry-motive",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Motivo",-1),Ee={class:"mt-2"},Ve=["disabled"],Se={key:2,class:"text-red-500 text-sm"},Ie={class:"sm:col-span-6"},Me=e("label",{for:"entry-observations",class:"block text-sm font-medium leading-6 text-gray-900"},"Observações",-1),Ue={class:"mt-2"},De=["disabled"],Ae={key:0,class:"text-red-500 text-sm"},Le={key:0,class:"py-4"},Oe=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Lista de Itens",-1),Te=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Adicione os itens do entrada.",-1),je={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-4"},Fe={key:0,class:"sm:col-span-4"},Be=e("label",{for:"item-selecter",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Selecione os itens de entrada",-1),Ne={class:"mt-2"},ze={class:"sm:col-span-4"},Re={key:0,class:"min-w-full text-left text-sm font-medium leading-6 text-gray-900"},Qe={class:"border-b font-medium"},We=e("th",{scope:"col",class:"px-6 py-4 text-center"},"#",-1),Pe=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Item",-1),Ze=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Qtd. Estoque",-1),Ge=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Qtd. Entrada",-1),He=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Und. Medida",-1),Je=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Funcionário",-1),Ke={key:0,scope:"col",class:"px-6 py-4 text-center"},Xe={class:"whitespace-nowrap py-4 text-center font-medium"},Ye={class:"whitespace-nowrap py-4 text-center font-medium"},et={class:"whitespace-nowrap py-4 text-center font-medium"},tt={class:"whitespace-nowrap py-4 text-center font-medium flex justify-center"},st=["value","onInput","disabled"],ot={class:"whitespace-nowrap py-4 text-center font-medium"},at={class:"whitespace-nowrap py-4 text-center font-medium"},nt=["disabled","onUpdate:modelValue"],rt=["value"],it={key:0,class:"whitespace-nowrap py-4 text-center font-mono text-2xl"},lt=["onClick","title"],dt={key:1,class:"p-5 bg-gray-200 rounded-md block text-sm font-medium leading-6 text-gray-900"},ct={__name:"CreateUpdateEntriesModal",props:{modal:Object,entry:{type:Object,default:null},items:Array,employees_list:Array,services_list:Array},emits:["close","submit"],setup(t,{emit:x}){var n;const D=x,o=t,$=Z.useToast(),p=/^\d{4}-\d{2}-\d{2}$/,E=M(()=>{const{motive:a,date:i}=o.entry;return!a||!a.length?!1:i&&p.test(i)}),A=M(()=>{const{employee:a,motive:i,date:s,items_list:m}=o.entry;return!i||!i.length||!s||!p.test(s)||!m||m.length<1?!1:m.every(I=>I.movement_quantity>0&&I.employee_id>0)}),v=M(()=>o.modal.mode==="see"),g=U(""),O=U(!1);M(()=>o.items.filter(a=>a.name.toLowerCase().includes(g.value.toLowerCase())));const b=()=>{o.entry.estimated_value=o.entry.items_list.reduce((a,i)=>a+i.price*i.movement_quantity,0),o.entry.total_value=o.entry.estimated_value},V=U(o.employees_list?(n=o.employees_list[0])==null?void 0:n.id:null),S=a=>{var s;const i={order_id:(((s=o.entry.items_list[o.entry.items_list.length-1])==null?void 0:s.order_id)??0)+1,id:a.id,name:a.name,quantity:a.quantity,max_quantity:a.max_quantity,min_quantity:a.min_quantity,movement_quantity:1,measurement_unit:a.measurement_unit.abbreviation,price:a.price,amount:a.price,employee_id:V.value};o.entry.items_list.push(i),g.value="",O.value=!1,b()},N=async(a,i)=>{if(i.preventDefault(),o.modal.mode==="see"){if(!confirm("Você tem certeza que deseja deletar esse item? Esta ação não poderá ser desfeita!"))return;try{const s=await axios.post(route("entries.delete_item"),{entry_id:o.entry.id,item_id:a});o.entry.items_list=o.entry.items_list.filter(m=>m.id!==a),b(),$.success("Item deletado da entrada com sucesso")}catch(s){console.error("Erro ao deletar o item:",s.message),$.error(`Erro ao deletar o item: ${s.message}`)}}else o.entry.items_list=o.entry.items_list.filter(s=>s.order_id!==a),b()},z=a=>{o.entry.motive=a},R=a=>{S(a)},y=()=>{var a;V.value=o.employees_list?(a=o.employees_list[0])==null?void 0:a.id:null,D("close")},d=()=>{var a;V.value=o.employees_list?(a=o.employees_list[0])==null?void 0:a.id:null,D("submit")};return(a,i)=>(r(),C(oe,{show:t.modal.show,maxWidth:E.value||v.value?"3xl":"2xl",onClose:y},{icon:w(()=>[e("div",{class:j(["mx-auto shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-400 sm:mx-0 sm:h-10 sm:w-10",{"bg-yellow-400":t.modal.mode==="update","bg-green-400":t.modal.mode==="pay","bg-gray-400":t.modal.mode==="see"}])},[t.modal.mode==="create"?(r(),C(l(de),{key:0,class:"w-5 h-5 text-white"})):_("",!0),t.modal.mode==="update"?(r(),C(l(ce),{key:1,class:"w-5 h-5 text-white"})):_("",!0),t.modal.mode==="pay"?(r(),C(l(me),{key:2,class:"w-5 h-5 text-white"})):_("",!0),t.modal.mode==="see"?(r(),C(l(H),{key:3,class:"w-5 h-5 text-white"})):_("",!0)],2)]),title:w(()=>[F(u(t.modal.title),1)]),content:w(()=>[e("form",{onSubmit:K(d,["prevent"])},[e("div",ye,[e("section",he,[ve,xe,e("div",fe,[e("div",be,[ge,e("div",we,[f(e("input",{type:"date",name:"entry-date",id:"entry-date",autocomplete:"on",class:"simple-input disabled:bg-gray-200",autofocus:"true",placeholder:"Data do Entrada",max:l(Q)(),disabled:v.value,"onUpdate:modelValue":i[0]||(i[0]=s=>t.entry.date=s),required:""},null,8,$e),[[q,t.entry.date]]),t.entry.errors.date?(r(),c("p",ke,u(t.entry.errors.date),1)):_("",!0)])]),e("div",Ce,[qe,e("div",Ee,[v.value?f((r(),c("input",{key:0,type:"text",name:"entry-motive",id:"entry-motive",autocomplete:"on",class:"simple-input disabled:bg-gray-200",disabled:v.value,placeholder:"Motivo do Entrada","onUpdate:modelValue":i[1]||(i[1]=s=>t.entry.motive=s),required:""},null,8,Ve)),[[q,t.entry.motive]]):(r(),C(re,{key:1,options:t.services_list,"onUpdate:modelValue":z},null,8,["options"])),t.entry.errors.motive?(r(),c("p",Se,u(t.entry.errors.motive),1)):_("",!0)])]),e("div",Ie,[Me,e("div",Ue,[f(e("textarea",{type:"text",observations:"entry-observations",id:"entry-observations",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Descreva a título mais detalhadamente ou insira informações adicionais",disabled:v.value,"onUpdate:modelValue":i[2]||(i[2]=s=>t.entry.observations=s)},null,8,De),[[q,t.entry.observations]]),t.entry.errors.observations?(r(),c("p",Ae,u(t.entry.errors.observations),1)):_("",!0)])])])]),E.value||v.value?(r(),c("section",Le,[Oe,Te,e("div",je,[v.value?_("",!0):(r(),c("div",Fe,[Be,e("div",Ne,[h(ie,{options:t.items,"onUpdate:modelValue":R},null,8,["options"])])])),e("div",ze,[t.entry.items_list.length?(r(),c("table",Re,[e("thead",Qe,[e("tr",null,[We,Pe,Ze,Ge,He,Je,v.value?_("",!0):(r(),c("th",Ke," Deletar"))])]),e("tbody",null,[(r(!0),c(L,null,B(o.entry.items_list,s=>(r(),c("tr",{key:s.id,class:j(["border-b transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid",{"opaciti-50":s.deleted_at}])},[e("td",Xe,u(s.id),1),e("td",Ye,u(s.name),1),e("td",et,u(s.quantity),1),e("td",tt,[e("input",{type:"number",min:"0.01",step:"0.01",value:s.movement_quantity,onInput:m=>{s.movement_quantity=parseFloat(m.target.value),s.amount=s.price*m.target.value,b()},class:"simple-input disabled:bg-gray-200 w-2/3",disabled:t.modal.mode!=="create"},null,40,st)]),e("td",ot,u(s.measurement_unit),1),e("td",at,[f(e("select",{class:"simple-select disabled:bg-gray-200",disabled:t.modal.mode!=="create","onUpdate:modelValue":m=>s.employee_id=m,onChange:i[3]||(i[3]=m=>V.value=m.target.value),required:""},[(r(!0),c(L,null,B(t.employees_list,m=>(r(),c("option",{key:m.id,value:m.id},u(m.name)+" "+u(m.surname),9,rt))),128))],40,nt),[[G,s.employee_id]])]),v.value?_("",!0):(r(),c("td",it,[e("button",{onClick:m=>N(t.modal.mode==="see"?s.id:s.order_id,m),type:"button",title:"Remover "+s.name},"×",8,lt)]))],2))),128))])])):(r(),c("p",dt," Nenhum item selecionado até o momento!"))])])])):_("",!0)])],32)]),footer:w(()=>[t.modal.mode!=="see"?(r(),C(ne,{key:0,class:j({disabled:t.entry.processing}),onClick:i[4]||(i[4]=s=>y())},{default:w(()=>[F(" Cancelar ")]),_:1},8,["class"])):_("",!0),h(ae,{class:j({disabled:t.entry.processing||!A.value}),disabled:t.entry.processing||!A.value,onClick:i[5]||(i[5]=s=>d())},{default:w(()=>[F(u(t.modal.primary_button_txt),1)]),_:1},8,["class","disabled"])]),_:1},8,["show","maxWidth"]))}},mt={class:"font-semibold text-xl text-gray-800 leading-tight"},ut={class:"pt-12 print:hidden print:pt-0"},pt={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 print:w-full"},_t={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-5"},yt={class:"flex flex-row items-center space-x-3"},ht={class:"cursor-help select-none",title:"O campo de pesquisa ao lado filtra as informações carregadas na pagina. O formulário de pesquisa abaixo busca as informações filtradas no banco de dados e lista na página."},vt={class:"mt-3 grid grid-cols-4 gap-2"},xt={class:"col-span-4 md:col-span-1"},ft=e("label",{for:"search-by-employee",class:"block text-sm font-medium leading-6 text-gray-900"},"Funcionário",-1),bt={class:"mt-2"},gt=e("option",{value:0},"Todos",-1),wt=["value"],$t={key:0,class:"text-red-500 text-sm"},kt={class:"col-span-4 md:col-span-1"},Ct=e("label",{for:"search-by-motive",class:"block text-sm font-medium leading-6 text-gray-900"},"Motivo",-1),qt={class:"mt-2"},Et={key:0,class:"text-red-500 text-sm"},Vt={class:"col-span-2 md:col-span-1"},St=e("label",{for:"search-by-start-date",class:"block text-sm font-medium leading-6 text-gray-900"},"Data (início)",-1),It={class:"mt-2"},Mt={key:0,class:"text-red-500 text-sm"},Ut={class:"col-span-2 md:col-span-1"},Dt=e("label",{for:"search-by-end-date",class:"block text-sm font-medium leading-6 text-gray-900"},"Data (fim)",-1),At={class:"mt-2"},Lt={key:0,class:"text-red-500 text-sm"},Ot=["href"],Tt={class:"py-12 print:py-0"},jt={class:"max-w-7xl mx-auto print:max-w-full"},Ft={class:"px-0 print:px-0"},Bt={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg print:shadow-none"},Nt={class:"flex flex-col"},zt={class:"overflow-x-auto sm:-mx-6 lg:-mx-8"},Rt={class:"inline-block min-w-full py-2 sm:px-6 lg:px-8"},Qt={class:"overflow-hidden"},Wt={class:"min-w-full text-left text-sm font-light"},Pt=e("thead",{class:"border-b font-medium"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-4 text-center"},"#"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Motivo"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Data do Entrada "),e("th",{scope:"col",class:"px-6 py-4 text-center print:hidden",colspan:"2"}," Ações")])],-1),Zt={class:"border-b transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid"},Gt={class:"whitespace-nowrap py-4 text-center font-medium"},Ht={class:"whitespace-nowrap px-2 py-4 text-center"},Jt=["title"],Kt={class:"whitespace-nowrap px-2 py-4 text-center"},Xt=["onClick"],Yt=["onClick"],es={key:1,class:"transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid"},ts=e("td",{class:"whitespace-nowrap px-6 py-4 text-center",colspan:"9"},"Não há entradas cadastradas no momento!",-1),ss=[ts],gs={__name:"Entries",props:{page:Object,page_options:{type:Array,default:null},entries_list:Object,employees_list:Array,items:Object,parameters:Object,services_list:Array},setup(t){const x=t,D=Z.useToast(),o=W({id:null,employee:"",motive:"",date:Q(),total_value:0,observations:"",items_list:[]}),$=U(!x.parameters.default),p=W({employee_id:x.parameters.employee_id,motive:x.parameters.motive,start_date:x.parameters.start_date,end_date:x.parameters.end_date}),E=U(""),A=M(()=>{const y=E.value.toLowerCase();return x.entries_list.filter(d=>{const{id:n,entity_name:a,motive:i,observations:s,date:m,items:T}=d,I=[n.toString(),(a==null?void 0:a.toLowerCase())??"",(i==null?void 0:i.toLowerCase())??"",(s==null?void 0:s.toLowerCase())??"",(m==null?void 0:m.toLowerCase())??""];for(let k of I)if(k.includes(y))return!0;return T.some(k=>k.name.toLowerCase().includes(y))})}),v=M(()=>x.entries_list.reduce((y,d)=>y+d.accounting.partial_value,0)),g=U({mode:"create",show:!1,get title(){switch(this.mode){case"create":return"Criar entrada";case"update":return"Editar entrada";case"see":return"Ver informações da entrada"}},get primary_button_txt(){switch(this.mode){case"create":return"Cadastrar";case"update":return"Atualizar";case"see":return"Fechar"}}}),O=(y,d=null)=>{const n=["update","see"].includes(y);if(d!==null&&n){const a=x.entries_list.find(i=>i.id===d);if(a){const{id:i,entity_name:s,date:m,motive:T,observations:I,accounting:k,items:J}=a;o.id=i,o.employee=s,o.motive=T,o.date=m,o.estimated_value=k.estimated_value,o.total_value=k.total_value,o.partial_value=k.partial_value,o.observations=I,o.items_list=J}}g.value.mode=y,g.value.show=!0},b=()=>{o.reset(),g.value.show=!1},V=()=>{o.post(route("entries.store"),{preserveScroll:!0,onSuccess:()=>b(),onError:y=>{console.log(y)}})},S=()=>{p.post(route("entries.filter"),{preserveScroll:!0})},N=()=>{o.put(route("entries.update",o.id),{preserveScroll:!0,onSuccess:()=>b()})},z=(y,d)=>{confirm(`Você tem certeza que deseja excluir a entrada de material para "${d}"? Todos os materiais comprados voltarão para o estoque! Esta ação não poderá ser desfeita!`)&&o.delete(route("entries.destroy",y),{preserveScroll:!0,onSuccess:()=>D.success("Entrada deletado com sucesso!")})},R=()=>{switch(g.value.mode){case"create":return V();case"update":return N();case"see":return b();default:D.error("Método desconhecido. Informar o Técnico.")}};return(y,d)=>(r(),c(L,null,[h(l(X),{title:t.page.name},null,8,["title"]),h(se,{page:t.page,page_options:t.page_options},{header:w(()=>[e("h2",mt,u(t.page.name)+" | "+u(l(P)(v.value)),1),h(ue,{icon:"plus",onClick:d[0]||(d[0]=n=>O("create")),title:"Cadastrar Entry",class:"print:hidden"})]),default:w(()=>[e("div",ut,[e("div",pt,[e("div",_t,[e("div",yt,[h(l(pe),{class:"w-5 y-5"}),f(e("input",{type:"text",name:"search_term",id:"search_term",autocomplete:"on",class:"simple-input",autofocus:"true",placeholder:"Pesquisar termo...","onUpdate:modelValue":d[1]||(d[1]=n=>E.value=n)},null,512),[[q,E.value]]),e("span",ht,[h(l(le),{class:"w-5 h-5"})]),$.value?(r(),c("span",{key:1,class:"select-none cursor-pointer",title:"Fechar opções de filtro",onClick:d[3]||(d[3]=n=>$.value=!1)},[h(l(te),{class:"w-5 y-5"})])):(r(),c("span",{key:0,class:"select-none cursor-pointer",title:"Abrir opções de filtro",onClick:d[2]||(d[2]=n=>$.value=!0)},[h(l(ee),{class:"w-5 y-5"})]))]),f(e("div",vt,[e("div",xt,[ft,e("div",bt,[f(e("select",{name:"search-by-employee",id:"search-by-employee",class:"simple-select disabled:bg-gray-200","onUpdate:modelValue":d[4]||(d[4]=n=>l(p).employee_id=n),onChange:S},[gt,(r(!0),c(L,null,B(t.employees_list,n=>(r(),c("option",{key:n.id,value:n.id},u(n.name)+" "+u(n.surname),9,wt))),128))],544),[[G,l(p).employee_id]]),l(p).errors.employee_id?(r(),c("p",$t,u(l(p).errors.employee_id),1)):_("",!0)])]),e("div",kt,[Ct,e("div",qt,[f(e("input",{type:"text",name:"search-by-motive",id:"search-by-motive",class:"simple-input disabled:bg-gray-200",placeholder:"Filtrar por motivo","onUpdate:modelValue":d[5]||(d[5]=n=>l(p).motive=n),onInput:S,required:""},null,544),[[q,l(p).motive]]),l(p).errors.motive?(r(),c("p",Et,u(l(p).errors.motive),1)):_("",!0)])]),e("div",Vt,[St,e("div",It,[f(e("input",{type:"date",name:"search-by-start-date",id:"search-by-start-date",class:"simple-input disabled:bg-gray-200",placeholder:"Filtrar por período (início)","onUpdate:modelValue":d[6]||(d[6]=n=>l(p).start_date=n),onInput:S,required:""},null,544),[[q,l(p).start_date]]),l(p).errors.start_date?(r(),c("p",Mt,u(l(p).errors.start_date),1)):_("",!0)])]),e("div",Ut,[Dt,e("div",At,[f(e("input",{type:"date",name:"search-by-end-date",id:"search-by-end-date",class:"simple-input disabled:bg-gray-200",placeholder:"Filtrar por período (fim)","onUpdate:modelValue":d[7]||(d[7]=n=>l(p).end_date=n),onInput:S,required:""},null,544),[[q,l(p).end_date]]),l(p).errors.end_date?(r(),c("p",Lt,u(l(p).errors.end_date),1)):_("",!0)])]),e("a",{href:y.route("entries.index"),class:"text-red-500 hover:text-red-700 active:text-red-900 text-sm select-none mt-2",onClick:d[8]||(d[8]=n=>l(p).reset())},"Resetar busca",8,Ot)],512),[[Y,$.value]])])])]),e("div",Tt,[e("div",jt,[e("div",Ft,[e("div",Bt,[e("div",Nt,[e("div",zt,[e("div",Rt,[e("div",Qt,[e("table",Wt,[Pt,e("tbody",null,[A.value.length?(r(!0),c(L,{key:0},B(A.value,n=>(r(),c("tr",Zt,[e("td",Gt,u(n.id),1),e("td",Ht,[F(u(l(P)(n.motive))+" ",1),n.observations?(r(),c("span",{key:0,title:n.observations,class:"inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10 cursor-help"},"OBS",8,Jt)):_("",!0)]),e("td",Kt,u(l(Q)(n.date,!0)),1),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-indigo-700 active:text-indigo-900 select-none print:hidden",title:"Ver Entrada",onClick:a=>O("see",n.id)},[h(l(H),{class:"w-5 h-5 m-auto"})],8,Xt),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-red-700 active:text-red-900 select-none print:hidden",title:"Excluir entrada",onClick:a=>z(n.id,n.motive)},[h(l(_e),{class:"w-5 h-5 m-auto"})],8,Yt)]))),256)):(r(),c("tr",es,ss))])])])])])])])])])]),h(ct,{modal:g.value,entry:l(o),items:t.items,employees_list:t.employees_list,services_list:t.services_list,onSubmit:R,onClose:b},null,8,["modal","entry","items","employees_list","services_list"])]),_:1},8,["page","page_options"])],64))}};export{gs as default};
