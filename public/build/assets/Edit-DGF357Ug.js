import{m as L,T as q,k as E,r as D,p as B,q as $,d as l,o as n,b as g,u as e,Z as j,w as h,a as t,h as z,e as _,f as p,i as w,t as r,s as m,v as b,F as A,g as V,x as G,y as I}from"./app-CvAlCVsm.js";import{_ as Z}from"./AppLayout-PcgpBm_n.js";import{a as J,b as X,c as H,d as K,t as S}from"./general-D_37hS-e.js";/* empty css                    */import{_ as Q}from"./ClientSelector-D2BBdkmY.js";import{_ as W}from"./PrimaryButton-CMcNbFER.js";import{r as Y}from"./TrashIcon-CGRZQwyk.js";import{r as tt}from"./PlusIcon-Egh1AfEM.js";import"./lodash-BFq6OCGj.js";const et={class:"font-semibold text-xl text-gray-800 leading-tight"},st={class:"py-12"},ot={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},it={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg"},dt={key:0,class:"bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-6",role:"alert"},at=t("p",{class:"font-bold"},"Modo Somente Leitura",-1),lt={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 text-sm items-end"},nt={class:"block text-sm font-medium text-gray-700"},rt={key:0,class:"mt-1 font-semibold text-gray-900"},ct=t("label",{for:"budget_date",class:"block text-sm font-medium text-gray-700"},"EMITIDO EM:",-1),ut=t("label",{for:"validity",class:"block text-sm font-medium text-gray-700"},"VALIDADE (em dias)",-1),mt=["disabled"],_t={class:"mb-8"},bt=t("h3",{class:"text-lg font-semibold text-gray-900 border-b pb-2 mb-4"},"DADOS DO CLIENTE",-1),pt={class:"grid grid-cols-1 gap-6"},gt={class:"sm:col-span-1"},xt=t("label",{for:"client-selector",class:"block text-sm font-medium text-gray-700 required-input-label"},"Cliente Selecionado",-1),yt={key:0,class:"mt-4 text-center text-sm text-gray-500"},ht={key:1,class:"mt-4 p-4 border rounded-lg bg-gray-50 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm"},vt={class:"font-medium text-gray-700"},ft=t("span",{class:"font-semibold block text-gray-500"},"Nome:",-1),kt={class:"font-medium text-gray-700"},Ot={class:"font-semibold block text-gray-500"},Et={class:"font-medium text-gray-700"},At=t("span",{class:"font-semibold block text-gray-500"},"E-mail:",-1),Ct={class:"font-medium text-gray-700"},Nt=t("span",{class:"font-semibold block text-gray-500"},"CEP:",-1),Tt={class:"font-medium text-gray-700"},Dt=t("span",{class:"font-semibold block text-gray-500"},"Endereço:",-1),wt={class:"font-medium text-gray-700"},Vt=t("span",{class:"font-semibold block text-gray-500"},"Contatos:",-1),It={key:1},St={class:"lg:col-start-3 text-right"},Rt={class:"mb-8"},Ut=t("h3",{class:"text-lg font-semibold text-gray-900 border-b pb-2 mb-4"},"DADOS DO TÍTULO",-1),Ft=t("label",{for:"title",class:"block text-sm font-medium text-gray-700"},"TÍTULO IDENTIFICADOR DO SERVIÇO",-1),Mt=["disabled"],Pt={key:0,class:"text-red-500 text-xs mt-1"},Lt={class:"mb-8"},qt=t("h3",{class:"text-lg font-semibold text-gray-900 border-b pb-2 mb-4"},"ITENS DO ORÇAMENTO",-1),Bt={class:"space-y-4"},$t=["onClick","disabled"],jt={class:"grid grid-cols-1 md:grid-cols-12 gap-4"},zt={class:"md:col-span-10"},Gt=t("label",{class:"block text-sm font-medium text-gray-700"},"DESCRIÇÃO",-1),Zt=["onUpdate:modelValue","disabled"],Jt={class:"md:col-span-2"},Xt=t("label",{class:"block text-sm font-medium text-gray-700"},"VALOR (R$)",-1),Ht=["onUpdate:modelValue","onInput","disabled"],Kt=["disabled"],Qt={class:"mb-8 p-4 bg-gray-50 rounded-lg"},Wt=t("h3",{class:"text-lg font-semibold text-gray-900 border-b pb-2 mb-4"},"TOTAIS",-1),Yt={class:"grid grid-cols-2 gap-4 items-center"},te=t("label",{for:"discount_amount",class:"block text-sm font-medium text-gray-700"},"DESCONTO (R$)",-1),ee=["disabled"],se=t("label",{for:"additional_amount",class:"block text-sm font-medium text-gray-700"},"ACRÉSCIMO (R$)",-1),oe=["disabled"],ie={class:"text-lg font-semibold text-gray-900"},de={class:"text-lg font-bold text-gray-900 text-right"},ae={class:"mb-8"},le=t("h3",{class:"text-lg font-semibold text-gray-900 border-b pb-2 mb-4"},"RESPONSABILIDADES",-1),ne={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},re=t("label",{for:"contracted_responsibility",class:"block text-sm font-medium text-gray-700"},"DA CONTRATADA",-1),ce=["disabled"],ue={key:0,class:"text-red-500 text-xs mt-1"},me=t("label",{for:"contractor_responsibility",class:"block text-sm font-medium text-gray-700"},"DO CONTRATANTE",-1),_e=["disabled"],be={key:0,class:"text-red-500 text-xs mt-1"},pe={class:"mb-8"},ge=t("h3",{class:"text-lg font-semibold text-gray-900 border-b pb-2 mb-4"},"OUTRAS INFORMAÇÕES",-1),xe={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ye=t("h4",{class:"text-md font-semibold text-gray-800 mb-2"},"DO SERVIÇO",-1),he={class:"mb-4"},ve=t("label",{for:"description",class:"block text-sm font-medium text-gray-700"},"OBSERVAÇÕES",-1),fe=["disabled"],ke={key:0,class:"text-red-500 text-xs mt-1"},Oe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ee=t("label",{for:"deadline",class:"block text-sm font-medium text-gray-700"},"PRAZO (em dias)",-1),Ae=["disabled"],Ce={key:0,class:"text-red-500 text-xs mt-1"},Ne=t("label",{for:"deadline_type",class:"block text-sm font-medium text-gray-700"},"TIPO DE PRAZO",-1),Te=["disabled"],De=t("option",{value:"dias úteis"},"Dias Úteis",-1),we=t("option",{value:"dias corridos"},"Dias Corridos",-1),Ve=[De,we],Ie={key:0,class:"text-red-500 text-xs mt-1"},Se={class:"mt-4"},Re=t("label",{for:"deadline_start_description",class:"block text-sm font-medium text-gray-700"},"INÍCIO DO PRAZO",-1),Ue=["disabled"],Fe={key:0,class:"text-red-500 text-xs mt-1"},Me=t("h4",{class:"text-md font-semibold text-gray-800 mb-2"},"DO PAGAMENTO",-1),Pe={class:"mb-4"},Le=t("label",{for:"payment_method_description",class:"block text-sm font-medium text-gray-700"},"FORMA DE PAGAMENTO",-1),qe=["disabled"],Be={key:0,class:"text-red-500 text-xs mt-1"},$e=t("label",{for:"bank_info_description",class:"block text-sm font-medium text-gray-700"},"INFORMAÇÕES BANCÁRIAS",-1),je=["disabled"],ze={key:0,class:"text-red-500 text-xs mt-1"},Ge={class:"flex justify-end space-x-4 mt-8 border-t pt-5"},es={__name:"Edit",props:{page:Object,budget:Object},setup(x){var T;const a=x,k=L.useToast(),s=q({client_id:a.budget.client_id,title:a.budget.title,validity:a.budget.validity,description:a.budget.description,budget_date:(T=a.budget.budget_date)==null?void 0:T.split("T")[0],deadline:a.budget.deadline,deadline_type:a.budget.deadline_type,deadline_start_description:a.budget.deadline_start_description,items:a.budget.items.map(d=>({id:d.id,item_name:d.item_name,item_description:d.item_description,quantity:d.quantity,unit_price:d.unit_price,subtotal:d.subtotal})),discount_amount:a.budget.discount_amount,additional_amount:a.budget.additional_amount,total_value:a.budget.total_value,contracted_responsibility:a.budget.contracted_responsibility,contractor_responsibility:a.budget.contractor_responsibility,payment_method_description:a.budget.payment_method_description,bank_info_description:a.budget.bank_info_description,budget_type:a.budget.budget_type,original_budget_id:a.budget.original_budget_id}),c=E(()=>{const d=["Rascunho","Enviado"].includes(a.budget.status),o=a.budget.generated_service_id===null;return d&&o}),u=D(null),O=D(!1);B(()=>s.client_id,async d=>{if(d){O.value=!0,u.value=null;try{const o=await $.get(route("clients.show",{client:d}),{headers:{Accept:"application/json"}});u.value=o.data.client}catch(o){console.error("Erro ao buscar dados do cliente:",o),k.error("Não foi possível carregar os dados do cliente.",{position:"top-right"})}finally{O.value=!1}}else u.value=null},{immediate:!0});const R=()=>{s.items.push({id:null,item_name:"",item_description:"",quantity:1,unit_price:0,subtotal:0})},U=d=>{s.items.length>1&&s.items.splice(d,1)},F=d=>{d.subtotal=(d.quantity||0)*(d.unit_price||0)},C=E(()=>s.items.reduce((d,o)=>d+(o.subtotal||0),0)),N=E(()=>{const d=parseFloat(C.value),o=parseFloat(s.discount_amount)||0,v=parseFloat(s.additional_amount)||0;return Math.max(0,d-o+v)}),M=()=>{s.total_value=N.value,s.put(route("budgets.update",a.budget.id),{onSuccess:()=>{k.success("Orçamento atualizado com sucesso!",{position:"top-right"}),I.visit(route("budgets.index"))},onError:d=>{console.error("Erro ao atualizar orçamento:",d),k.error("Erro ao atualizar orçamento. Verifique os campos.",{position:"top-right"})}})},P=()=>{confirm("Tem certeza que deseja cancelar? Todas as alterações não salvas serão perdidas.")&&I.visit(route("budgets.index"))};return(d,o)=>(n(),l(A,null,[g(e(j),{title:x.page.name},null,8,["title"]),g(Z,{page:x.page},{header:h(()=>[t("h2",et," Edição de Orçamento #"+r(x.budget.id),1)]),default:h(()=>{var v;return[t("div",st,[t("div",ot,[t("div",it,[t("form",{onSubmit:z(M,["prevent"]),class:"p-6"},[c.value?_("",!0):(n(),l("div",dt,[at,t("p",null,[p("Este orçamento não pode mais ser editado. Para fazer alterações, você pode "),g(e(w),{href:d.route("budgets.create",{duplicate_from:x.budget.id}),class:"font-semibold underline"},{default:h(()=>[p("duplicá-lo")]),_:1},8,["href"]),p(" e criar uma nova versão. ")])])),t("div",lt,[t("div",null,[t("label",nt,"ORÇAMENTO Nº: "+r(x.budget.id),1),e(s).budget_type==="Correção"?(n(),l("p",rt," CORREÇÃO")):_("",!0)]),t("div",null,[ct,m(t("input",{type:"date",id:"budget_date","onUpdate:modelValue":o[0]||(o[0]=i=>e(s).budget_date=i),class:"simple-input mt-1",disabled:""},null,512),[[b,e(s).budget_date]])]),t("div",null,[ut,m(t("input",{type:"number",id:"validity","onUpdate:modelValue":o[1]||(o[1]=i=>e(s).validity=i),min:"0",class:"simple-input mt-1",disabled:!c.value},null,8,mt),[[b,e(s).validity,void 0,{number:!0}]])])]),t("section",_t,[bt,t("div",pt,[t("div",gt,[xt,g(Q,{modelValue:e(s).client_id,"onUpdate:modelValue":o[2]||(o[2]=i=>e(s).client_id=i),id:"client-selector",class:"mt-1",required:!0,disabled:!c.value},null,8,["modelValue","disabled"])]),O.value?(n(),l("div",yt," Carregando dados do cliente... ")):_("",!0),u.value?(n(),l("div",ht,[t("div",vt,[ft,p(" "+r(u.value.name),1)]),t("div",kt,[t("span",Ot,r(u.value.type==="fisica"?"CPF:":"CNPJ:"),1),p(" "+r(u.value.type==="fisica"?e(J)(u.value.document):e(X)(u.value.document)),1)]),t("div",Et,[At,p(" "+r(u.value.email||"N/A"),1)]),t("div",Ct,[Nt,p(" "+r(e(H)(u.value.postal_code)||"Não informado"),1)]),t("div",Tt,[Dt,p(" "+r(u.value.address_street+", "+u.value.address_number+", "+u.value.address_neighborhood||"Não informado"),1)]),t("div",wt,[Vt,(v=u.value.contacts)!=null&&v.length?(n(!0),l(A,{key:0},V(u.value.contacts,(i,f)=>(n(),l("span",{key:f,class:"px-1"},r(e(K)(i)||"Não informado"),1))),128)):(n(),l("span",It,"Não informado"))]),t("div",St,[g(e(w),{href:d.route("clients.edit",u.value.id),target:"_blank",class:"text-blue-600 hover:underline text-xs"},{default:h(()=>[p(" Editar dados do cliente ")]),_:1},8,["href"])])])):_("",!0)])]),t("section",Rt,[Ut,Ft,m(t("input",{type:"text",id:"title","onUpdate:modelValue":o[3]||(o[3]=i=>e(s).title=i),maxlength:"255",class:"simple-input mt-1",disabled:!c.value,required:""},null,8,Mt),[[b,e(s).title]]),e(s).errors.title?(n(),l("p",Pt,r(e(s).errors.title),1)):_("",!0)]),t("section",Lt,[qt,t("div",Bt,[(n(!0),l(A,null,V(e(s).items,(i,f)=>(n(),l("div",{key:f,class:"p-4 border rounded-lg bg-gray-50 relative"},[e(s).items.length>1?(n(),l("button",{key:0,type:"button",onClick:y=>U(f),class:"absolute top-2 right-2 text-red-500 hover:text-red-700 p-1 rounded-full bg-white",disabled:!c.value},[g(e(Y),{class:"w-5 h-5"})],8,$t)):_("",!0),t("div",jt,[t("div",zt,[Gt,m(t("textarea",{"onUpdate:modelValue":y=>i.item_name=y,rows:"2",class:"simple-input mt-1",required:"",placeholder:"Descrição do item",disabled:!c.value},null,8,Zt),[[b,i.item_name]])]),t("div",Jt,[Xt,m(t("input",{type:"number","onUpdate:modelValue":y=>i.unit_price=y,onInput:y=>F(i),step:"0.01",min:"0",class:"simple-input mt-1",required:"",disabled:!c.value},null,40,Ht),[[b,i.unit_price,void 0,{number:!0}]])])])]))),128))]),t("button",{type:"button",onClick:R,class:"mt-4 px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 flex items-center text-sm",disabled:!c.value},[g(e(tt),{class:"w-5 h-5 mr-1"}),p(" Adicionar Item ")],8,Kt)]),t("section",Qt,[Wt,t("div",Yt,[t("div",null,[te,m(t("input",{type:"number",id:"discount_amount","onUpdate:modelValue":o[4]||(o[4]=i=>e(s).discount_amount=i),step:"0.01",min:"0",class:"simple-input mt-1",disabled:!c.value},null,8,ee),[[b,e(s).discount_amount,void 0,{number:!0}]])]),t("div",null,[se,m(t("input",{type:"number",id:"additional_amount","onUpdate:modelValue":o[5]||(o[5]=i=>e(s).additional_amount=i),step:"0.01",min:"0",class:"simple-input mt-1",disabled:!c.value},null,8,oe),[[b,e(s).additional_amount,void 0,{number:!0}]])]),t("div",ie,"SUBTOTAL: "+r(e(S)(C.value)),1),t("div",de,"TOTAL FINAL: "+r(e(S)(N.value)),1)])]),t("section",ae,[le,t("div",ne,[t("div",null,[re,m(t("textarea",{id:"contracted_responsibility","onUpdate:modelValue":o[6]||(o[6]=i=>e(s).contracted_responsibility=i),rows:"4",class:"mt-1 block w-full simple-input",placeholder:"Ex: Fornecer todo material de fabricação e consumo",disabled:!c.value},null,8,ce),[[b,e(s).contracted_responsibility]]),e(s).errors.contracted_responsibility?(n(),l("p",ue,r(e(s).errors.contracted_responsibility),1)):_("",!0)]),t("div",null,[me,m(t("textarea",{id:"contractor_responsibility","onUpdate:modelValue":o[7]||(o[7]=i=>e(s).contractor_responsibility=i),rows:"4",class:"mt-1 block w-full simple-input",placeholder:"Ex: Fornecer acesso ao local",disabled:!c.value},null,8,_e),[[b,e(s).contractor_responsibility]]),e(s).errors.contractor_responsibility?(n(),l("p",be,r(e(s).errors.contractor_responsibility),1)):_("",!0)])])]),t("section",pe,[ge,t("div",xe,[t("div",null,[ye,t("div",he,[ve,m(t("textarea",{id:"description","onUpdate:modelValue":o[8]||(o[8]=i=>e(s).description=i),rows:"3",class:"mt-1 block w-full simple-input",placeholder:"Detalhes adicionais sobre o orçamento...",disabled:!c.value},null,8,fe),[[b,e(s).description]]),e(s).errors.description?(n(),l("p",ke,r(e(s).errors.description),1)):_("",!0)]),t("div",Oe,[t("div",null,[Ee,m(t("input",{type:"number",id:"deadline","onUpdate:modelValue":o[9]||(o[9]=i=>e(s).deadline=i),min:"0",class:"mt-1 block w-full simple-input",disabled:!c.value},null,8,Ae),[[b,e(s).deadline,void 0,{number:!0}]]),e(s).errors.deadline?(n(),l("p",Ce,r(e(s).errors.deadline),1)):_("",!0)]),t("div",null,[Ne,m(t("select",{id:"deadline_type","onUpdate:modelValue":o[10]||(o[10]=i=>e(s).deadline_type=i),class:"mt-1 block w-full simple-input",disabled:!c.value},Ve,8,Te),[[G,e(s).deadline_type]]),e(s).errors.deadline_type?(n(),l("p",Ie,r(e(s).errors.deadline_type),1)):_("",!0)])]),t("div",Se,[Re,m(t("input",{type:"text",id:"deadline_start_description","onUpdate:modelValue":o[11]||(o[11]=i=>e(s).deadline_start_description=i),class:"mt-1 block w-full simple-input",placeholder:"Ex: a partir do pagamento de entrada",disabled:!c.value},null,8,Ue),[[b,e(s).deadline_start_description]]),e(s).errors.deadline_start_description?(n(),l("p",Fe,r(e(s).errors.deadline_start_description),1)):_("",!0)])]),t("div",null,[Me,t("div",Pe,[Le,m(t("textarea",{id:"payment_method_description","onUpdate:modelValue":o[12]||(o[12]=i=>e(s).payment_method_description=i),rows:"4",class:"mt-1 block w-full simple-input",placeholder:`Ex: 50% entrada
50% no ato da entrega do serviço`,disabled:!c.value},null,8,qe),[[b,e(s).payment_method_description]]),e(s).errors.payment_method_description?(n(),l("p",Be,r(e(s).errors.payment_method_description),1)):_("",!0)]),t("div",null,[$e,m(t("textarea",{id:"bank_info_description","onUpdate:modelValue":o[13]||(o[13]=i=>e(s).bank_info_description=i),rows:"4",class:"mt-1 block w-full simple-input",placeholder:`Ex: BANCO DO BRASIL
AG: 3175-5 | C/C: 20.439-0
PIX: (73) 9 8855-9571`,disabled:!c.value},null,8,je),[[b,e(s).bank_info_description]]),e(s).errors.bank_info_description?(n(),l("p",ze,r(e(s).errors.bank_info_description),1)):_("",!0)])])])]),t("div",Ge,[t("button",{type:"button",onClick:P,class:"simple-button-neutral"},"Cancelar"),g(W,{type:"submit",disabled:e(s).processing||!c.value||!e(s).client_id},{default:h(()=>[p(" Salvar Alterações ")]),_:1},8,["disabled"])])],32)])])])]}),_:1},8,["page"])],64))}};export{es as default};
