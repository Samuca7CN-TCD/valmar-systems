import{o as n,e as i,a as e,l as j,c as ee,w as v,b as m,u as d,f as D,i as te,s as O,v as B,t as u,h as p,n as z,A as se,T as I,d as V,Z as oe,F as R,g as ae}from"./app-CZNGPDIC.js";import{r as ne,_ as re}from"./AppLayout-CI1BKOvz.js";import{_ as ie}from"./CreateUpdatePayModal-sDwZcGSj.js";import{_ as le}from"./FloatButton-dBa50_0c.js";import{_ as ce}from"./ExtraOptionsButton-D5sI8yQq.js";import{f as g,t as M,i as q}from"./general-BfW9S8hN.js";/* empty css                    */import{_ as de}from"./CreateUpdateModal-DgLUF8r5.js";import{_ as ue}from"./PrimaryButton-Cq1S_GpN.js";import{_ as pe}from"./SecondaryButton-CJeDEe54.js";import{r as me}from"./MagnifyingGlassIcon-DOSPzauS.js";import{r as _e,a as he}from"./XMarkIcon-DRQWzs1z.js";import"./PlusIcon-D7bPf2V-.js";import"./EyeIcon-fryRwgv_.js";import"./PrinterIcon-8FIjl8x4.js";import"./Modal-IAeXC3jh.js";function F(r,b){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12.75 11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.746 3.746 0 0 1 3.296-1.043A3.746 3.746 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 0 1 3.296 1.043 3.746 3.746 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12Z"})])}const ve={class:"mx-auto shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-yellow-400 sm:mx-0 sm:h-10 sm:w-10"},xe={class:"pb-12 space-y-12 divide-y-2"},ye={class:"py-4"},fe=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Dados da entrega",-1),we=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Informe a data da entrega do serviço e, se o deadline for a menos de 4 dias da data da entrega, informe o motivo do atraso.",-1),ge={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"},be={class:"sm:col-span-6"},ke=e("label",{for:"service-deadline",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Data da entrega",-1),$e={class:"mt-2"},Ce=["max"],Se={key:0,class:"text-red-500 text-sm"},Me={key:0,class:"sm:col-span-6"},De=e("label",{for:"service-delay-reason",class:"block text-sm font-medium leading-6 text-gray-900"},"Motivo do Atraso",-1),Ae={class:"mt-2"},Te={key:0,class:"text-red-500 text-sm"},Ee={__name:"MotivoAtrasoModal",props:{showMotivoAtrasoModal:{type:Boolean,default:!0},service:{type:Object,default:null}},emits:["close","submit"],setup(r,{emit:b}){const $=b,o=r,k=()=>{$("close")},c=()=>{$("submit")},C=j(()=>{if(!o.service.completion_date||!o.service.deadline)return!1;const x=new Date(o.service.deadline+"T00:00:00"),l=new Date(o.service.completion_date+"T00:00:00"),_=x.getTime()-l.getTime();return Math.ceil(_/(1e3*60*60*24))<4}),A=j(()=>{var x;return C.value&&!((x=o.service.delay_reason)!=null&&x.length)});return(x,l)=>(n(),ee(de,{show:r.showMotivoAtrasoModal,onClose:k},{icon:v(()=>[e("div",ve,[m(d(F),{class:"w-5 h-5 text-white"})])]),title:v(()=>[D(" Entregar serviço ")]),content:v(()=>[e("form",{onSubmit:te(c,["prevent"])},[e("div",xe,[e("section",ye,[fe,we,e("div",ge,[e("div",be,[ke,e("div",$e,[O(e("input",{type:"date",name:"service-completion-date",id:"service-completion-date",autocomplete:"on",class:"simple-input disabled:bg-gray-200",autofocus:"true",placeholder:"Data de entrega do serviço",max:d(g)(),"onUpdate:modelValue":l[0]||(l[0]=_=>r.service.completion_date=_),required:""},null,8,Ce),[[B,r.service.completion_date]]),r.service.errors.completion_date?(n(),i("p",Se,u(r.service.errors.completion_date),1)):p("",!0)])]),C.value?(n(),i("div",Me,[De,e("div",Ae,[O(e("textarea",{type:"text",name:"service-delay-reason",id:"service-delay-reason",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Descreva o motivo do atraso do serviço","onUpdate:modelValue":l[1]||(l[1]=_=>r.service.delay_reason=_)},null,512),[[B,r.service.delay_reason]]),r.service.errors.delay_reason?(n(),i("p",Te,u(r.service.errors.delay_reason),1)):p("",!0)])])):p("",!0)])])])],32)]),footer:v(()=>{var _,y;return[m(pe,{onClick:l[2]||(l[2]=S=>k())},{default:v(()=>[D(" Cancelar ")]),_:1}),m(ue,{class:z({disabled:r.service.processing||!((_=r.service.completion_date)!=null&&_.length)||A.value}),disabled:r.service.processing||!((y=r.service.completion_date)!=null&&y.length)||A.value,onClick:l[3]||(l[3]=S=>c())},{default:v(()=>[D("Entregar")]),_:1},8,["class","disabled"])]}),_:1},8,["show"]))}},Le={class:"font-semibold text-xl text-gray-800 leading-tight"},Ve={key:0},je={class:"pt-12 print:hidden print:pt-0"},Oe={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 print:w-full"},Be={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-5"},Pe={class:"flex flex-row items-center space-x-3"},Ne={class:"py-12 print:py-0"},Ue={class:"max-w-7xl mx-auto print:max-w-full"},Ie={class:"w-full flex justify-end pb-3"},Re={class:"px-0 print:px-0"},qe={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg print:shadow-none"},ze={class:"flex flex-col"},Fe={class:"overflow-x-auto sm:-mx-6 lg:-mx-8"},Ge={class:"inline-block min-w-full py-2 sm:px-6 lg:px-8"},Ze={class:"overflow-hidden"},He={class:"min-w-full text-left text-sm font-light"},Xe={class:"border-b font-medium"},Je=e("th",{scope:"col",class:"px-6 py-4 text-center"},"#",-1),Ke=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Prazo",-1),Qe=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Título",-1),We=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Cliente",-1),Ye=e("th",{scope:"col",class:"px-6 py-4 text-center"},"À pagar",-1),et=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Valor total",-1),tt=e("th",{scope:"col",class:"px-6 py-4 text-center print:hidden"},"Entrega ",-1),st=e("th",{scope:"col",class:"px-6 py-4 text-center print:hidden",colspan:"4"},"Ações ",-1),ot={key:0,scope:"col",class:"px-6 py-4 text-center print:hidden"},at={key:1,scope:"col",class:"px-6 py-4 text-center print:hidden"},nt={key:2,scope:"col",class:"px-6 py-4 text-center print:hidden"},rt={key:3,scope:"col",class:"px-6 py-4 text-center print:hidden"},it={class:"border-b transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid"},lt={class:"whitespace-nowrap py-4 text-center font-medium"},ct={class:"whitespace-normal px-6 py-4 text-center trim"},dt=["title"],ut={class:"whitespace-normal px-6 py-4 text-center"},pt={class:"whitespace-nowrap px-2 py-4 text-center"},mt={class:"whitespace-nowrap px-2 py-4 text-center"},_t={class:"whitespace-nowrap px-2 py-4 text-center print:hidden"},ht=["title","onClick"],vt=["title","onClick"],xt={key:0},yt={key:1,class:"m-auto text-center"},ft=["title","onClick"],wt=["title","onClick"],gt={key:0,class:"whitespace-nowrap px-2 py-4 text-center print:hidden"},bt={key:1,class:"whitespace-nowrap px-2 py-4 text-center print:hidden"},kt={key:2,class:"whitespace-nowrap px-2 py-4 text-center print:hidden"},$t={key:3,class:"whitespace-nowrap px-2 py-4 text-center print:hidden"},Ct={key:1,class:"transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid"},St=e("td",{class:"whitespace-nowrap px-6 py-4 text-center",colspan:"9"},"Não há serviços cadastrados no momento!",-1),Mt=[St],Gt={__name:"Service",props:{page:Object,page_options:{type:Array,default:null},services_list:Object,sells_list:{type:Array,default:[]}},setup(r){const b=r,$=se.useToast(),o=I({id:null,previous_id:null,title:"",client:"",total_value:0,partial_value:0,deadline:g(new Date(Date.now()+15*24*60*60*1e3),"new_date"),observations:"",delay_reason:"",delayed:!1,completion_date:g(new Date,"new_date"),records_list:{enable_records:!1,data:[]}}),k=V(""),c=V(!1),C=j(()=>{const a=k.value.toLowerCase();return b.services_list.filter(s=>{var t,w,h,T,E,L;return((t=s.motive)==null?void 0:t.toLowerCase().includes(a))||((w=s.entity_name)==null?void 0:w.toLowerCase().includes(a))||((h=s.observations)==null?void 0:h.toLowerCase().includes(a))||((T=M(s.accounting.total_value||0))==null?void 0:T.toString().toLowerCase().includes(a))||((E=M(s.accounting.partial_value||0))==null?void 0:E.toString().toLowerCase().includes(a))||((L=s.deadline)==null?void 0:L.includes(a))})}),A=j(()=>b.services_list.reduce((a,s)=>a+s.accounting.partial_value,0)),x=a=>{const s=q(a);return s===0?"text-red-500":s>0&&s<8?"text-orange-500":s>7&&s<15?"text-yellow-500":s>14&&s<30?"text-green-500":"text-blue-500"},l=V({mode:"create",show:!1,get title(){switch(this.mode){case"create":return"Criar serviço";case"update":return"Editar serviço";case"pay":return"Pagar serviço";case"see":return"Ver informações do serviço"}},get primary_button_txt(){switch(this.mode){case"create":return"Cadastrar";case"update":return"Atualizar";case"pay":return"Pagar";case"see":return"Fechar"}}}),_=a=>{const s=b.services_list.find(t=>t.id===a);if(s){const{id:t,previous_id:w,motive:h,entity_name:T,deadline:E,observations:L,delay_reason:Q,delayed:W,completion_date:Dt,records:N,accounting:U}=s;o.id=t,o.previous_id=w,o.title=h,o.client=T,o.total_value=U.total_value,o.partial_value=U.partial_value,o.deadline=E,o.observations=L,o.delay_reason=Q,o.completion_date=g(new Date,"new_date"),o.delayed=W,o.records_list.enable_records=!!N.length,o.records_list.data=N.map(Y=>I(Y))}},y=(a,s=null)=>{const t=["update","pay"].includes(a);s!==null&&t&&_(s),l.value.mode=a,l.value.show=!0},S=V(!1),G=(a,s)=>{if(s!==0){if(!confirm("O serviço será considerado como concluído e será listado apenas na página de pagamentos"))return}else if(!confirm("O serviço será considerado concluído e pago!"))return;_(a),l.value.mode="conclude",S.value=!0},f=()=>{o.reset(),l.value.show=!1,S.value=!1},Z=()=>{o.post(route("services.store"),{preserveScroll:!0,onSuccess:()=>f(),onError:a=>{console.log(a)}})},H=()=>{o.put(route("services.update",o.id),{preserveScroll:!0,onSuccess:()=>f()})},X=()=>{o.put(route("services.pay",o.id),{preserveScroll:!0,onSuccess:()=>f()})},J=()=>{o.put(route("services.update",o.id),{preserveScroll:!0,onSuccess:()=>{o.put(route("services.conclude",o.id),{preserveScroll:!0,onSuccess:()=>f()}),f()}})},K=(a,s)=>{confirm(`Você tem certeza que deseja excluir o serviço "${s}"? Esta ação não poderá ser desfeita!`)&&o.delete(route("services.destroy",a),{preserveScroll:!0,onSuccess:()=>$.success("Serviço deletado com sucesso!")})},P=()=>{switch(l.value.mode){case"create":return Z();case"update":return H();case"pay":return X();case"conclude":return J();default:$.error("Método desconhecido. Informar o Técnico.")}};return(a,s)=>(n(),i(R,null,[m(d(oe),{title:r.page.name},null,8,["title"]),m(re,{page:r.page,page_options:r.page_options},{header:v(()=>[e("h2",Le,[D(u(r.page.name)+" ",1),a.$page.props.auth.user.hierarchy<2?(n(),i("span",Ve,"| "+u(d(M)(A.value)),1)):p("",!0)]),m(le,{icon:"plus",onClick:s[0]||(s[0]=t=>y("create")),title:"Cadastrar Service",class:"print:hidden"})]),default:v(()=>[e("div",je,[e("div",Oe,[e("div",Be,[e("div",Pe,[m(d(me),{class:"w-5 y-5"}),O(e("input",{type:"text",name:"search_term",id:"search_term",autocomplete:"on",class:"simple-input",autofocus:"true",placeholder:"Pesquisar termo...","onUpdate:modelValue":s[1]||(s[1]=t=>k.value=t)},null,512),[[B,k.value]])])])])]),e("div",Ne,[e("div",Ue,[e("div",Ie,[c.value?p("",!0):(n(),i("button",{key:0,class:"text-blue-500 text-xs justify-end",onClick:s[2]||(s[2]=t=>c.value=!c.value)},"Mostrar dados de usuário")),c.value?(n(),i("button",{key:1,class:"text-red-500 text-xs justify-end",onClick:s[3]||(s[3]=t=>c.value=!c.value)},"Esconder dados de usuário")):p("",!0)]),e("div",Re,[e("div",qe,[e("div",ze,[e("div",Fe,[e("div",Ge,[e("div",Ze,[e("table",He,[e("thead",Xe,[e("tr",null,[Je,Ke,Qe,We,Ye,et,tt,st,c.value?(n(),i("th",ot,"Criado em")):p("",!0),c.value?(n(),i("th",at,"Criado por")):p("",!0),c.value?(n(),i("th",nt," Modificado em")):p("",!0),c.value?(n(),i("th",rt," Modificado por ")):p("",!0)])]),e("tbody",null,[C.value.length?(n(!0),i(R,{key:0},ae(C.value,t=>{var w;return n(),i("tr",it,[e("td",lt,u(t.id),1),e("td",{class:z(["whitespace-nowrap py-4 text-center font-medium",x(t.deadline)])},u(d(q)(t.deadline))+" dias ",3),e("td",ct,[D(u(t.motive)+" ",1),t.observations?(n(),i("span",{key:0,title:t.observations,class:"inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10 cursor-help"},"OBS",8,dt)):p("",!0)]),e("td",ut,u(t.entity_name),1),e("td",pt,u(d(M)(t.accounting.partial_value)),1),e("td",mt,u(d(M)(t.accounting.total_value)),1),e("td",_t,u(d(g)(t.deadline,!0)),1),e("td",{class:"whitespace-nowrap px-4 py-4 pl-10 text-center cursor-pointer hover:text-blue-700 active:text-blue-900 select-none print:hidden",title:"CONCLUIR: "+t.motive+"("+t.entity_name+")",onClick:h=>G(t.id,t.accounting.partial_value)},[m(d(F),{class:"w-4 h-4 m-auto"})],8,ht),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-green-700 active:text-green-900 select-none print:hidden",title:"PAGAR: "+t.motive+"("+t.entity_name+")",onClick:h=>y("pay",t.id)},[t.accounting.partial_value!==0?(n(),i("span",xt,[m(d(ne),{class:"w-4 h-4 m-auto"})])):(n(),i("span",yt,"PAGO"))],8,vt),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-yellow-700 active:text-yellow-900 select-none print:hidden",title:"EDITAR: "+t.motive+"("+t.entity_name+")",onClick:h=>y("update",t.id)},[m(d(_e),{class:"w-4 h-4 m-auto"})],8,ft),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-red-700 active:text-red-900 select-none print:hidden",title:"EXCLUIR: "+t.motive+"("+t.entity_name+")",onClick:h=>K(t.id,t.name)},[m(d(he),{class:"w-4 h-4 m-auto"})],8,wt),c.value?(n(),i("td",gt,u(d(g)(t.created_at,"reading_date_time")),1)):p("",!0),c.value?(n(),i("td",bt,u(t.procedures[0].user.name),1)):p("",!0),c.value?(n(),i("td",kt,u(d(g)(t.updated_at,"reading_date_time")),1)):p("",!0),c.value?(n(),i("td",$t,u(t.procedures[((w=t.procedures)==null?void 0:w.length)-1].user.name),1)):p("",!0)])}),256)):(n(),i("tr",Ct,Mt))])])])])])])])])])]),m(ie,{show:l.value.show,modal:l.value,service:d(o),sells_list:r.sells_list,onSubmit:P,onClose:f},null,8,["show","modal","service","sells_list"]),m(Ee,{show:S.value,service:d(o),onSubmit:P,onClose:f},null,8,["show","service"]),m(ce,{mode:["rollup","print_page","link"],link_type:["previous"],link:[a.route("services.previous")]},null,8,["link"])]),_:1},8,["page","page_options"])],64))}};export{Gt as default};
