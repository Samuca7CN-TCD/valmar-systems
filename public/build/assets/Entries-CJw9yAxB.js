import{l as V,d as O,o as n,c as k,w as b,a as e,n as $,u as h,h as p,f as L,t as c,i as Q,q as C,v as E,e as r,F as T,g as F,b as g,T as W,Z as P}from"./app-wIlip3pR.js";import{_ as X}from"./AppLayout-BbWcPMzy.js";import{r as Z,_ as G,a as H}from"./CreateUpdateModal-Bn2Rq6uk.js";import{_ as J}from"./PrimaryButton-CFA6HZtj.js";import{_ as K}from"./SecondaryButton-B18wpBTD.js";import{e as A,t as N}from"./general-B4ZTqOfr.js";import{r as Y,_ as ee}from"./FloatButton-Cl9FbEB0.js";import{r as te}from"./BanknotesIcon-BW4l_CJL.js";import{r as R}from"./EyeIcon-DKKhZS4j.js";import{r as se}from"./MagnifyingGlassIcon-Ct-Qocut.js";import"./Modal-DEJQdgPt.js";import"./PrinterIcon-Bt7yR5Wr.js";const ae={class:"pb-12 space-y-12 divide-y-2"},oe={class:"py-4"},ne=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Informações Básicas",-1),ie=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Informações sobre a entrada como nome do funcionário, data da entrada e observações",-1),re={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"},le={class:"sm:col-span-3"},de=e("label",{for:"entry-employee",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Funcionário",-1),ce={class:"mt-2"},ue={key:0,class:"text-red-500 text-sm"},me={class:"sm:col-span-3"},pe=e("label",{for:"entry-date",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Data do Entrada",-1),ye={class:"mt-2"},he=["max"],xe={key:0,class:"text-red-500 text-sm"},_e={class:"sm:col-span-6"},ve=e("label",{for:"entry-motive",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Motivo",-1),fe={class:"mt-2"},ge={key:0,class:"text-red-500 text-sm"},be={class:"sm:col-span-6"},we=e("label",{for:"entry-observations",class:"block text-sm font-medium leading-6 text-gray-900"},"Observações",-1),qe={class:"mt-2"},ke={key:0,class:"text-red-500 text-sm"},$e={key:0,class:"py-4"},Ce=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Lista de Itens",-1),Ee=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Adicione os itens do entrada.",-1),Ve={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-4"},Se={class:"sm:col-span-4"},Me={class:"relative"},Ie=e("label",{for:"item-selecter",class:"block text-sm font-medium leading-6 text-gray-900"},"Selecione os itens de entrada",-1),Ue=["disabled"],Le={key:0,class:"absolute z-10 w-full mx-auto sm:w-96 bg-white border rounded mt-2 h-96 overflow-y-scroll"},De=["onMousedown"],je={class:"sm:col-span-4"},Oe={key:0,class:"min-w-full text-left text-sm font-medium leading-6 text-gray-900"},Te={class:"border-b font-medium dark:border-neutral-500"},Be=e("th",{scope:"col",class:"px-6 py-4 text-center"},"#",-1),Fe=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Item",-1),Ne=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Qtd. Estoque",-1),Ae=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Qtd. Entrada",-1),Re=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Und. Medida",-1),ze={key:0,scope:"col",class:"px-6 py-4 text-center"},Qe={class:"whitespace-nowrap py-4 text-center font-medium"},We={class:"whitespace-nowrap py-4 text-center font-medium"},Pe={class:"whitespace-nowrap py-4 text-center font-medium flex justify-center"},Xe=["value","onInput","disabled"],Ze={class:"whitespace-nowrap py-4 text-center font-medium"},Ge={key:0,class:"whitespace-nowrap py-4 text-center font-mono text-2xl"},He=["onClick","title"],Je={key:1,class:"p-5 bg-gray-200 rounded-md block text-sm font-medium leading-6 text-gray-900"},Ke={__name:"CreateUpdateEntriesModal",props:{modal:Object,entry:{type:Object,default:null},items:Array},emits:["close","submit"],setup(s,{emit:S}){const l=S,d=s,M=/^\d{4}-\d{2}-\d{2}$/,D=V(()=>{const{motive:o,employee:a,date:t}=d.entry;return!a||!a.length||!o||!o.length?!1:t&&M.test(t)}),f=V(()=>{const{employee:o,motive:a,date:t,items_list:y}=d.entry;return!o||!o.length||!a||!a.length||!t||!M.test(t)||y.length<1?!1:y.every(v=>v.movement_quantity>0)}),w=V(()=>d.modal.mode==="see"),_=O(""),q=O(!1),B=V(()=>d.items.filter(o=>o.name.toLowerCase().includes(_.value.toLowerCase())&&!d.entry.items_list.some(a=>a.id===o.id))),j=o=>{o==="in"&&(q.value=!0),o==="out"&&(q.value=!1)},I=()=>{d.entry.estimated_value=d.entry.items_list.reduce((o,a)=>o+a.price*a.movement_quantity,0),d.entry.total_value=d.entry.estimated_value},m=o=>{d.entry.items_list.push({id:o.id,name:o.name,quantity:o.quantity,max_quantity:o.max_quantity,min_quantity:o.min_quantity,movement_quantity:1,measurement_unit:o.measurement_unit.abbreviation,price:o.price,amount:o.price}),_.value="",q.value=!1,I()},u=o=>{d.entry.items_list=d.entry.items_list.filter(a=>a.id!==o),I()},i=()=>{l("close")},x=()=>{l("submit")};return(o,a)=>(n(),k(G,{show:s.modal.show,maxWidth:D.value||w.value?"3xl":"2xl",onClose:i},{icon:b(()=>[e("div",{class:$(["mx-auto shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-400 sm:mx-0 sm:h-10 sm:w-10",{"bg-yellow-400":s.modal.mode==="update","bg-green-400":s.modal.mode==="pay","bg-gray-400":s.modal.mode==="see"}])},[s.modal.mode==="create"?(n(),k(h(Y),{key:0,class:"w-5 h-5 text-white"})):p("",!0),s.modal.mode==="update"?(n(),k(h(Z),{key:1,class:"w-5 h-5 text-white"})):p("",!0),s.modal.mode==="pay"?(n(),k(h(te),{key:2,class:"w-5 h-5 text-white"})):p("",!0),s.modal.mode==="see"?(n(),k(h(R),{key:3,class:"w-5 h-5 text-white"})):p("",!0)],2)]),title:b(()=>[L(c(s.modal.title),1)]),content:b(()=>[e("form",{onSubmit:Q(x,["prevent"])},[e("div",ae,[e("section",oe,[ne,ie,e("div",re,[e("div",le,[de,e("div",ce,[C(e("input",{type:"text",name:"entry-employee",id:"entry-employee",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Nome do funcionario","onUpdate:modelValue":a[0]||(a[0]=t=>s.entry.employee=t),required:""},null,512),[[E,s.entry.employee]]),s.entry.errors.employee?(n(),r("p",ue,c(s.entry.errors.employee),1)):p("",!0)])]),e("div",me,[pe,e("div",ye,[C(e("input",{type:"date",name:"entry-date",id:"entry-date",autocomplete:"on",class:"simple-input disabled:bg-gray-200",autofocus:"true",placeholder:"Data do Entrada",max:h(A)(),"onUpdate:modelValue":a[1]||(a[1]=t=>s.entry.date=t),required:""},null,8,he),[[E,s.entry.date]]),s.entry.errors.date?(n(),r("p",xe,c(s.entry.errors.date),1)):p("",!0)])]),e("div",_e,[ve,e("div",fe,[C(e("input",{type:"text",name:"entry-motive",id:"entry-motive",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Motivo do Entrada","onUpdate:modelValue":a[2]||(a[2]=t=>s.entry.motive=t),required:""},null,512),[[E,s.entry.motive]]),s.entry.errors.motive?(n(),r("p",ge,c(s.entry.errors.motive),1)):p("",!0)])]),e("div",be,[we,e("div",qe,[C(e("textarea",{type:"text",observations:"entry-observations",id:"entry-observations",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Descreva a título mais detalhadamente ou insira informações adicionais","onUpdate:modelValue":a[3]||(a[3]=t=>s.entry.observations=t)},null,512),[[E,s.entry.observations]]),s.entry.errors.observations?(n(),r("p",ke,c(s.entry.errors.observations),1)):p("",!0)])])])]),D.value||w.value?(n(),r("section",$e,[Ce,Ee,e("div",Ve,[e("div",Se,[e("div",Me,[Ie,C(e("input",{id:"item-selecter","onUpdate:modelValue":a[4]||(a[4]=t=>_.value=t),onFocus:a[5]||(a[5]=t=>j("in")),onBlur:a[6]||(a[6]=t=>j("out")),class:"simple-input disabled:bg-gray-200 px-4 py-2 w-full",placeholder:"Digite para pesquisar",disabled:w.value},null,40,Ue),[[E,_.value]]),q.value?(n(),r("ul",Le,[(n(!0),r(T,null,F(B.value,(t,y)=>(n(),r("li",{key:y,class:"py-2 px-4 cursor-pointer hover:bg-gray-200",onMousedown:U=>m(t)},[e("span",{class:$(["inline",{"text-blue-500":t.quantity!=0&&t.quantity>=t.max_quantity,"text-green-500":t.quantity<t.max_quantity&&t.quantity>=t.min_quantity,"text-yellow-500":t.quantity<t.min_quantity&&t.quantity>0,"text-red-500":t.quantity==0}])},"("+c(t.quantity)+")",3),L(" "+c(t.name),1)],40,De))),128))])):p("",!0)])]),e("div",je,[d.entry.items_list.length?(n(),r("table",Oe,[e("thead",Te,[e("tr",null,[Be,Fe,Ne,Ae,Re,s.modal.mode!=="see"?(n(),r("th",ze," Deletar")):p("",!0)])]),e("tbody",null,[(n(!0),r(T,null,F(d.entry.items_list,t=>(n(),r("tr",{key:t.id,class:$(["border-b transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid",{"bg-yellow-100":t.movement_quantity==t.quantity,"bg-red-100":t.movement_quantity>t.quantity}])},[e("td",Qe,c(t.id),1),e("td",We,c(t.name),1),e("td",{class:$(["whitespace-nowrap py-4 text-center font-medium",{"text-blue-500":t.quantity!=0&&t.quantity>=t.max_quantity,"text-green-500":t.quantity<t.max_quantity&&t.quantity>=t.min_quantity,"text-yellow-500":t.quantity<t.min_quantity&&t.quantity>0,"text-red-500":t.quantity==0}])},c(t.quantity),3),e("td",Pe,[e("input",{type:"number",min:"0.01",step:"0.01",value:t.movement_quantity,onInput:y=>{t.movement_quantity=parseFloat(y.target.value),t.amount=t.price*y.target.value,I()},class:"simple-input disabled:bg-gray-200 w-2/3",disabled:s.modal.mode!=="create"},null,40,Xe)]),e("td",Ze,c(t.measurement_unit),1),s.modal.mode!=="see"?(n(),r("td",Ge,[e("button",{onClick:y=>u(t.id),title:"Remover "+t.name},"×",8,He)])):p("",!0)],2))),128))])])):(n(),r("p",Je," Nenhum item selecionado até o momento!"))])])])):p("",!0)])],32)]),footer:b(()=>[s.modal.mode!=="see"?(n(),k(K,{key:0,class:$({disabled:s.entry.processing}),onClick:a[7]||(a[7]=t=>i())},{default:b(()=>[L(" Cancelar ")]),_:1},8,["class"])):p("",!0),g(J,{class:$({disabled:s.entry.processing||!f.value}),disabled:s.entry.processing||!f.value,onClick:a[8]||(a[8]=t=>x())},{default:b(()=>[L(c(s.modal.primary_button_txt),1)]),_:1},8,["class","disabled"])]),_:1},8,["show","maxWidth"]))}},Ye={class:"font-semibold text-xl text-gray-800 leading-tight"},et={class:"pt-12 print:hidden print:pt-0"},tt={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 print:w-full"},st={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-5"},at={class:"flex flex-row items-center space-x-3"},ot={class:"py-12 print:py-6"},nt={class:"max-w-7xl mx-auto print:max-w-full"},it={class:"px-0 print:px-0"},rt={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg print:shadow-none"},lt={class:"flex flex-col"},dt={class:"overflow-x-auto sm:-mx-6 lg:-mx-8"},ct={class:"inline-block min-w-full py-2 sm:px-6 lg:px-8"},ut={class:"overflow-hidden"},mt={class:"min-w-full text-left text-sm font-light"},pt=e("thead",{class:"border-b font-medium dark:border-neutral-500"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-4 text-center"},"#"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Funcionário"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Motivo"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Data do Entrada "),e("th",{scope:"col",class:"px-6 py-4 text-center print:hidden",colspan:"2"}," Ações")])],-1),yt={class:"border-b transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid"},ht={class:"whitespace-nowrap py-4 text-center font-medium"},xt={class:"whitespace-normal px-6 py-4 text-center trim"},_t=["title"],vt={class:"whitespace-nowrap px-2 py-4 text-center"},ft={class:"whitespace-nowrap px-2 py-4 text-center print:hidden"},gt=["title","onClick"],bt=["title","onClick"],wt={key:1,class:"transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid"},qt=e("td",{class:"whitespace-nowrap px-6 py-4 text-center",colspan:"9"},"Não há entradas cadastradas no momento!",-1),kt=[qt],Tt={__name:"Entries",props:{page:Object,page_options:{type:Array,default:null},entries_list:Object,items:Object},setup(s){const S=s,l=W({id:null,employee:"",motive:"",date:"",total_value:0,observations:"",items_list:[]}),d=O(""),M=V(()=>{const m=d.value.toLowerCase();return S.entries_list.filter(u=>{const{id:i,entity_name:x,motive:o,observations:a,date:t,items:y}=u,U=[i.toString(),(x==null?void 0:x.toLowerCase())??"",(o==null?void 0:o.toLowerCase())??"",(a==null?void 0:a.toLowerCase())??"",(t==null?void 0:t.toLowerCase())??""];for(let v of U)if(v.includes(m))return!0;return y.some(v=>v.name.toLowerCase().includes(m))})}),D=V(()=>S.entries_list.reduce((m,u)=>m+u.accounting.partial_value,0)),f=O({mode:"create",show:!1,get title(){switch(this.mode){case"create":return"Criar entrada";case"update":return"Editar entrada";case"see":return"Ver informações da entrada"}},get primary_button_txt(){switch(this.mode){case"create":return"Cadastrar";case"update":return"Atualizar";case"see":return"Fechar"}}}),w=(m,u=null)=>{const i=["update","see"].includes(m);if(u!==null&&i){const x=S.entries_list.find(o=>o.id===u);if(x){const{id:o,entity_name:a,date:t,motive:y,observations:U,accounting:v,items:z}=x;l.id=o,l.employee=a,l.motive=y,l.date=t,l.estimated_value=v.estimated_value,l.total_value=v.total_value,l.partial_value=v.partial_value,l.observations=U,l.items_list=z}}f.value.mode=m,f.value.show=!0},_=()=>{l.reset(),f.value.show=!1},q=()=>{l.post(route("entries.store"),{preserveScroll:!0,onSuccess:()=>_(),onError:m=>{console.log(m)}})},B=()=>{l.put(route("entries.update",l.id),{preserveScroll:!0,onSuccess:()=>_()})},j=(m,u)=>{confirm(`Você tem certeza que deseja excluir a entrada de material para "${u}"? Todos os materiais comprados voltarão para o estoque! Esta ação não poderá ser desfeita!`)&&l.delete(route("entries.destroy",m),{preserveScroll:!0,onSuccess:()=>alert("Entrada deletado com sucesso!")})},I=()=>{switch(f.value.mode){case"create":return q();case"update":return B();case"see":return _();default:alert("Método desconhecido. Informar o Técnico.")}};return(m,u)=>(n(),r(T,null,[g(h(P),{title:s.page.name},null,8,["title"]),g(X,{page:s.page,page_options:s.page_options},{header:b(()=>[e("h2",Ye,c(s.page.name)+" | "+c(h(N)(D.value)),1),g(ee,{icon:"plus",onClick:u[0]||(u[0]=i=>w("create")),title:"Cadastrar Entry",class:"print:hidden"})]),default:b(()=>[e("div",et,[e("div",tt,[e("div",st,[e("div",at,[g(h(se),{class:"w-5 y-5"}),C(e("input",{type:"text",name:"search_term",id:"search_term",autocomplete:"on",class:"simple-input",autofocus:"true",placeholder:"Pesquisar termo...","onUpdate:modelValue":u[1]||(u[1]=i=>d.value=i)},null,512),[[E,d.value]])])])])]),e("div",ot,[e("div",nt,[e("div",it,[e("div",rt,[e("div",lt,[e("div",dt,[e("div",ct,[e("div",ut,[e("table",mt,[pt,e("tbody",null,[M.value.length?(n(!0),r(T,{key:0},F(M.value,i=>(n(),r("tr",yt,[e("td",ht,c(i.id),1),e("td",xt,[L(c(i.entity_name)+" ",1),i.observations?(n(),r("span",{key:0,title:i.observations,class:"inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10 cursor-help"},"OBS",8,_t)):p("",!0)]),e("td",vt,c(h(N)(i.motive)),1),e("td",ft,c(h(A)(i.date,!0)),1),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-indigo-700 active:text-indigo-900 select-none print:hidden",title:"VER: Compra de "+i.entity_name,onClick:x=>w("see",i.id)},[g(h(R),{class:"w-5 h-5 m-auto"})],8,gt),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-red-700 active:text-red-900 select-none print:hidden",title:"EXCLUIR: Compra de "+i.entity_name,onClick:x=>j(i.id,i.entity_name)},[g(h(H),{class:"w-5 h-5 m-auto"})],8,bt)]))),256)):(n(),r("tr",wt,kt))])])])])])])])])])]),g(Ke,{modal:f.value,entry:h(l),items:s.items,onSubmit:I,onClose:_},null,8,["modal","entry","items"])]),_:1},8,["page","page_options"])],64))}};export{Tt as default};
