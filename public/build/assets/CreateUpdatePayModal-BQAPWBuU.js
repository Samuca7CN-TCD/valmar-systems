import{r as z,k,D as G,p as A,I as J,d as a,o as s,s as x,e as r,v as $,a as t,h as P,F as M,g as F,t as u,b as R,u as _,n as N,x as L,C as H,T as O,c as S,w as U,f as B}from"./app-CvAlCVsm.js";import{_ as K}from"./CreateUpdateModal-BQ3IFhSt.js";import{_ as Q}from"./PrimaryButton-CMcNbFER.js";import{_ as Y}from"./SecondaryButton-DmFe0qdl.js";import{t as j,f as q,k as Z,j as ee}from"./general-D_37hS-e.js";import{_ as te}from"./ClientSelector-D2BBdkmY.js";import{r as se}from"./XMarkIcon-B-8YcTZB.js";import{r as oe}from"./PlusIcon-Egh1AfEM.js";import{r as ae}from"./PencilIcon-G-YSz9bE.js";import{r as de}from"./BanknotesIcon-DJ1eA1T_.js";import{r as ie}from"./EyeIcon-Be-mZmg-.js";const re={class:"relative dropdown-container"},le=["disabled"],ne={key:0,class:"absolute w-full mt-2 bg-white border rounded shadow-md max-h-40 overflow-y-auto z-10"},ce=["onClick"],ue={key:0},me={class:"flex gap-2 justify-between"},ve={class:"flex gap-2"},_e={class:"font-bold text-gray-800"},be={class:"text-gray-600"},ge={class:"text-gray-600 justify-end"},he={class:"text-gray-600"},xe={key:1},ye=t("div",{class:"flex gap-2"},[t("div",{class:"text-gray-600"},"Nenhuma venda relacionada")],-1),fe=[ye],pe={key:0,class:"px-4 py-2 text-gray-500"},$e={__name:"SelectSearchSell",props:{options:{type:Array,required:!0,default:()=>[]},disable_services_inputs:{type:Boolean,default:!0},initialValue:{type:Number,default:null}},emits:["update:modelValue"],setup(e,{emit:V}){const l=e,o=V,h=z(""),g=z(!1),y=z(l.options.find(i=>i.id===l.initialValue)),f=()=>{g.value=!0},v=()=>{g.value=!1},d=i=>{var n,m;i&&i.id!==null?(h.value=`#${i.id} ${i.entity_name||"-"} | R$ ${((m=(n=i.accounting)==null?void 0:n.total_value)==null?void 0:m.toFixed(2))||"0.00"} (${i.date?new Date(i.date).toLocaleDateString():"-"})`,y.value=i.id):(h.value="",y.value=null)},C=i=>{typeof i=="string"?(h.value=i,y.value=null):(d(i!=null&&i.id?i:null),v()),o("update:modelValue",y.value)},c=k(()=>{const i=l.options.filter(n=>n.motive&&n.motive.toLowerCase().includes(h.value.toLowerCase())||n.entity_name&&n.entity_name.toLowerCase().includes(h.value.toLowerCase())||String(n.id).includes(h.value));return[{id:null,entity_name:"Nenhuma venda relacionada",motive:null,date:null,accounting:{total_value:0}},...i]}),D=i=>{i.target.closest(".dropdown-container")||v()};return G(()=>{if(document.addEventListener("click",D),l.initialValue!==null&&l.initialValue!==void 0){const i=l.options.find(n=>n.id===l.initialValue);i&&(d(i),o("update:modelValue",i.id))}}),A(()=>l.initialValue,i=>{if(i!=null){const n=l.options.find(m=>m.id===i);n&&(d(n),o("update:modelValue",n.id))}else d(null)}),J(()=>{document.removeEventListener("click",D)}),(i,n)=>(s(),a("div",re,[x(t("input",{"onUpdate:modelValue":n[0]||(n[0]=m=>h.value=m),onFocus:f,onClick:n[1]||(n[1]=P(()=>{},["stop"])),onInput:n[2]||(n[2]=m=>C(m.target.value)),disabled:e.disable_services_inputs,class:"simple-input disabled:bg-gray-200",type:"text",placeholder:"Selecione ou escreva o ID, cliente ou motivo da venda"},null,40,le),[[$,h.value]]),g.value?(s(),a("ul",ne,[(s(!0),a(M,null,F(c.value,(m,E)=>(s(),a("li",{key:E,onClick:T=>C(m),class:"px-4 py-2 space-y-1 cursor-pointer hover:bg-gray-200 text-sm"},[m.id!==null?(s(),a("div",ue,[t("div",me,[t("div",ve,[t("div",_e,"#"+u(m.id),1),t("div",be,u(m.entity_name||"-"),1)]),t("div",ge,u(m.date?new Date(m.date).toLocaleDateString():"-"),1)]),t("div",he,"R$"+u(m.accounting?m.accounting.total_value.toFixed(2):"0.00"),1)])):(s(),a("div",xe,fe))],8,ce))),128)),c.value.length===0?(s(),a("li",pe," Nenhuma opção encontrada ")):r("",!0)])):r("",!0)]))}},we={class:"py-4"},ke=t("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Informações Básicas",-1),Ve=t("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Informações sobre o serviço como título do serviço, nome do cliente, valores de pagamento e prazo para conclusão",-1),De={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"},Ce={class:"sm:col-span-6"},Se=t("label",{for:"service-title",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Título",-1),qe={class:"mt-2"},Ue=["disabled"],Re={key:0,class:"text-red-500 text-sm"},Ee={class:"sm:col-span-6"},je=t("label",{for:"service-client",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Cliente",-1),ze={class:"mt-2"},Ne={key:0,class:"text-red-500 text-sm"},Te={class:"sm:col-span-3"},Be=t("label",{for:"service-value",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Valor do Serviço (Ex: Mão de Obra)",-1),Ie={class:"mt-2"},Le=["disabled"],Oe={class:"sm:col-span-3"},Ae=t("label",{for:"service-sell",class:"block text-sm font-medium leading-6 text-gray-900"},"Venda relacionada",-1),Pe={class:"mt-2"},Me={key:0,class:"text-red-500 text-sm"},Fe={class:"sm:col-span-6"},He=t("label",{for:"service-total-amount",class:"block text-sm font-medium leading-6 text-gray-900"},"Valor Total",-1),Xe={class:"mt-2"},We=["value"],Ge={key:0,class:"text-red-500 text-sm"},Je={class:"sm:col-span-6"},Ke=t("label",{for:"service-deadline",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Prazo para conclusão",-1),Qe={class:"mt-2"},Ye=["min","disabled"],Ze={key:0,class:"text-red-500 text-sm"},et={key:0,class:"sm:col-span-6"},tt=t("label",{for:"service-delay-reason",class:"block text-sm font-medium leading-6 text-gray-900"},"Motivo do Atraso",-1),st={class:"mt-2"},ot=["disabled"],at={key:0,class:"text-red-500 text-sm"},dt={class:"sm:col-span-6"},it=t("label",{for:"service-observations",class:"block text-sm font-medium leading-6 text-gray-900"},"Observações",-1),rt={class:"mt-2"},lt=["disabled"],nt={key:0,class:"text-red-500 text-sm"},ct={__name:"ServiceBasicInfoSection",props:{service:Object,sells_list:Array,disable_services_inputs:Boolean,modal_mode:String},setup(e){return(V,l)=>(s(),a("section",we,[ke,Ve,t("div",De,[t("div",Ce,[Se,t("div",qe,[x(t("input",{type:"text",name:"service-title",id:"service-title",autocomplete:"on",class:"simple-input disabled:bg-gray-200",autofocus:"true",placeholder:"Título da título",disabled:e.disable_services_inputs,"onUpdate:modelValue":l[0]||(l[0]=o=>e.service.title=o),required:""},null,8,Ue),[[$,e.service.title]]),e.service.errors.title?(s(),a("p",Re,u(e.service.errors.title),1)):r("",!0)])]),t("div",Ee,[je,t("div",ze,[R(te,{modelValue:e.service.client_id,"onUpdate:modelValue":l[1]||(l[1]=o=>e.service.client_id=o),disabled:e.disable_services_inputs,class:"disabled:bg-gray-200",required:!0},null,8,["modelValue","disabled"]),e.service.errors.client_id?(s(),a("p",Ne,u(e.service.errors.client_id),1)):r("",!0)])]),t("div",Te,[Be,t("div",Ie,[x(t("input",{id:"service-value",name:"service-value",type:"number",step:"0.01",min:"0",autocomplete:"off",class:"simple-input disabled:bg-gray-200",placeholder:"Valor da mão de obra",disabled:e.disable_services_inputs,"onUpdate:modelValue":l[2]||(l[2]=o=>e.service.service_value=o),required:""},null,8,Le),[[$,e.service.service_value]])])]),t("div",Oe,[Ae,t("div",Pe,[R($e,{options:e.sells_list,"onUpdate:modelValue":l[3]||(l[3]=o=>e.service.previous_id=o),disable_services_inputs:e.disable_services_inputs,initialValue:e.service.previous_id},null,8,["options","disable_services_inputs","initialValue"]),e.service.errors.previous_id?(s(),a("p",Me,u(e.service.errors.previous_id),1)):r("",!0)])]),t("div",Fe,[He,t("div",Xe,[t("input",{id:"service-total-amount",name:"service-total-amount",type:"text",value:_(j)(e.service.total_value),class:"simple-input bg-gray-100 cursor-not-allowed",readonly:""},null,8,We),e.service.errors.total_value?(s(),a("p",Ge,u(e.service.errors.total_value),1)):r("",!0)])]),t("div",Je,[Ke,t("div",Qe,[x(t("input",{type:"date",name:"service-deadline",id:"service-deadline",autocomplete:"on",class:"simple-input disabled:bg-gray-200",autofocus:"true",placeholder:"Prazo para conclusão",min:_(q)(),disabled:e.disable_services_inputs||e.modal_mode!=="create","onUpdate:modelValue":l[4]||(l[4]=o=>e.service.deadline=o),required:""},null,8,Ye),[[$,e.service.deadline]]),e.service.errors.deadline?(s(),a("p",Ze,u(e.service.errors.deadline),1)):r("",!0)])]),e.modal_mode!=="create"&&_(Z)(e.service.deadline)<4?(s(),a("div",et,[tt,t("div",st,[x(t("textarea",{type:"text",name:"service-delay-reason",id:"service-delay-reason",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Descreva o motivo do atraso do serviço",disabled:e.disable_services_inputs,"onUpdate:modelValue":l[5]||(l[5]=o=>e.service.delay_reason=o)},null,8,ot),[[$,e.service.delay_reason]]),e.service.errors.delay_reason?(s(),a("p",at,u(e.service.errors.delay_reason),1)):r("",!0)])])):r("",!0),t("div",dt,[it,t("div",rt,[x(t("textarea",{type:"text",name:"service-observations",id:"service-observations",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Descreva a título mais detalhadamente ou insira informações adicionais",disabled:e.disable_services_inputs,"onUpdate:modelValue":l[6]||(l[6]=o=>e.service.observations=o)},null,8,lt),[[$,e.service.observations]]),e.service.errors.observations?(s(),a("p",nt,u(e.service.errors.observations),1)):r("",!0)])])])]))}},ut={key:0,class:"py-4"},mt={class:"sm:col-span-6"},vt=["title"],_t={class:"flex h-6 items-center"},bt=["disabled","checked"],gt={class:"text-sm leading-6"},ht={__name:"ServiceEnableRecordsSection",props:{modal_mode:String,can_add_record:Boolean,enable_records:Boolean},emits:["toggle-enable-records"],setup(e,{emit:V}){const l=V,o=()=>{l("toggle-enable-records")};return(h,g)=>e.modal_mode==="create"?(s(),a("section",ut,[t("div",mt,[t("div",{class:"mt-2 relative flex gap-x-3",title:e.can_add_record?"":"Preencha ao menos a título, o cliente e o valor total."},[t("div",_t,[t("input",{id:"service-enable-records",name:"service-enable-records",type:"checkbox",onChange:g[0]||(g[0]=y=>o()),disabled:!e.can_add_record,class:"h-4 w-4 rounded border-gray-300 text-green-600 focus:ring-green-600 disabled:border-gray-100 disabled:text-green-200 disabled:bg-gray-300",checked:e.enable_records},null,40,bt)]),t("div",gt,[t("label",{for:"service-enable-records",class:N(["font-medium text-gray-900 select-none cursor-pointer",{"text-gray-300":!e.can_add_record,"cursor-not-allowed":!e.can_add_record}])},"Adicionar pagamentos concluídos",2)])],8,vt)])])):r("",!0)}},xt={class:"py-4"},yt={key:0},ft=t("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Pagamentos concluídos",-1),pt=t("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Insira o adiantamento ou os serviços parciais já realizando desta título",-1),$t=[ft,pt],wt={key:1},kt=t("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Lista de pagamentos concluídos",-1),Vt=t("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Abaixo está listado os registros de serviços realizados. Para adicionar novos serviços, ou remover algum serviço existente, entre na seção de serviço.",-1),Dt=[kt,Vt],Ct={key:2},St=t("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Realize um novo pagamento",-1),qt=t("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Adicione um serviço ou remova um serviço existente.",-1),Ut=[St,qt],Rt={key:3},Et=t("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Veja a lista de pagamentos realizados",-1),jt=t("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Abaixo segue a lista dos pagamentos concluídos deste serviço ",-1),zt=[Et,jt],Nt={key:4,class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-4 sm:grid-cols-6"},Tt={class:"col-span-2"},Bt=t("label",{for:"record-amount",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Valor (R$)",-1),It={class:"mt-2"},Lt=["max","disabled"],Ot={class:"text-gray-400 text-xs py-1"},At={key:0,class:"text-red-500 text-sm"},Pt={class:"sm:col-span-2"},Mt=t("label",{for:"record-date",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Data do serviço",-1),Ft={class:"mt-2"},Ht=["max","disabled"],Xt=t("p",{class:"text-gray-400 text-xs py-1"},"Não aceita datas no futuro",-1),Wt={key:0,class:"text-red-500 text-sm"},Gt={class:"sm:col-span-2"},Jt=t("label",{for:"record-date",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Forma de Pagamento",-1),Kt={class:"mt-2"},Qt=H('<option value="pix">PIX</option><option value="dinheiro">Dinheiro</option><option value="cartao_credito">Cartão de Crédito</option><option value="cartao_debito">Cartão de Débito</option><option value="ted">TED</option><option value="cheque">Cheque</option>',6),Yt=[Qt],Zt={key:0,class:"text-red-500 text-sm"},es={key:5,class:"w-full py-5 flex justify-end"},ts=["disabled"],ss={key:6,class:"flex flex-col"},os={class:"overflow-x-auto sm:-mx-6 lg:-mx-8"},as={class:"inline-block min-w-full py-2 sm:px-6 lg:px-8"},ds={class:"overflow-hidden"},is={class:"min-w-full text-left text-sm font-light"},rs={class:"border-b bg-white font-medium"},ls=t("th",{scope:"col",class:"px-6 py-4 text-center"},"Valor",-1),ns=t("th",{scope:"col",class:"px-6 py-4 text-center"},"Data",-1),cs=t("th",{scope:"col",class:"px-6 py-4 text-center"},"Método de Pagamento",-1),us={key:0,scope:"col",class:"px-6 py-4 text-center"},ms={key:1,scope:"col",class:"px-6 py-4 text-center"},vs={class:"whitespace-nowrap px-1 text-center"},_s={key:0,class:"w-full relative flex flex-wrap items-stretch"},bs=t("span",{class:"w-1/4 select-none flex items-center whitespace-nowrap rounded-l border border-r-0 border-solid border-neutral-300 px-1 py-[0.25rem] text-center text-xs font-normal leading-[1.6] text-neutral-700",id:"basic-addon1"},"R$",-1),gs=["max","onUpdate:modelValue"],hs={key:1},xs={class:"whitespace-nowrap px-1 py-4 text-center"},ys={key:0,class:"w-full relative flex flex-wrap items-stretch"},fs=["max","onUpdate:modelValue"],ps={key:1},$s={class:"whitespace-nowrap px-1 py-4 text-center"},ws={key:0,class:"w-full relative flex flex-wrap items-stretch"},ks=["onUpdate:modelValue"],Vs=H('<option value="pix">PIX</option><option value="dinheiro">Dinheiro</option><option value="cartao_credito">Cartão de Crédito</option><option value="cartao_debito">Cartão de Débito</option><option value="ted">TED</option><option value="cheque">Cheque</option>',6),Ds=[Vs],Cs={key:1},Ss={key:0,class:"whitespace-nowrap px-6 py-4 select-none"},qs={key:1,class:"whitespace-nowrap px-6 py-4 select-none"},Us={key:2,class:"text-red-500 text-sm"},Rs={key:3,class:"text-red-500 text-sm"},Es={key:0,class:"text-red-500 text-sm py-5 text-center"},js={key:1,class:"text-red-500 text-sm py-5 text-center"},zs={key:2,class:"text-red-500 text-sm py-5 text-center"},Ns={key:7,class:"py-5 text-gray-400 text-center"},Ts={__name:"ServiceRecordsListSection",props:{modal_mode:String,service:Object,record_form:Object,remaining_amount:Number,invalid_record_date:Boolean,invalid_record_amount:Boolean},emits:["add-record","remove-record"],setup(e,{emit:V}){const l=V,o=e,h=k(()=>o.service.records_list.data.sort((f,v)=>new Date(f.date)-new Date(v.date))),g=()=>{l("add-record")},y=(f,v)=>{l("remove-record",f,v)};return(f,v)=>(s(),a("section",xt,[e.modal_mode==="create"?(s(),a("div",yt,$t)):r("",!0),e.modal_mode==="update"?(s(),a("div",wt,Dt)):r("",!0),e.modal_mode==="pay"?(s(),a("div",Ct,Ut)):r("",!0),e.modal_mode==="see"?(s(),a("div",Rt,zt)):r("",!0),e.modal_mode!=="update"&&e.modal_mode!=="see"?(s(),a("div",Nt,[t("div",Tt,[Bt,t("div",It,[x(t("input",{id:"record-amount",name:"record-amount",type:"number",step:"0.01",min:"0",max:e.remaining_amount,autocomplete:"off",class:"simple-input disabled:bg-gray-200 disabled:opacity-75",disabled:e.remaining_amount==0,placeholder:"Valor do serviço parcial","onUpdate:modelValue":v[0]||(v[0]=d=>e.record_form.amount=d)},null,8,Lt),[[$,e.record_form.amount]]),t("p",Ot,"Valor Restante: "+u(_(j)(e.remaining_amount)),1),e.record_form.errors.amount?(s(),a("p",At,u(e.record_form.errors.amount),1)):r("",!0)])]),t("div",Pt,[Mt,t("div",Ft,[x(t("input",{id:"record-date",name:"record-date",type:"date",max:_(q)(),autocomplete:"off",class:"simple-input disabled:bg-gray-200",disabled:e.remaining_amount==0,placeholder:"Data de serviço do valor parcial","onUpdate:modelValue":v[1]||(v[1]=d=>e.record_form.register_date=d)},null,8,Ht),[[$,e.record_form.register_date]]),Xt,e.record_form.errors.register_date?(s(),a("p",Wt,u(e.record_form.errors.register_date),1)):r("",!0)])]),t("div",Gt,[Jt,t("div",Kt,[x(t("select",{name:"payment_method",class:"simple-input","onUpdate:modelValue":v[2]||(v[2]=d=>e.record_form.payment_method=d)},Yt,512),[[L,e.record_form.payment_method]]),e.record_form.errors.payment_method?(s(),a("p",Zt,u(e.record_form.errors.payment_method),1)):r("",!0)])])])):r("",!0),e.modal_mode!=="update"&&e.modal_mode!=="see"?(s(),a("div",es,[t("button",{type:"button",class:"w-full px-4 py-2 bg-blue-600 border border-gray-300 rounded-md font-semibold text-xs text-white uppercase tracking-widest shadow-sm hover:bg-blue-700 focus:outline-none focus:border-blue-300 focus:ring focus:ring-blue-200 active:text-gray-800 active:bg-gray-50 disabled:opacity-25 transition",disabled:!e.record_form.amount||!e.record_form.register_date||!e.record_form.payment_method||e.record_form.amount>e.remaining_amount,onClick:v[3]||(v[3]=d=>g())}," Inserir registro ",8,ts)])):r("",!0),e.service.records_list.data.length?(s(),a("div",ss,[t("div",os,[t("div",as,[t("div",ds,[t("table",is,[t("thead",rs,[t("tr",null,[ls,ns,cs,e.modal_mode!=="create"?(s(),a("th",us,"Usuário ")):r("",!0),e.modal_mode!=="pay"&&e.modal_mode!=="see"?(s(),a("th",ms,"Excluir")):r("",!0)])]),t("tbody",null,[(s(!0),a(M,null,F(h.value,d=>{var C,c,D,i;return s(),a("tr",{class:"border-b bg-white",key:d.id},[t("td",vs,[e.modal_mode!=="update"&&!d.past?(s(),a("div",_s,[bs,x(t("input",{id:"record_item-amount-edit",name:"record_item-amount-edit",type:"number",step:"0.01",min:"0",max:e.remaining_amount,autocomplete:"off",class:"relative m-0 block min-w-0 flex-auto rounded-r border border-solid border-neutral-300 bg-transparent bg-clip-padding px-1 py-[0.25rem] text-xs font-normal leading-[1.6] text-neutral-700 outline-none transition duration-200 ease-in-out focus:z-[3] focus:border-primary focus:text-neutral-700 focus:shadow-[inset_0_0_0_1px_rgb(59,113,202)] focus:outline-none disabled:bg-gray-200",placeholder:"Editar serviço parcial","onUpdate:modelValue":n=>d.amount=n},null,8,gs),[[$,d.amount]])])):(s(),a("p",hs,u(_(j)(d.amount)),1))]),t("td",xs,[e.modal_mode!=="update"&&!d.past?(s(),a("div",ys,[x(t("input",{id:"record-date",name:"record-date",type:"date",max:_(q)(),autocomplete:"off",class:"w-full relative m-0 block min-w-0 flex-auto rounded-r border border-solid border-neutral-300 bg-transparent bg-clip-padding px-1 py-[0.25rem] text-xs font-normal leading-[1.6] text-neutral-700 outline-none transition duration-200 ease-in-out focus:z-[3] focus:border-primary focus:text-neutral-700 focus:shadow-[inset_0_0_0_1px_rgb(59,113,202)] focus:outline-none disabled:bg-gray-200",placeholder:"Data de serviço do valor parcial","onUpdate:modelValue":n=>d.register_date=n},null,8,fs),[[$,d.register_date]])])):(s(),a("p",ps,u(_(q)(d.register_date,!0)),1))]),t("td",$s,[e.modal_mode!=="update"&&!d.past?(s(),a("div",ws,[x(t("select",{name:"payment_method",class:"w-full relative m-0 block min-w-0 flex-auto rounded-r border border-solid border-neutral-300 bg-transparent bg-clip-padding px-1 py-[0.25rem] text-xs font-normal leading-[1.6] text-neutral-700 outline-none transition duration-200 ease-in-out focus:z-[3] focus:border-primary focus:text-neutral-700 focus:shadow-[inset_0_0_0_1px_rgb(59,113,202)] focus:outline-none disabled:bg-gray-200","onUpdate:modelValue":n=>d.payment_method=n},Ds,8,ks),[[L,d.payment_method]])])):(s(),a("p",Cs,u(_(ee)(d.payment_method)),1))]),e.modal_mode!=="create"?(s(),a("td",Ss,u(((c=(C=d==null?void 0:d.procedure)==null?void 0:C.user)==null?void 0:c.name)||f.$page.props.auth.user.name||"Não identificado"),1)):r("",!0),e.modal_mode!=="pay"&&e.modal_mode!=="see"?(s(),a("td",qs,[R(_(se),{class:"w-5 h-5 cursor-pointer m-auto text-gray-700 hover:text-red-500 active:text-red-700",onClick:n=>y(d.id,d),title:"Remover este registro"},null,8,["onClick"])])):r("",!0),(D=d.errors)!=null&&D.amount?(s(),a("p",Us,u(d.errors.amount),1)):r("",!0),(i=d.errors)!=null&&i.date?(s(),a("p",Rs,u(d.errors.date),1)):r("",!0)])}),128))])]),e.remaining_amount<0?(s(),a("p",Es,"A soma dos serviços não pode ser maior que "+u(_(j)(e.service.total_value)),1)):r("",!0),e.invalid_record_date?(s(),a("p",js,"Todas as datas de registro devem ser não nulas e menores ou iguais a "+u(_(q)(new Date)),1)):r("",!0),e.invalid_record_amount?(s(),a("p",zs,"Todos os valores devem ser maiores que R$ 0,00")):r("",!0)])])])])):(s(),a("div",Ns,"Não há registro de pagamento no momento."))]))}},Bs={class:"pb-12 space-y-12 divide-y-2"},Js={__name:"CreateUpdatePayModal",props:{modal:Object,service:{type:Object,default:null},sells_list:{type:Array,default:[]}},emits:["close","submit"],setup(e,{emit:V}){const l=V,o=e,h=k(()=>o.service.records_list.data.length+1),g=k(()=>d.value&&o.service.total_value-o.service.records_list.data.reduce((b,p)=>b+p.amount,0)),y=k(()=>{const b=new Date;return o.service.records_list.data.some(p=>new Date(p.date)>b)}),f=k(()=>o.service.records_list.data.some(b=>b.amount<=0)),v=k(()=>o.modal.mode==="pay"||o.modal.mode==="see"),d=k(()=>o.modal.mode!=="create"||o.service.records_list.enable_records),C=k(()=>{var b;return!!(o.service.title.length&&((b=o.service)!=null&&b.client_id)&&o.service.total_value>0)});A(()=>[o.service.service_value,o.service.previous_id],([b,p])=>{const w=parseFloat(b)||0,I=o.sells_list.find(W=>W.id===p),X=I?parseFloat(I.accounting.total_value):0;o.service.total_value=w+X},{immediate:!0});const c=O({amount:0,past:!1,register_date:q(),payment_method:"cartao_credito",filepath:null}),D=z(!1),i=()=>{if(o.service.records_list.enable_records&&o.service.records_list.data.length)if(confirm("Tem certeza que deseja desmarcar? Todos os registros serão excluídos!"))o.service.records_list.data.length=0,c.reset();else return;o.service.records_list.enable_records=!o.service.records_list.enable_records},n=()=>{if(!c.amount||c.amount>g.value){c.errors.amount=`O valor do registro deve ser maior que R$ 0,00 e menor que ${j(g.value)}`;return}if(c.errors.amount="",!c.register_date||new Date(c.register_date)>new Date){c.errors.date=`A data do registro deve ser menor ou igual a ${q()}`;return}if(c.errors.date="",!c.payment_method){c.errors.payment_method="Um método de pagamento deve ser selecionado";return}c.errors.payment_method="",D.value||(c.filepath=null),o.service.records_list.data.push({id:h.value,amount:c.amount,past:c.past,register_date:c.register_date,payment_method:c.payment_method,filepath:c.filepath}),D.value=!1,c.reset()},m=(b,p=null)=>{if(o.modal.mode==="create"){o.service.records_list.data=o.service.records_list.data.filter(w=>w.id!==b);return}else confirm("Você tem certeza que deseja excluir esse registro? (Essa ação não pode ser desfeita)")&&O({}).delete(route("records.destroy",b),{preserveScroll:!0,onSuccess:()=>{o.service.records_list.data=o.service.records_list.data.filter(w=>w.id!==b)},onError:w=>{console.error("Erro ao deletar registro:",w),alert("Erro ao deletar registro. Verifique o console para mais detalhes.")}})},E=()=>{l("close")},T=()=>{l("submit")};return(b,p)=>(s(),S(K,{show:e.modal.show,onClose:E},{icon:U(()=>[t("div",{class:N(["mx-auto shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-400 sm:mx-0 sm:h-10 sm:w-10",{"bg-yellow-400":e.modal.mode==="update","bg-green-400":e.modal.mode==="pay","bg-gray-400":e.modal.mode==="see"}])},[e.modal.mode==="create"?(s(),S(_(oe),{key:0,class:"w-5 h-5 text-white"})):r("",!0),e.modal.mode==="update"?(s(),S(_(ae),{key:1,class:"w-5 h-5 text-white"})):r("",!0),e.modal.mode==="pay"?(s(),S(_(de),{key:2,class:"w-5 h-5 text-white"})):r("",!0),e.modal.mode==="see"?(s(),S(_(ie),{key:3,class:"w-5 h-5 text-white"})):r("",!0)],2)]),title:U(()=>[B(u(e.modal.title),1)]),content:U(()=>[t("form",{onSubmit:P(T,["prevent"])},[t("div",Bs,[R(ct,{service:e.service,sells_list:e.sells_list,disable_services_inputs:v.value,modal_mode:e.modal.mode},null,8,["service","sells_list","disable_services_inputs","modal_mode"]),R(ht,{modal_mode:e.modal.mode,can_add_record:C.value,enable_records:e.service.records_list.enable_records,onToggleEnableRecords:i},null,8,["modal_mode","can_add_record","enable_records"]),d.value?(s(),S(Ts,{key:0,modal_mode:e.modal.mode,service:e.service,record_form:_(c),remaining_amount:g.value,invalid_record_date:y.value,invalid_record_amount:f.value,onAddRecord:n,onRemoveRecord:m},null,8,["modal_mode","service","record_form","remaining_amount","invalid_record_date","invalid_record_amount"])):r("",!0)])],32)]),footer:U(()=>[e.modal.mode!=="see"?(s(),S(Y,{key:0,class:N({disabled:e.service.processing}),onClick:p[0]||(p[0]=w=>E())},{default:U(()=>[B(" Cancelar ")]),_:1},8,["class"])):r("",!0),R(Q,{class:N({disabled:e.service.processing||g.value<0||y.value||f.value}),disabled:e.service.processing||g.value<0||y.value||f.value,onClick:p[1]||(p[1]=w=>e.modal.mode==="see"?E():T())},{default:U(()=>[B(u(e.modal.primary_button_txt),1)]),_:1},8,["class","disabled"])]),_:1},8,["show"]))}};export{Js as _};
