import{k as b,c as U,o as s,w as j,b as M,f as g,d as a,e as k,a as t,t as l,u as c,F as f,g as y,n as B,r as H,T as E,p as F,E as K,s as $,v as O,x as V}from"./app-nxAEGYom.js";import{f as A}from"./general-D_37hS-e.js";import{_ as R}from"./CreateUpdateModal-Cr9-t6ta.js";import{_ as J}from"./SecondaryButton-BQZMIPc2.js";import{r as z}from"./EyeIcon-DwYvHqED.js";import"./Modal-BAbBhbNO.js";const I={class:"mx-auto shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10"},W={class:"capitalize"},q={key:0,class:"text-sm text-gray-600 mb-6 border-b pb-4"},G={key:1,class:"text-center text-gray-500 py-4"},P={key:2},Q={key:0},X=t("h3",{class:"text-base/7 font-semibold text-gray-900"},[g("Campos Alterados "),t("span",{class:"text-xs text-neutral-400"},"(os campos editados estão em destaque)")],-1),Y={class:"mt-6 border-t border-gray-100"},Z={class:"divide-y divide-gray-200"},ee={class:"text-sm/6 font-medium text-gray-900 capitalize"},te={class:"mt-1 text-sm/6 text-gray-700 sm:col-span-2 sm:mt-0"},se={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ae=t("span",{class:"text-red-500"},"Antes:",-1),re=["innerHTML"],oe=t("span",{class:"text-green-500"},"Depois:",-1),de=["innerHTML"],le={key:1},ne=t("h3",{class:"text-base/7 font-semibold text-gray-900"},"Dados Criados",-1),ie={class:"mt-6 border-t border-gray-100"},ce={class:"divide-y divide-gray-200"},ue={class:"text-sm/6 font-medium text-gray-900 capitalize"},me=["innerHTML"],pe={key:2},_e=t("h3",{class:"text-base/7 font-semibold text-gray-900"},"Dados Excluídos",-1),fe={class:"mt-6 border-t border-gray-100"},xe={class:"divide-y divide-gray-200"},ye={class:"text-sm/6 font-medium text-gray-900 capitalize"},he=["innerHTML"],ge={key:3},ve=t("h3",{class:"text-base/7 font-semibold text-gray-900"},"Dados do Objeto no Momento da Ação",-1),be={class:"mt-6 border-t border-gray-100"},$e={class:"divide-y divide-gray-200"},ke={class:"text-sm/6 font-medium text-gray-900 capitalize"},we=["innerHTML"],De={__name:"AuditDetailModal",props:{show:{type:Boolean,default:!1},procedure:{type:Object,default:null}},emits:["close"],setup(u,{emit:h}){const w=h,_=u,o=()=>{w("close")},x=b(()=>{var e,n;return(n=(e=_.procedure)==null?void 0:e.records)!=null&&n.length&&_.procedure.records.find(r=>r.before_state||r.after_state)||null}),v=b(()=>{var n,r,m;const e=(m=(r=(n=_.procedure)==null?void 0:n.action)==null?void 0:r.type)==null?void 0:m.toLowerCase();return e?["create","update","delete"].includes(e)?e:"custom":"unknown"}),C=b(()=>{var e,n;return(n=(e=_.procedure)==null?void 0:e.action)!=null&&n.name?`Detalhes: ${_.procedure.action.name}`:"Detalhes da Ação"}),D=b(()=>{var e;return((e=x.value)==null?void 0:e.before_state)||{}}),i=b(()=>{var e;return((e=x.value)==null?void 0:e.after_state)||{}}),d=b(()=>{if(v.value!=="update"||!x.value)return[];const e=Object.keys(D.value),n=Object.keys(i.value),r=new Set([...e,...n]);["id","created_at","updated_at","deleted_at","auditable_id","auditable_type"].forEach(T=>r.delete(T));const L=[];return r.forEach(T=>{const N=D.value[T],S=i.value[T];JSON.stringify(N)!==JSON.stringify(S)&&L.push({field:T.replace(/_/g," "),before:N,after:S})}),L}),p=e=>{if(e==null)return'<span class="italic text-gray-500">N/A</span>';if(e===!0)return"Sim";if(e===!1)return"Não";if(typeof e=="string"){if(e.startsWith("public/img/"))return`<img src="${`/storage/${e.replace("public/","")}`}" alt="Imagem do item" class="max-w-xs max-h-48 rounded-lg shadow-md border" onerror="this.onerror=null;this.src='/storage/img/items/default.jpeg'">`;let n=/^\d{4}-\d{2}-\d{2}$/;if(n.test(e))return A(e);if(n=/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/,n.test(e))return A(e,"reading_date_time");try{const r=JSON.parse(e);if(Array.isArray(r))return r.join(", ")}catch{}}return typeof e=="object"?`<pre class="whitespace-pre-wrap text-xs bg-gray-100 p-2 rounded">${JSON.stringify(e,null,2)}</pre>`:String(e)};return(e,n)=>(s(),U(R,{show:u.show,onClose:o,"max-width":"5xl"},{icon:j(()=>[t("div",I,[M(c(z),{class:"w-6 h-6 text-blue-600"})])]),title:j(()=>[t("label",W,l(C.value),1)]),content:j(()=>[u.procedure?(s(),a("div",q,[g(" Ação realizada por "),t("strong",null,l(u.procedure.user.name),1),g(" em "),t("strong",null,l(c(A)(u.procedure.created_at,"reading_date_time")),1),g(" no departamento de "),t("strong",null,l(u.procedure.department.name),1),g(". ")])):k("",!0),x.value?(s(),a("div",P,[v.value==="update"?(s(),a("div",Q,[X,t("div",Y,[t("dl",Z,[(s(!0),a(f,null,y(d.value,r=>(s(),a("div",{key:r.field,class:B(["px-4 py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0",{"bg-yellow-100":r.before!=r.after}])},[t("dt",ee,l(r.field),1),t("dd",te,[t("div",se,[t("div",null,[ae,t("div",{class:"mt-1 break-words flex justify-center sm:justify-start",innerHTML:p(r.before)},null,8,re)]),t("div",null,[oe,t("div",{class:"mt-1 break-words flex justify-center sm:justify-start",innerHTML:p(r.after)},null,8,de)])])])],2))),128))])])])):v.value==="create"?(s(),a("div",le,[ne,t("div",ie,[t("dl",ce,[["id","created_at","updated_at","deleted_at","auditable_id","auditable_type"].includes(e.key)?k("",!0):(s(!0),a(f,{key:0},y(i.value,(r,m)=>(s(),a("div",{key:m,class:"px-4 py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0"},[t("dt",ue,l(m.replace(/_/g," ")),1),t("dd",{class:"mt-1 text-sm/6 text-gray-700 sm:col-span-2 sm:mt-0 break-words flex justify-center sm:justify-start",innerHTML:p(r)},null,8,me)]))),128))])])])):v.value==="delete"?(s(),a("div",pe,[_e,t("div",fe,[t("dl",xe,[["id","created_at","updated_at","deleted_at","auditable_id","auditable_type"].includes(e.key)?k("",!0):(s(!0),a(f,{key:0},y(D.value,(r,m)=>(s(),a("div",{key:m,class:"px-4 py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0"},[t("dt",ye,l(m.replace(/_/g," ")),1),t("dd",{class:"mt-1 text-sm/6 text-gray-700 sm:col-span-2 sm:mt-0 break-words flex justify-center sm:justify-start",innerHTML:p(r)},null,8,he)]))),128))])])])):(s(),a("div",ge,[ve,t("div",be,[t("dl",$e,[["id","created_at","updated_at","deleted_at","auditable_id","auditable_type"].includes(e.key)?k("",!0):(s(!0),a(f,{key:0},y(i.value,(r,m)=>(s(),a("div",{key:m,class:"px-4 py-2 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0"},[t("dt",ke,l(m.replace(/_/g," ")),1),t("dd",{class:"mt-1 text-sm/6 text-gray-700 sm:col-span-2 sm:mt-0 break-words flex justify-center sm:justify-start",innerHTML:p(r)},null,8,we)]))),128))])])]))])):(s(),a("div",G," Nenhum detalhe de alteração encontrado para esta ação. "))]),footer:j(()=>[M(J,{onClick:o},{default:j(()=>[g(" Fechar ")]),_:1})]),_:1},8,["show"]))}},Te=t("div",{class:"w-full rounded-lg bg-neutral-200 text-neutral-700 uppercase text-xl font-bold text-center p-2 my-10"}," Registro de Atividades ",-1),je={class:"grid grid-cols-2 lg:grid-cols-5 gap-3 print:hidden"},Ae=t("label",{for:"filter-procedure-start_date",class:"text-xs text-neutral-500"},"Data (início)",-1),Me=t("label",{for:"filter-procedure-end_date",class:"text-xs text-neutral-500"},"Data (fim)",-1),Ce=t("label",{for:"filter-procedure-user",class:"text-xs text-neutral-500"},"Usuário",-1),Ve=t("option",{value:0},"Todos",-1),Le=["value"],Ne=t("label",{for:"filter-procedure-action",class:"text-xs text-neutral-500"},"Ação",-1),Se=t("option",{value:0},"Todos",-1),He=["value"],Oe=t("label",{for:"filter-procedure-department",class:"text-xs text-neutral-500"},"Departamento",-1),ze=t("option",{value:0},"Todos",-1),Ue=["value"],Be={class:"col-span-full flex justify-end mt-2 gap-5"},Ee={class:"overflow-x-auto"},Fe={key:0,class:"table-auto min-w-full divide-y divide-neutral-200 my-5"},Ke=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left text-sm font-medium text-neutral-900"}," Usuário "),t("th",{scope:"col",class:"px-6 py-3 text-left text-sm font-medium text-neutral-900"}," Ação "),t("th",{scope:"col",class:"px-6 py-3 text-left text-sm font-medium text-neutral-900"}," Departamento"),t("th",{scope:"col",class:"px-6 py-3 text-left text-sm font-medium text-neutral-900"}," Data "),t("th",{scope:"col",class:"px-6 py-3 text-center text-sm font-medium text-neutral-900"}," Detalhes ")])],-1),Re={class:"bg-white divide-y divide-neutral-200"},Je={class:"px-6 py-4 text-sm text-neutral-900"},Ie={class:"px-6 py-4 text-sm capitalize"},We={class:"px-6 py-4 text-sm"},qe={key:0},Ge={key:1},Pe={class:"px-6 py-4 text-sm text-neutral-500"},Qe={class:"px-6 py-4 text-sm text-center"},Xe=["onClick"],Ye={key:1,class:"text-sm text-neutral-500 text-center pt-5"},ot={__name:"Atividades",props:{procedures:Array,parameters:Object,users:Array,actions:Array,departments:Array},setup(u){const h=u,w=H(!1),_=H(null),o=E({user:h.parameters.user,action:h.parameters.action,department:h.parameters.department,start_date:h.parameters.start_date,end_date:h.parameters.end_date}),x=()=>{let i;clearTimeout(i),i=setTimeout(()=>{o.get(route("dashboard.index"),{preserveScroll:!0,replace:!0})},300)};F([()=>o.user,()=>o.department,()=>o.action],i=>{x()},{deep:!0});const v=()=>{_.value=null,w.value=!1},C=()=>{const i=new Date,d=new Date;d.setDate(i.getDate()-2);const p=e=>e.toISOString().split("T")[0];o.user=0,o.action=0,o.department=0,o.start_date=p(d),o.end_date=p(i)},D=i=>{_.value=i,w.value=!0};return(i,d)=>{const p=K("i");return s(),a(f,null,[Te,t("div",je,[t("div",null,[Ae,$(t("input",{id:"filter-procedure-start_date",type:"date",class:"simple-input","onUpdate:modelValue":d[0]||(d[0]=e=>c(o).start_date=e),onChange:d[1]||(d[1]=e=>x())},null,544),[[O,c(o).start_date]])]),t("div",null,[Me,$(t("input",{id:"filter-procedure-end_date",type:"date",class:"simple-input","onUpdate:modelValue":d[2]||(d[2]=e=>c(o).end_date=e),onChange:d[3]||(d[3]=e=>x())},null,544),[[O,c(o).end_date]])]),t("div",null,[Ce,$(t("select",{id:"filter-procedure-user",class:"simple-select","onUpdate:modelValue":d[4]||(d[4]=e=>c(o).user=e)},[Ve,(s(!0),a(f,null,y(u.users,e=>(s(),a("option",{value:e.id,key:e.id},l(e.name)+" "+l(e.surname),9,Le))),128))],512),[[V,c(o).user]])]),t("div",null,[Ne,$(t("select",{id:"filter-procedure-action",class:"simple-select","onUpdate:modelValue":d[5]||(d[5]=e=>c(o).action=e)},[Se,(s(!0),a(f,null,y(u.actions,e=>(s(),a("option",{value:e.id,key:e.id,class:"capitalize"},l(e.past),9,He))),128))],512),[[V,c(o).action]])]),t("div",null,[Oe,$(t("select",{id:"filter-procedure-department",class:"simple-select","onUpdate:modelValue":d[6]||(d[6]=e=>c(o).department=e)},[ze,(s(!0),a(f,null,y(u.departments,e=>(s(),a("option",{value:e.id,key:e.id},l(e.name),9,Ue))),128))],512),[[V,c(o).department]])])]),t("div",Be,[t("button",{onClick:d[7]||(d[7]=e=>C()),class:"text-red-500 transition text-xs"}," Resetar filtros ")]),t("div",Ee,[u.procedures.length?(s(),a("table",Fe,[Ke,t("tbody",Re,[(s(!0),a(f,null,y(u.procedures,e=>(s(),a("tr",{key:e.id},[t("td",Je,l(e.user.name)+" "+l(e.user.surname),1),t("td",Ie,l(e.action.past),1),t("td",We,[e.department.type==="payslip"?(s(),a("span",qe,"Registro de")):k("",!0),e.department.type==="warehouse"?(s(),a("span",Ge,"Item de")):k("",!0),g(" "+l(e.department.name),1)]),t("td",Pe,l(c(A)(e.created_at,"reading_date_time")),1),t("td",Qe,[$((s(),a("button",{onClick:n=>D(e),class:"mx-auto text-teal-600 hover:text-teal-900 focus:outline-none",title:"Ver Detalhes"},[M(c(z),{class:"w-5 h-5 text-green"})],8,Xe)),[[p]])])]))),128))])])):(s(),a("p",Ye,"Nenhum procedimento registrado no período especificado."))]),M(De,{show:w.value,procedure:_.value,onClose:v},null,8,["show","procedure"])],64)}}};export{ot as default};
