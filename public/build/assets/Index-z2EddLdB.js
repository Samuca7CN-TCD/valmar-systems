import{m as J,r as g,p as Z,y as _,T as G,d as n,o as r,b as c,u as l,Z as H,w as y,a as e,e as u,s as P,v as K,x as Q,F as b,g as V,t as a,n as B,i as A,f as C}from"./app-rFp3DUWb.js";import{_ as W}from"./AppLayout-Cy2iqO0z.js";import{t as X,f as S}from"./general-D_37hS-e.js";/* empty css                    */import{r as Y,_ as ee}from"./BudgetRejectionCancellationModal-ZfXl_BH2.js";import{_ as te}from"./FloatButton-DHxKhYNp.js";import{r as se}from"./MagnifyingGlassIcon-CHPdLIRt.js";import{r as oe}from"./EyeIcon-D_BBxVz2.js";import{r as ae}from"./PencilIcon-B49Thg9T.js";import{r as ne}from"./DocumentDuplicateIcon-bXVZqNlc.js";import{r as re}from"./XMarkIcon-CSIFDxXn.js";import{r as ie,a as le}from"./ChevronRightIcon-B0tH8hG0.js";import"./CreateUpdateModal-DUu5ohjo.js";import"./Modal-BjRRWiDu.js";import"./PrimaryButton-DYVP7xNc.js";import"./SecondaryButton-BdpO2WF3.js";import"./PlusIcon-Hj45r85u.js";import"./PrinterIcon-rfuh_9o_.js";const ce={class:"font-semibold text-xl text-gray-800 leading-tight"},de={class:"pt-12 print:hidden print:pt-0"},ue={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 print:w-full"},pe={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-5"},me={class:"flex flex-col sm:flex-row sm:items-center space-y-4 sm:space-y-0 sm:space-x-4"},he={class:"flex items-center space-x-3 flex-grow"},_e={class:"flex items-center space-x-2"},xe=e("label",{for:"status_filter",class:"text-sm font-medium text-gray-700 whitespace-nowrap"},"Status:",-1),fe=e("option",{value:""},"Todos",-1),ve=e("option",{value:"Rascunho"},"Rascunho",-1),ge=e("option",{value:"Enviado"},"Enviado",-1),ye=e("option",{value:"Aprovado"},"Aprovado",-1),be=e("option",{value:"Rejeitado"},"Rejeitado",-1),we=e("option",{value:"Cancelado"},"Cancelado",-1),Ce=[fe,ve,ge,ye,be,we],je={class:"py-12 print:py-0"},ke={class:"max-w-fit mx-auto print:max-w-full"},$e={class:"w-full flex justify-end pb-3 print:hidden px-6 sm:px-0"},Ee={class:"px-0 sm:px-0 print:px-0"},Te={class:"bg-white sm:rounded-xl print:shadow-none"},Oe={class:"flex flex-col"},Ae={class:"overflow-x-auto"},Se={class:"inline-block min-w-full"},Re={class:"overflow-hidden"},ze={class:"max-w-fit text-left text-sm font-light"},Me={class:"border-b bg-gray-50 font-medium"},Ne=e("th",{scope:"col",class:"px-3 py-3 text-center"},"#",-1),Pe=e("th",{scope:"col",class:"px-3 py-3 text-left"},"Titulo",-1),Ve=e("th",{scope:"col",class:"px-3 py-3 text-left"},"Cliente",-1),Be=e("th",{scope:"col",class:"px-3 py-3 text-left"},"Itens",-1),De=e("th",{scope:"col",class:"px-3 py-3 text-center"},"Valor Total",-1),qe=e("th",{scope:"col",class:"px-3 py-3 text-center"},"Data Orçamento",-1),Ie=e("th",{scope:"col",class:"px-3 py-3 text-center"},"Status",-1),Fe=e("th",{scope:"col",class:"px-3 py-3 text-center print:hidden"},"Ações ",-1),Le={key:0,scope:"col",class:"px-3 py-3 text-center print:hidden"},Ue={key:1,scope:"col",class:"px-3 py-3 text-center print:hidden"},Je={key:2,scope:"col",class:"px-3 py-3 text-center print:hidden"},Ze={key:3,scope:"col",class:"px-3 py-3 text-center print:hidden"},Ge={class:"whitespace-nowrap px-3 py-4 text-center font-medium"},He={class:"whitespace-nowrap px-3 py-4 text-left"},Ke={class:"whitespace-nowrap px-3 py-4 text-left"},Qe=["title"],We={class:"max-w-xs truncate"},Xe={class:"whitespace-nowrap px-3 py-4 text-center"},Ye={class:"whitespace-nowrap px-3 py-4 text-center"},et={class:"whitespace-nowrap px-3 py-4 text-center"},tt={class:"whitespace-nowrap px-3 py-4 text-center print:hidden"},st={class:"flex justify-center items-center space-x-5"},ot=["onClick"],at=["onClick"],nt=["onClick"],rt={key:0,class:"whitespace-nowrap px-6 py-4 text-center print:hidden"},it={key:1,class:"whitespace-nowrap px-6 py-4 text-center print:hidden"},lt={key:2,class:"whitespace-nowrap px-6 py-4 text-center print:hidden"},ct={key:3,class:"whitespace-nowrap px-6 py-4 text-center print:hidden"},dt={key:1},ut=e("td",{colspan:"10",class:"whitespace-nowrap px-6 py-4 text-center text-gray-500"}," Nenhum orçamento encontrado. ",-1),pt=[ut],mt={key:0,class:"flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6 mt-6"},ht={class:"flex flex-1 justify-between sm:hidden"},_t=["href","disabled"],xt=["href","disabled"],ft={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},vt={class:"text-sm text-gray-700"},gt={class:"font-medium"},yt={class:"font-medium"},bt={class:"font-medium"},wt={class:"isolate inline-flex -space-x-px rounded-md shadow-xs","aria-label":"Pagination"},Ct=["href","disabled"],jt=e("span",{class:"sr-only"},"Previous",-1),kt=["href","disabled","onClick"],$t={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700 ring-1 ring-gray-300 ring-inset focus:outline-offset-0"},Et=["href","disabled"],Tt=e("span",{class:"sr-only"},"Next",-1),Gt={__name:"Index",props:{page:Object,budgets_list:Object,filters:Object},setup(o){const j=o,m=J.useToast(),x=g(j.filters.search||""),f=g(j.filters.status||""),k=g(j.filters.client||"");let $=null;Z([x,f,k],()=>{$&&clearTimeout($),$=setTimeout(()=>{_.get(route("budgets.index"),{search:x.value,status:f.value,client:k.value},{preserveState:!0,replace:!0})},300)});const d=g(!1),E=g(!1),p=G({id:null,rejection_reason:null,cancellation_reason:null,actionType:null}),D=(i,s)=>{p.id=i,p.actionType=s,p.rejection_reason=null,p.cancellation_reason=null,E.value=!0},T=()=>{E.value=!1,p.reset()},q=()=>{p.actionType==="reject"?I(p.id,p.rejection_reason):p.actionType==="cancel"&&F(p.id,p.cancellation_reason)},I=(i,s)=>{if(!s||s.length<10){m.error("O motivo da rejeição deve ter pelo menos 10 caracteres.");return}confirm("Tem certeza que deseja REJEITAR este orçamento?")&&_.post(route("budgets.reject",i),{rejection_reason:s},{preserveScroll:!0,onSuccess:()=>{m.success("Orçamento rejeitado!"),T()},onError:t=>{console.error(t),m.error(t.message||"Erro ao rejeitar orçamento.")}})},F=(i,s)=>{if(!s||s.length<10){m.error("O motivo do cancelamento deve ter pelo menos 10 caracteres.");return}confirm("Tem certeza que deseja CANCELAR este orçamento?")&&_.post(route("budgets.cancel",i),{cancellation_reason:s},{preserveScroll:!0,onSuccess:()=>{m.success("Orçamento cancelado!"),T()},onError:t=>{console.error(t),m.error(t.message||"Erro ao cancelar orçamento.")}})},L=i=>{confirm("Tem certeza que deseja DUPLICAR este orçamento?")&&_.get(route("budgets.create",{duplicate_from:i}))},U=i=>{confirm("Tem certeza que deseja marcar este orçamento como ENVIADO?")&&_.post(route("budgets.send",i),{},{preserveScroll:!0,onSuccess:()=>m.success("Orçamento marcado como enviado!"),onError:s=>{console.error(s),m.error(s.message||"Erro ao marcar como enviado.")}})},v=i=>{i&&_.get(i,{search:x.value,status:f.value,client:k.value},{preserveState:!0,replace:!0})};return(i,s)=>(r(),n(b,null,[c(l(H),{title:o.page.name},null,8,["title"]),c(W,{page:o.page},{header:y(()=>[e("h2",ce,a(o.page.name),1),c(l(A),{href:i.route("budgets.create")},{default:y(()=>[c(te,{icon:"plus",title:"Cadastrar Orçamento",class:"print:hidden"})]),_:1},8,["href"])]),default:y(()=>[e("div",de,[e("div",ue,[e("div",pe,[e("div",me,[e("div",he,[c(l(se),{class:"w-4 h-4 text-gray-500"}),P(e("input",{type:"text",name:"search_term",id:"search_term",autocomplete:"on",class:"simple-input flex-grow",autofocus:"true",placeholder:"Pesquisar termo...","onUpdate:modelValue":s[0]||(s[0]=t=>x.value=t)},null,512),[[K,x.value]])]),e("div",_e,[xe,P(e("select",{id:"status_filter","onUpdate:modelValue":s[1]||(s[1]=t=>f.value=t),class:"simple-input"},Ce,512),[[Q,f.value]])])])])])]),e("div",je,[e("div",ke,[e("div",$e,[d.value?u("",!0):(r(),n("button",{key:0,class:"text-blue-500 text-xs",onClick:s[2]||(s[2]=t=>d.value=!d.value)},"Mostrar dados de usuário")),d.value?(r(),n("button",{key:1,class:"text-red-500 text-xs",onClick:s[3]||(s[3]=t=>d.value=!d.value)},"Esconder dados de usuário")):u("",!0)]),e("div",Ee,[e("div",Te,[e("div",Oe,[e("div",Ae,[e("div",Se,[e("div",Re,[e("table",ze,[e("thead",Me,[e("tr",null,[Ne,Pe,Ve,Be,De,qe,Ie,Fe,d.value?(r(),n("th",Le,"Criado Em")):u("",!0),d.value?(r(),n("th",Ue,"Criado Por")):u("",!0),d.value?(r(),n("th",Je,"Modificado Em")):u("",!0),d.value?(r(),n("th",Ze,"Modificado Por")):u("",!0)])]),e("tbody",null,[o.budgets_list.data.length?(r(!0),n(b,{key:0},V(o.budgets_list.data,t=>{var w,O,R,z,M,N;return r(),n("tr",{key:t.id,class:"border-b transition duration-300 ease-in-out hover:bg-neutral-100"},[e("td",Ge,a(t.id),1),e("td",He,a(t.title),1),e("td",Ke,a(((w=t==null?void 0:t.client)==null?void 0:w.name)||t.client_name),1),e("td",{class:"whitespace-nowrap px-3 py-4 text-left",title:t.items.map(h=>h.item_name).join("; ")},[e("div",We,a(t.items.map(h=>h.item_name).join("; ")),1)],8,Qe),e("td",Xe,a(l(X)(t.total_value)),1),e("td",Ye,a(l(S)(t.budget_date,!0)),1),e("td",et,[e("span",{class:B(["px-2.5 py-0.5 rounded-full text-xs font-medium",{"bg-gray-100 text-gray-800":t.status==="Rascunho","bg-blue-100 text-blue-800":t.status==="Enviado","bg-green-100 text-green-800":t.status==="Aprovado","bg-orange-100 text-orange-800":t.status==="Rejeitado","bg-red-100 text-red-800":t.status==="Cancelado"}])},a(t.status),3)]),e("td",tt,[e("div",st,[c(l(A),{href:i.route("budgets.show",t.id),class:"hover:text-blue-700",title:"Ver Orçamento"},{default:y(()=>[c(l(oe),{class:"w-4 h-4"})]),_:2},1032,["href"]),["Rascunho"].includes(t.status)&&!t.generated_service_id?(r(),n(b,{key:0},[c(l(A),{href:i.route("budgets.edit",t.id),class:"hover:text-yellow-700",title:"Editar Orçamento"},{default:y(()=>[c(l(ae),{class:"w-4 h-4"})]),_:2},1032,["href"]),e("button",{onClick:h=>U(t.id),class:"hover:text-blue-700",title:"Enviar Orçamento"},[c(l(Y),{class:"w-4 h-4"})],8,ot)],64)):u("",!0),e("button",{onClick:h=>L(t.id),class:"hover:text-purple-700",title:"Duplicar Orçamento"},[c(l(ne),{class:"w-4 h-4"})],8,at),!["Aprovado","Rejeitado","Cancelado"].includes(t.status)&&i.$page.props.auth.user.hierarchy<2?(r(),n("button",{key:1,onClick:h=>D(t.id,"cancel"),class:"hover:text-red-700",title:"Cancelar Orçamento"},[c(l(re),{class:"w-4 h-4"})],8,nt)):u("",!0)])]),d.value?(r(),n("td",rt,a(l(S)(t.created_at,"reading_date_time")),1)):u("",!0),d.value?(r(),n("td",it,a(((R=(O=t.procedures[0])==null?void 0:O.user)==null?void 0:R.name)||"-"),1)):u("",!0),d.value?(r(),n("td",lt,a(l(S)(t.updated_at,"reading_date_time")),1)):u("",!0),d.value?(r(),n("td",ct,a(((N=(M=t.procedures[((z=t.procedures)==null?void 0:z.length)-1])==null?void 0:M.user)==null?void 0:N.name)||"-"),1)):u("",!0)])}),128)):(r(),n("tr",dt,pt))])])])])])])])])])]),o.budgets_list.links.length>3?(r(),n("div",mt,[e("div",ht,[e("button",{href:o.budgets_list.prev_page_url,disabled:!o.budgets_list.prev_page_url,onClick:s[4]||(s[4]=t=>v(o.budgets_list.prev_page_url)),class:"relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"},"Previous",8,_t),e("button",{href:o.budgets_list.next_page_url,disabled:!o.budgets_list.next_page_url,onClick:s[5]||(s[5]=t=>v(o.budgets_list.next_page_url)),class:"relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"},"Next",8,xt)]),e("div",ft,[e("div",null,[e("p",vt,[C(" Mostrando "+a(" ")+" "),e("span",gt,a(o.budgets_list.from),1),C(" "+a(" ")+" à "+a(" ")+" "),e("span",yt,a(o.budgets_list.to),1),C(" "+a(" ")+" de "+a(" ")+" "),e("span",bt,a(o.budgets_list.total),1),C(" "+a(" ")+" registros ")])]),e("div",null,[e("nav",wt,[e("button",{href:o.budgets_list.prev_page_url,disabled:!o.budgets_list.prev_page_url,onClick:s[6]||(s[6]=t=>v(o.budgets_list.prev_page_url)),class:"relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-gray-300 ring-inset hover:bg-gray-50 focus:z-20 focus:outline-offset-0"},[jt,c(l(ie),{class:"size-5","aria-hidden":"true"})],8,Ct),(r(!0),n(b,null,V(o.budgets_list.links,(t,w)=>(r(),n(b,null,[t.url&&!["« Previous","Next »","..."].includes(t.label)?(r(),n("button",{key:w,href:t.url,disabled:!t.url,onClick:O=>v(t.url),"aria-current":"page",class:B(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus-visible:outline-2 focus-visible:outline-offset-2",{"z-10 bg-indigo-600 text-white focus-visible:outline-indigo-600":t.active,"text-gray-900 ring-1 ring-gray-300 ring-inset hover:bg-gray-50 focus:outline-offset-0":!t.active}])},a(t.label),11,kt)):!t.url&&t.label==="..."?(r(),n("span",$t,"...")):u("",!0)],64))),256)),e("button",{href:o.budgets_list.next_page_url,disabled:!o.budgets_list.next_page_url,onClick:s[7]||(s[7]=t=>v(o.budgets_list.next_page_url)),class:"relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-gray-300 ring-inset hover:bg-gray-50 focus:z-20 focus:outline-offset-0"},[Tt,c(l(le),{class:"size-5","aria-hidden":"true"})],8,Et)])])])])):u("",!0),c(ee,{show:E.value,budget:l(p),onSubmit:q,onClose:T},null,8,["show","budget"])]),_:1},8,["page"])],64))}};export{Gt as default};
