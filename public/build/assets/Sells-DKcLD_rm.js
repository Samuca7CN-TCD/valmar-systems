import{l as S,d as N,o,c as R,w as $,a as e,n as U,u as m,f as u,g as b,t as n,i as X,p as V,v as C,e as i,F as B,h as F,b as q,T as Z,Z as H}from"./app-B9AaS3di.js";import{_ as J}from"./AppLayout-BpgBCMDE.js";import{r as K,f as Q,t as v,_ as Y,a as ee,b as te}from"./general-CT66CFmJ.js";import{_ as se}from"./PrimaryButton-C6t27UzX.js";import{_ as ae}from"./SecondaryButton-DopaOyGA.js";import{r as le}from"./PrinterIcon-CisfNOAW.js";import{r as oe}from"./BanknotesIcon-D31jRm2d.js";import{r as W}from"./EyeIcon-EVOI874d.js";import{_ as ne}from"./FloatButton-Ci1qFIeh.js";import"./Modal-tn0Up1zP.js";const ie={class:"pb-12 space-y-12 divide-y-2"},de={class:"py-4"},re=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Informações Básicas",-1),ce=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Informações sobre a venda como nome do cliente, data da venda e observações",-1),ue={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"},me={class:"sm:col-span-3"},pe=e("label",{for:"sell-client",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Cliente",-1),ge={class:"mt-2"},_e={key:0,class:"text-red-500 text-sm"},he={class:"sm:col-span-3"},xe=e("label",{for:"sell-date",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Data da Venda",-1),ye={class:"mt-2"},ve=["max"],fe={key:0,class:"text-red-500 text-sm"},be={class:"sm:col-span-6"},we=e("label",{for:"sell-observations",class:"block text-sm font-medium leading-6 text-gray-900"},"Observações",-1),ke={class:"mt-2"},qe={key:0,class:"text-red-500 text-sm"},$e={key:0,class:"py-4"},Ve=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Lista de Itens",-1),Ce=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Adicione os itens da venda bem como descontos e valor de pagamento de entrada.",-1),Se={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-4"},Ie={class:"sm:col-span-4"},De={class:"relative"},Le=e("label",{for:"item-selecter",class:"block text-sm font-medium leading-6 text-gray-900"},"Selecione os itens de venda",-1),Me=["disabled"],Re={key:0,class:"absolute z-10 w-full mx-auto sm:w-96 bg-white border rounded mt-2 h-96 overflow-y-scroll"},Ue=["onMousedown"],Oe={class:"md:col-span-2 lg:col-span-1"},je=e("label",{for:"sell-estimated-amount",class:"block text-sm font-medium leading-6 text-gray-900"},"Valor estimado ",-1),Ae={class:"relative mt-2 rounded-md shadow-sm"},Ee=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1),Te=["disabled"],Ne={key:0,class:"text-red-500 text-sm"},Be={class:"md:col-span-2 lg:col-span-1"},Pe=e("label",{for:"sell-total-amount",class:"block text-sm font-medium leading-6 text-gray-900"},"Valor final ",-1),ze={class:"relative mt-2 rounded-md shadow-sm"},Fe=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1),Qe=["disabled","value"],We={key:0,class:"text-red-500 text-sm"},Ge={class:"md:col-span-2 lg:col-span-1"},Xe=e("label",{for:"sell-discount-percent",class:"block text-sm font-medium leading-6 text-gray-900"},"Desconto (%) ",-1),Ze={class:"relative mt-2 rounded-md shadow-sm"},He=["disabled","value"],Je=e("div",{class:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3"},[e("span",{class:"text-gray-500 sm:text-sm"},"%")],-1),Ke={key:0,class:"text-red-500 text-sm"},Ye={class:"md:col-span-2 lg:col-span-1"},et=e("label",{for:"sell-discount",class:"block text-sm font-medium leading-6 text-gray-900"},"Desconto (R$) ",-1),tt={class:"relative mt-2 rounded-md shadow-sm"},st=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1),at=["disabled","value"],lt={key:0,class:"text-red-500 text-sm"},ot={class:"sm:col-span-4"},nt={key:0,class:"min-w-full text-left block text-sm font-medium leading-6 text-gray-900"},it={class:"border-b font-medium dark:border-neutral-500"},dt=e("th",{scope:"col",class:"px-6 py-4 text-center"},"#",-1),rt=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Item",-1),ct=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Qtd. Estoque",-1),ut=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Qtd. Venda",-1),mt=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Und. Medida",-1),pt=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Preço unitário",-1),gt=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Preço montante",-1),_t={key:0,scope:"col",class:"px-6 py-4 text-center"},ht={class:"whitespace-nowrap py-4 text-center font-medium"},xt={class:"whitespace-nowrap py-4 text-center font-medium"},yt={class:"whitespace-nowrap py-4 text-center font-medium flex justify-center"},vt=["value","onInput","disabled"],ft={class:"whitespace-nowrap py-4 text-center font-medium"},bt={class:"whitespace-nowrap py-4 text-center font-medium"},wt={class:"whitespace-nowrap py-4 text-center font-medium"},kt={key:0,class:"whitespace-nowrap py-4 text-center font-mono text-2xl"},qt=["onClick","title"],$t={key:1,class:"p-5 bg-gray-200 rounded-md block text-sm font-medium leading-6 text-gray-900"},Vt={key:1,class:"w-full py-4"},Ct=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Pagamento de entrada",-1),St=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Após a conclusão da compra, um registro de pagamento será criado na página de PAGAMENTOS. ",-1),It=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Se algum pagamento de entrada (ou pagamento total) for realizado, registre aqui.",-1),Dt={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-4"},Lt={class:"md:col-span-2 lg:col-span-1 text-gray-700"},Mt={class:"font-extrabold text-green-500"},Rt={class:"md:col-span-2 lg:col-span-1 text-gray-700"},Ut={class:"font-extrabold text-green-500"},Ot={class:"md:col-span-2 lg:col-span-1 text-gray-700"},jt={class:"font-extrabold text-green-500"},At={class:"md:col-span-2 lg:col-span-1 text-gray-700"},Et={class:"font-extrabold text-green-500"},Tt={class:"sm:col-span-2"},Nt=e("label",{for:"sell-entry-value",class:"block text-sm font-medium leading-6 text-gray-900"},"Pagamento de entrada ",-1),Bt={class:"relative mt-2 rounded-md shadow-sm"},Pt=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1),zt=["disabled"],Ft={key:0,class:"text-red-500 text-sm"},Qt={class:"sm:col-span-2"},Wt=e("label",{for:"sell-partial-value",class:"block text-sm font-medium leading-6 text-gray-900"},"Valor restante ",-1),Gt={class:"relative mt-2 rounded-md shadow-sm"},Xt=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1),Zt=["disabled","value"],Ht={key:0,class:"text-red-500 text-sm"},Jt={__name:"CreateUpdateSellsModal",props:{modal:Object,sell:{type:Object,default:null},items:Array},emits:["close","submit"],setup(s,{emit:O}){const r=O,c=s,j=/^\d{4}-\d{2}-\d{2}$/,A=S(()=>{const{client:l,date:a}=c.sell;return!l||!l.length?!1:a&&j.test(a)}),w=S(()=>{const{client:l,date:a,estimated_value:t,total_value:p,entry_value:f,items_list:G}=c.sell;return!l||!l.length||!a||!j.test(a)||!(t>0&&p>0&&f<=p)?!1:G.every(z=>z.quantity>0&&z.movement_quantity<=z.quantity)}),E=S(()=>c.sell.total_value-c.sell.entry_value),h=S(()=>c.modal.mode==="see"),I=N(""),D=N(!1),P=S(()=>c.items.filter(l=>l.name.toLowerCase().includes(I.value.toLowerCase())&&!c.sell.items_list.some(a=>a.id===l.id))),T=l=>{l==="in"&&(D.value=!0),l==="out"&&(D.value=!1)},g=()=>{c.sell.estimated_value=c.sell.items_list.reduce((l,a)=>l+a.price*a.movement_quantity,0),k("estimated_value")},_=l=>{c.sell.items_list.push({id:l.id,name:l.name,quantity:l.quantity,max_quantity:l.max_quantity,min_quantity:l.min_quantity,movement_quantity:1,measurement_unit:l.measurement_unit.abbreviation,price:l.price,amount:l.price}),I.value="",D.value=!1,g()},d=l=>{c.sell.items_list=c.sell.items_list.filter(a=>a.id!==l),g()},y=(l,a)=>{c.sell[a]=l.target.value,k(a)},x=(l,a)=>{const t=10**a;return Math.floor(l*t)/t},k=l=>{let{estimated_value:a,total_value:t,discount_percent:p,discount:f}=c.sell;switch(l){case"estimated_value":case"discount_percent":t=a*(1-p/100),f=a-t;break;case"total_value":f=a-t,p=f/a*100;break;case"discount":p=f/a*100,t=a-f;break}Object.assign(c.sell,{estimated_value:a,total_value:t,discount_percent:p,discount:f})},L=()=>{r("close")},M=()=>{r("submit")};return(l,a)=>(o(),R(Y,{show:s.modal.show,maxWidth:A.value||h.value?"6xl":"2xl",onClose:L},{icon:$(()=>[e("div",{class:U(["mx-auto shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-400 sm:mx-0 sm:h-10 sm:w-10",{"bg-yellow-400":s.modal.mode==="update","bg-green-400":s.modal.mode==="pay","bg-gray-400":s.modal.mode==="see"}])},[s.modal.mode==="create"?(o(),R(m(le),{key:0,class:"w-5 h-5 text-white"})):u("",!0),s.modal.mode==="update"?(o(),R(m(K),{key:1,class:"w-5 h-5 text-white"})):u("",!0),s.modal.mode==="pay"?(o(),R(m(oe),{key:2,class:"w-5 h-5 text-white"})):u("",!0),s.modal.mode==="see"?(o(),R(m(W),{key:3,class:"w-5 h-5 text-white"})):u("",!0)],2)]),title:$(()=>[b(n(s.modal.title),1)]),content:$(()=>[e("form",{onSubmit:X(M,["prevent"])},[e("div",ie,[e("section",de,[re,ce,e("div",ue,[e("div",me,[pe,e("div",ge,[V(e("input",{type:"text",name:"sell-client",id:"sell-client",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Nome do cliente","onUpdate:modelValue":a[0]||(a[0]=t=>s.sell.client=t),required:""},null,512),[[C,s.sell.client]]),s.sell.errors.client?(o(),i("p",_e,n(s.sell.errors.client),1)):u("",!0)])]),e("div",he,[xe,e("div",ye,[V(e("input",{type:"date",name:"sell-date",id:"sell-date",autocomplete:"on",class:"simple-input disabled:bg-gray-200",autofocus:"true",placeholder:"Data da Venda",max:m(Q)(),"onUpdate:modelValue":a[1]||(a[1]=t=>s.sell.date=t),required:""},null,8,ve),[[C,s.sell.date]]),s.sell.errors.date?(o(),i("p",fe,n(s.sell.errors.date),1)):u("",!0)])]),e("div",be,[we,e("div",ke,[V(e("textarea",{type:"text",observations:"sell-observations",id:"sell-observations",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Descreva a título mais detalhadamente ou insira informações adicionais","onUpdate:modelValue":a[2]||(a[2]=t=>s.sell.observations=t)},null,512),[[C,s.sell.observations]]),s.sell.errors.observations?(o(),i("p",qe,n(s.sell.errors.observations),1)):u("",!0)])])])]),A.value||h.value?(o(),i("section",$e,[Ve,Ce,e("div",Se,[e("div",Ie,[e("div",De,[Le,V(e("input",{id:"item-selecter","onUpdate:modelValue":a[3]||(a[3]=t=>I.value=t),onFocus:a[4]||(a[4]=t=>T("in")),onBlur:a[5]||(a[5]=t=>T("out")),class:"simple-input disabled:bg-gray-200 px-4 py-2 w-full",placeholder:"Digite para pesquisar",disabled:h.value},null,40,Me),[[C,I.value]]),D.value?(o(),i("ul",Re,[(o(!0),i(B,null,F(P.value,(t,p)=>(o(),i("li",{key:p,class:"py-2 px-4 cursor-pointer hover:bg-gray-200",onMousedown:f=>_(t)},[e("span",{class:U(["inline",{"text-blue-500":t.quantity!=0&&t.quantity>=t.max_quantity,"text-green-500":t.quantity<t.max_quantity&&t.quantity>=t.min_quantity,"text-yellow-500":t.quantity<t.min_quantity&&t.quantity>0,"text-red-500":t.quantity==0}])},"("+n(t.quantity)+")",3),b(" "+n(t.name),1)],40,Ue))),128))])):u("",!0)])]),e("div",Oe,[je,e("div",Ae,[Ee,V(e("input",{id:"sell-estimated-amount",type:"number",step:"0.01",min:"0",autocomplete:"off",readonly:"",class:"block w-full rounded-md border-0 py-1.5 pl-9 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6 disabled:bg-gray-200",placeholder:"Valor total estimado",disabled:!s.sell.items_list.length||h.value,"onUpdate:modelValue":a[6]||(a[6]=t=>s.sell.estimated_value=t),required:""},null,8,Te),[[C,s.sell.estimated_value]]),s.sell.errors.estimated_value?(o(),i("p",Ne,n(s.sell.errors.estimated_value),1)):u("",!0)])]),e("div",Be,[Pe,e("div",ze,[Fe,e("input",{id:"sell-total-amount",type:"number",step:"0.01",min:"0",autocomplete:"off",class:"block w-full rounded-md border-0 py-1.5 pl-9 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6 disabled:bg-gray-200",placeholder:"Valor total estimado",disabled:!s.sell.items_list.length||h.value,value:x(s.sell.total_value,2),onInput:a[7]||(a[7]=t=>y(t,"total_value")),required:""},null,40,Qe),s.sell.errors.total_value?(o(),i("p",We,n(s.sell.errors.total_value),1)):u("",!0)])]),e("div",Ge,[Xe,e("div",Ze,[e("input",{id:"sell-discount-percent",type:"number",step:"0.01",min:"0",autocomplete:"off",class:"block w-full rounded-md border-0 py-1.5 pr-9 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6 disabled:bg-gray-200",placeholder:"Valor total estimado",disabled:!s.sell.items_list.length||h.value,value:x(s.sell.discount_percent,3),onInput:a[8]||(a[8]=t=>y(t,"discount_percent")),required:""},null,40,He),Je,s.sell.errors.discount_percent?(o(),i("p",Ke,n(s.sell.errors.discount_percent),1)):u("",!0)])]),e("div",Ye,[et,e("div",tt,[st,e("input",{id:"sell-discount",type:"number",step:"0.01",min:"0",autocomplete:"off",class:"block w-full rounded-md border-0 py-1.5 pl-9 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6 disabled:bg-gray-200",placeholder:"Valor total estimado",disabled:!s.sell.items_list.length||h.value,value:x(s.sell.discount,2),onInput:a[9]||(a[9]=t=>y(t,"discount")),required:""},null,40,at),s.sell.errors.discount?(o(),i("p",lt,n(s.sell.errors.discount),1)):u("",!0)])]),e("div",ot,[c.sell.items_list.length?(o(),i("table",nt,[e("thead",it,[e("tr",null,[dt,rt,ct,ut,mt,pt,gt,s.modal.mode!=="see"?(o(),i("th",_t,"Deletar")):u("",!0)])]),e("tbody",null,[(o(!0),i(B,null,F(c.sell.items_list,t=>(o(),i("tr",{key:t.id,class:U(["border-b transition duration-300 ease-in-out hover:bg-neutral-100 dark:border-neutral-500 dark:hover:bg-neutral-600",{"bg-yellow-100":t.movement_quantity==t.quantity,"bg-red-100":t.movement_quantity>t.quantity}])},[e("td",ht,n(t.id),1),e("td",xt,n(t.name),1),e("td",{class:U(["whitespace-nowrap py-4 text-center font-medium",{"text-blue-500":t.quantity!=0&&t.quantity>=t.max_quantity,"text-green-500":t.quantity<t.max_quantity&&t.quantity>=t.min_quantity,"text-yellow-500":t.quantity<t.min_quantity&&t.quantity>0,"text-red-500":t.quantity==0}])},n(t.quantity),3),e("td",yt,[e("input",{type:"number",min:"0.01",step:"0.01",value:t.movement_quantity,onInput:p=>{t.movement_quantity=p.target.value,t.amount=t.price*p.target.value,g()},class:"simple-input disabled:bg-gray-200 w-2/3",disabled:s.modal.mode!=="create"},null,40,vt)]),e("td",ft,n(t.measurement_unit),1),e("td",bt,n(m(v)(t.price)),1),e("td",wt,n(m(v)(t.amount?t.amount:10)),1),s.modal.mode!=="see"?(o(),i("td",kt,[e("button",{onClick:p=>d(t.id),title:"Remover "+t.name},"×",8,qt)])):u("",!0)],2))),128))])])):(o(),i("p",$t," Nenhum item selecionado até o momento!"))])])])):u("",!0),A.value&&s.sell.items_list.length&&s.modal.mode==="create"?(o(),i("section",Vt,[Ct,St,It,e("div",Dt,[e("div",Lt,[b("Valor estimado: "),e("span",Mt,n(m(v)(s.sell.estimated_value)),1)]),e("div",Rt,[b("Valor final: "),e("span",Ut,n(m(v)(s.sell.total_value)),1)]),e("div",Ot,[b("Desconto (%): "),e("span",jt,n(x(s.sell.discount_percent,3))+"%",1)]),e("div",At,[b("Desconto (R$): "),e("span",Et,n(m(v)(s.sell.discount)),1)]),e("div",Tt,[Nt,e("div",Bt,[Pt,V(e("input",{id:"sell-entry-value",type:"number",step:"0.01",min:"0",autocomplete:"off",class:"block w-full rounded-md border-0 py-1.5 pl-9 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6 disabled:bg-gray-200",placeholder:"Valor de pagamneto de entrada",disabled:!s.sell.items_list.length||h.value,"onUpdate:modelValue":a[10]||(a[10]=t=>s.sell.entry_value=t),required:""},null,8,zt),[[C,s.sell.entry_value]]),s.sell.errors.entry_value?(o(),i("p",Ft,n(s.sell.errors.entry_value),1)):u("",!0)])]),e("div",Qt,[Wt,e("div",Gt,[Xt,e("input",{id:"sell-partial-value",type:"number",step:"0.01",min:"0",autocomplete:"off",class:"block w-full rounded-md border-0 py-1.5 pl-9 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6 disabled:bg-gray-200",placeholder:"Valor restante para pagamento posterior",disabled:!s.sell.items_list.length||h.value,value:x(E.value,2),readonly:"",required:""},null,8,Zt),s.sell.errors.partial_value?(o(),i("p",Ht,n(s.sell.errors.partial_value),1)):u("",!0)])])])])):u("",!0)])],32)]),footer:$(()=>[s.modal.mode!=="see"?(o(),R(ae,{key:0,class:U({disabled:s.sell.processing}),onClick:a[11]||(a[11]=t=>L())},{default:$(()=>[b(" Cancelar ")]),_:1},8,["class"])):u("",!0),q(se,{class:U({disabled:s.sell.processing||!w.value}),disabled:s.sell.processing||!w.value,onClick:a[12]||(a[12]=t=>M())},{default:$(()=>[b(n(s.modal.primary_button_txt),1)]),_:1},8,["class","disabled"])]),_:1},8,["show","maxWidth"]))}},Kt={class:"font-semibold text-xl text-gray-800 leading-tight"},Yt={class:"pt-12 print:hidden print:pt-0"},es={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 print:w-full"},ts={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-5"},ss={class:"flex flex-row items-center space-x-3"},as={class:"py-12 print:py-6"},ls={class:"max-w-7xl mx-auto print:max-w-full"},os={class:"px-0 print:px-0"},ns={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg print:shadow-none"},is={class:"flex flex-col"},ds={class:"overflow-x-auto sm:-mx-6 lg:-mx-8"},rs={class:"inline-block min-w-full py-2 sm:px-6 lg:px-8"},cs={class:"overflow-hidden"},us={class:"min-w-full text-left text-sm font-light"},ms=e("thead",{class:"border-b font-medium dark:border-neutral-500"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-4 text-center"},"#"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Cliente"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"À pagar"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Valor total"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Data da Venda "),e("th",{scope:"col",class:"px-6 py-4 text-center print:hidden",colspan:"2"}," Ações")])],-1),ps={class:"border-b transition duration-300 ease-in-out hover:bg-neutral-100 dark:border-neutral-500 dark:hover:bg-neutral-600"},gs={class:"whitespace-nowrap py-4 text-center font-medium"},_s={class:"whitespace-normal px-6 py-4 text-center trim"},hs=["title"],xs={class:"whitespace-nowrap px-2 py-4 text-center"},ys={class:"whitespace-nowrap px-2 py-4 text-center"},vs={class:"whitespace-nowrap px-2 py-4 text-center print:hidden"},fs=["title","onClick"],bs=["title","onClick"],ws={key:1,class:"transition duration-300 ease-in-out hover:bg-neutral-100 dark:border-neutral-500 dark:hover:bg-neutral-600"},ks=e("td",{class:"whitespace-nowrap px-6 py-4 text-center",colspan:"9"},"Não há vendas cadastradas no momento!",-1),qs=[ks],As={__name:"Sells",props:{page:Object,page_options:{type:Array,default:null},sells_list:Object,items:Object},setup(s){const O=s,r=Z({id:null,client:"",date:"",estimated_value:0,total_value:0,partial_value:0,discount_percent:0,discount:0,entry_value:0,observations:"",items_list:[]}),c=N(""),j=S(()=>{const g=c.value.toLowerCase();return O.sells_list.filter(_=>{const{id:d,entity_name:y,observations:x,date:k,accounting:L,items:M}=_,{total_value:l,partial_value:a}=L,t=[d.toString(),(y==null?void 0:y.toLowerCase())??"",(x==null?void 0:x.toLowerCase())??"",(k==null?void 0:k.toLowerCase())??"",v(l).toLowerCase()??"",v(a).toLowerCase()??""];for(let p of t)if(p.includes(g))return!0;return M.some(p=>p.name.toLowerCase().includes(g))})}),A=S(()=>O.sells_list.reduce((g,_)=>g+_.accounting.partial_value,0)),w=N({mode:"create",show:!1,get title(){switch(this.mode){case"create":return"Criar venda";case"update":return"Editar venda";case"see":return"Ver informações da venda"}},get primary_button_txt(){switch(this.mode){case"create":return"Cadastrar";case"update":return"Atualizar";case"see":return"Fechar"}}}),E=(g,_=null)=>{const d=["update","see"].includes(g);if(_!==null&&d){const y=O.sells_list.find(x=>x.id===_);if(y){const{id:x,entity_name:k,date:L,observations:M,accounting:l,items:a}=y;r.id=x,r.client=k,r.date=L,r.estimated_value=l.estimated_value,r.total_value=l.total_value,r.partial_value=l.partial_value,r.entry_value=0,r.discount=l.estimated_value-l.total_value,r.discount_percent=r.discount/(l.estimated_value||1)*100,r.observations=M,r.items_list=a}}w.value.mode=g,w.value.show=!0},h=()=>{r.reset(),w.value.show=!1},I=()=>{r.post(route("sells.store"),{preserveScroll:!0,onSuccess:()=>h(),onError:g=>{console.log(g)}})},D=()=>{r.put(route("sells.update",r.id),{preserveScroll:!0,onSuccess:()=>h()})},P=(g,_)=>{confirm(`Você tem certeza que deseja excluir a venda de material para "${_}"? Todos os materiais comprados voltarão para o estoque! Esta ação não poderá ser desfeita!`)&&r.delete(route("sells.destroy",g),{preserveScroll:!0,onSuccess:()=>alert("Venda deletado com sucesso!")})},T=()=>{switch(w.value.mode){case"create":return I();case"update":return D();case"see":return h();default:alert("Método desconhecido. Informar o Técnico.")}};return(g,_)=>(o(),i(B,null,[q(m(H),{title:s.page.name},null,8,["title"]),q(J,{page:s.page,page_options:s.page_options},{header:$(()=>[e("h2",Kt,n(s.page.name)+" | "+n(m(v)(A.value)),1),q(ne,{icon:"plus",onClick:_[0]||(_[0]=d=>E("create")),title:"Cadastrar Sell",class:"print:hidden"})]),default:$(()=>[e("div",Yt,[e("div",es,[e("div",ts,[e("div",ss,[q(m(ee),{class:"w-5 y-5"}),V(e("input",{type:"text",name:"search_term",id:"search_term",autocomplete:"on",class:"simple-input",autofocus:"true",placeholder:"Pesquisar termo...","onUpdate:modelValue":_[1]||(_[1]=d=>c.value=d)},null,512),[[C,c.value]])])])])]),e("div",as,[e("div",ls,[e("div",os,[e("div",ns,[e("div",is,[e("div",ds,[e("div",rs,[e("div",cs,[e("table",us,[ms,e("tbody",null,[j.value.length?(o(!0),i(B,{key:0},F(j.value,d=>(o(),i("tr",ps,[e("td",gs,n(d.id),1),e("td",_s,[b(n(d.entity_name)+" ",1),d.observations?(o(),i("span",{key:0,title:d.observations,class:"inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10 cursor-help"},"OBS",8,hs)):u("",!0)]),e("td",xs,n(m(v)(d.accounting.partial_value)),1),e("td",ys,n(d.accounting.total_value>0?m(v)(d.accounting.total_value):"Pago"),1),e("td",vs,n(m(Q)(d.date,!0)),1),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-indigo-700 active:text-indigo-900 select-none print:hidden",title:"VER: Compra de "+d.entity_name,onClick:y=>E("see",d.id)},[q(m(W),{class:"w-5 h-5 m-auto"})],8,fs),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-red-700 active:text-red-900 select-none print:hidden",title:"EXCLUIR: Compra de "+d.entity_name,onClick:y=>P(d.id,d.entity_name)},[q(m(te),{class:"w-5 h-5 m-auto"})],8,bs)]))),256)):(o(),i("tr",ws,qs))])])])])])])])])])]),q(Jt,{modal:w.value,sell:m(r),items:s.items,onSubmit:T,onClose:h},null,8,["modal","sell","items"])]),_:1},8,["page","page_options"])],64))}};export{As as default};
