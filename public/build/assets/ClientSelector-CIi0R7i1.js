import{r as i,q as y,p as B,E as C,d as s,o,s as N,e as v,v as $,a as h,F as q,g as E,h as M,f,t as g}from"./app-rFp3DUWb.js";import{l as S}from"./lodash-C3XsCdrW.js";const T={class:"relative"},D=["required","disabled"],F={key:1,class:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto"},L={key:0,class:"px-4 py-2 text-sm text-gray-500"},R={key:1},j=["onMousedown"],z={class:"text-xs text-gray-500"},A={key:2,class:"px-4 py-2 text-sm text-gray-500"},I=["href"],J={__name:"ClientSelector",props:{modelValue:[String,Number,null],required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(n,{emit:x}){const p=n,m=x,t=i(""),u=i([]),r=i(""),d=i(!1),c=i(!1),b=()=>{setTimeout(()=>{c.value=!1},200)},w=S.debounce(async()=>{if(t.value.length<2||t.value===r.value){u.value=[];return}d.value=!0;try{const e=await y.get(route("clients.search",{term:t.value}));u.value=e.data}catch(e){console.error("Erro ao buscar clientes:",e),u.value=[]}finally{d.value=!1}},300);B(t,e=>{e!==r.value&&(e===""&&(m("update:modelValue",null),r.value=""),w())});const V=e=>{m("update:modelValue",e.id);const a=`${e.name} (${e.document})`;r.value=a,t.value=a,c.value=!1},_=()=>{m("update:modelValue",null),r.value="",t.value="",u.value=[]},k=async()=>{if(p.modelValue)try{const e=await y.get(route("clients.show",{client:p.modelValue}),{headers:{Accept:"application/json"}});if(e.data&&e.data.client){const a=e.data.client,l=`${a.name} (${a.document})`;r.value=l,t.value=l}}catch(e){console.error("Erro ao buscar dados do cliente inicial:",e)}};return C(()=>{k()}),(e,a)=>(o(),s("div",T,[N(h("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=l=>t.value=l),placeholder:"Digite para buscar um cliente...",onFocus:a[1]||(a[1]=l=>c.value=!0),onBlur:b,class:"simple-input w-full disabled:bg-gray-200",required:n.required&&!n.modelValue,disabled:n.disabled},null,40,D),[[$,t.value]]),n.modelValue&&!n.disabled?(o(),s("button",{key:0,onClick:_,type:"button",class:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-red-500",title:"Limpar seleção"}," × ")):v("",!0),c.value&&t.value.length>1&&t.value!==r.value?(o(),s("div",F,[d.value?(o(),s("div",L,"Buscando...")):u.value.length>0?(o(),s("ul",R,[(o(!0),s(q,null,E(u.value,l=>(o(),s("li",{key:l.id,onMousedown:M(U=>V(l),["prevent"]),class:"px-4 py-2 text-sm text-gray-700 cursor-pointer hover:bg-gray-100"},[f(g(l.name)+" ",1),h("span",z,"("+g(l.document)+")",1)],40,j))),128))])):d.value?v("",!0):(o(),s("div",A,[f(" Nenhum cliente encontrado. "),h("a",{href:e.route("clients.create"),target:"_blank",class:"text-blue-500 hover:underline"},"Cadastrar novo?",8,I)]))])):v("",!0)]))}};export{J as _};
