import{z as Z,d as V,l as U,o as a,c as C,w as k,a as e,n as T,u as l,h,f as j,t as m,i as X,q as f,v as S,e as c,b as v,F,g as N,s as H,T as G,Z as Y,G as ee}from"./app-DfaP_USl.js";import{r as te,a as se,b as oe,_ as ae}from"./AppLayout-DW6TDVcq.js";import{_ as ie}from"./CreateUpdateModal-BWi20tZ0.js";import{_ as le}from"./PrimaryButton-CqipGkJR.js";import{_ as ne}from"./SecondaryButton-DUsC_UUZ.js";import{f as W,t as P}from"./general-f63YF4ZR.js";import{_ as re}from"./SelectSearchService-7E1c_DSb.js";import{_ as de,r as ce}from"./SelectSearchItem-COODuX9R.js";/* empty css                    */import{r as ue}from"./PlusIcon-yafhgBuB.js";import{r as me,a as pe}from"./XMarkIcon-BF2F9K9H.js";import{r as J}from"./EyeIcon-CtjX65iH.js";import{_ as _e}from"./FloatButton-Cia57gmn.js";import{r as he}from"./MagnifyingGlassIcon-Yp-oeQf7.js";import"./Modal-BY4paGbZ.js";import"./PrinterIcon-DfeROhJi.js";const ye={class:"pb-12 space-y-12 divide-y-2"},ve={class:"py-4"},xe=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Informações Básicas",-1),fe=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Informações sobre a uso como nome do funcionário, data da uso e observações",-1),be={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"},ge={class:"sm:col-span-6"},we=e("label",{for:"use-date",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Data do Uso",-1),$e={class:"mt-2"},ke=["max","disabled"],qe={key:0,class:"text-red-500 text-sm"},Ce={class:"sm:col-span-6"},Ue=e("label",{for:"use-motive",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Motivo",-1),Ve={class:"mt-2"},Se=["disabled"],Ie={key:2,class:"text-red-500 text-sm"},Me={class:"sm:col-span-6"},De=e("label",{for:"use-observations",class:"block text-sm font-medium leading-6 text-gray-900"},"Observações",-1),Ae={class:"mt-2"},Le=["disabled"],Oe={key:0,class:"text-red-500 text-sm"},Te={key:0,class:"py-4"},je=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Lista de Itens",-1),Fe=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Adicione os itens do uso.",-1),Ee={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-4"},Ne={key:0,class:"sm:col-span-4"},Be=e("label",{for:"item-selecter",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Selecione os itens de uso",-1),ze={class:"mt-2"},Re={class:"sm:col-span-4"},Qe={key:0,class:"min-w-full text-left text-sm font-medium leading-6 text-gray-900"},We={class:"border-b font-medium"},Ge=e("th",{scope:"col",class:"px-6 py-4 text-center"},"#",-1),Pe=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Item",-1),Ze=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Qtd. Estoque",-1),He=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Qtd. Uso",-1),Je=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Und. Medida",-1),Ke=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Funcionário",-1),Xe={key:0,scope:"col",class:"px-6 py-4 text-center"},Ye={class:"whitespace-nowrap py-4 text-center font-medium"},et={class:"whitespace-nowrap py-4 text-center font-medium"},tt={class:"whitespace-nowrap py-4 text-center font-medium flex justify-center"},st=["value","onInput","disabled"],ot={class:"whitespace-nowrap py-4 text-center font-medium"},at={class:"whitespace-nowrap py-4 text-center font-medium flex justify-center"},it=["onUpdate:modelValue","disabled"],lt=e("option",{value:null,disabled:"",selected:""},"Escolha um funcionário ",-1),nt=["value"],rt={key:0,class:"whitespace-nowrap py-4 text-center font-mono text-2xl"},dt=["onClick","title"],ct={key:1,class:"p-5 bg-gray-200 rounded-md block text-sm font-medium leading-6 text-gray-900"},ut={__name:"CreateUpdateUsesModal",props:{modal:Object,use:{type:Object,default:null},items:Array,employees_list:Array,services_list:Array},emits:["close","submit"],setup(s,{emit:x}){var i;const _=x,d=s;Z.useToast(),V(!0);const p=/^\d{4}-\d{2}-\d{2}$/,I=U(()=>{const{motive:o,employee_id:n,employee:t,date:u}=d.use;return!o||!o.length?!1:u&&p.test(u)}),q=U(()=>{const{employee:o,motive:n,date:t,items_list:u}=d.use;return!n||!n.length||!t||!p.test(t)||!u||u.length<1?!1:u.every($=>$.movement_quantity>0&&$.movement_quantity<=$.quantity&&$.employee_id>0)}),b=U(()=>d.modal.mode==="see"),M=U(()=>d.modal.mode==="see"),g=V(""),E=V(!1);U(()=>d.items.filter(o=>o.name.toLowerCase().includes(g.value.toLowerCase())));const w=()=>{d.use.estimated_value=d.use.items_list.reduce((o,n)=>o+n.price*n.movement_quantity,0),d.use.total_value=d.use.estimated_value},D=V(d.employees_list?(i=d.employees_list[0])==null?void 0:i.id:null),A=o=>{var n;d.use.items_list.push({id:(((n=d.use.items_list[d.use.items_list.length-1])==null?void 0:n.id)??0)+1,id:o.id,name:o.name,quantity:o.quantity,max_quantity:o.max_quantity,min_quantity:o.min_quantity,movement_quantity:1,measurement_unit:o.measurement_unit.abbreviation,price:o.price,amount:o.price,employee_id:D.value}),g.value="",E.value=!1,w()},B=o=>{d.use.items_list=d.use.items_list.filter(n=>n.id!==o),w()},z=o=>{d.use.motive=o},R=o=>{A(o)},y=()=>{var o;D.value=d.employees_list?(o=d.employees_list[0])==null?void 0:o.id:null,_("close")},r=()=>{var o;D.value=d.employees_list?(o=d.employees_list[0])==null?void 0:o.id:null,_("submit")};return(o,n)=>(a(),C(ie,{show:s.modal.show,maxWidth:I.value||M.value?"3xl":"2xl",onClose:y},{icon:k(()=>[e("div",{class:T(["mx-auto shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-400 sm:mx-0 sm:h-10 sm:w-10",{"bg-yellow-400":s.modal.mode==="update","bg-green-400":s.modal.mode==="pay","bg-gray-400":s.modal.mode==="see"}])},[s.modal.mode==="create"?(a(),C(l(ue),{key:0,class:"w-5 h-5 text-white"})):h("",!0),s.modal.mode==="update"?(a(),C(l(me),{key:1,class:"w-5 h-5 text-white"})):h("",!0),s.modal.mode==="pay"?(a(),C(l(te),{key:2,class:"w-5 h-5 text-white"})):h("",!0),s.modal.mode==="see"?(a(),C(l(J),{key:3,class:"w-5 h-5 text-white"})):h("",!0)],2)]),title:k(()=>[j(m(s.modal.title),1)]),content:k(()=>[e("form",{onSubmit:X(r,["prevent"])},[e("div",ye,[e("section",ve,[xe,fe,e("div",be,[e("div",ge,[we,e("div",$e,[f(e("input",{type:"date",name:"use-date",id:"use-date",autocomplete:"on",class:"simple-input disabled:bg-gray-200",autofocus:"true",placeholder:"Data do Uso",max:l(W)(),"onUpdate:modelValue":n[0]||(n[0]=t=>s.use.date=t),disabled:b.value,required:""},null,8,ke),[[S,s.use.date]]),s.use.errors.date?(a(),c("p",qe,m(s.use.errors.date),1)):h("",!0)])]),e("div",Ce,[Ue,e("div",Ve,[M.value?f((a(),c("input",{key:0,type:"text",name:"use-motive",id:"use-motive",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Motivo do Uso","onUpdate:modelValue":n[1]||(n[1]=t=>s.use.motive=t),disabled:b.value,required:""},null,8,Se)),[[S,s.use.motive]]):(a(),C(re,{key:1,options:s.services_list,"onUpdate:modelValue":z},null,8,["options"])),s.use.errors.motive?(a(),c("p",Ie,m(s.use.errors.motive),1)):h("",!0)])]),e("div",Me,[De,e("div",Ae,[f(e("textarea",{type:"text",observations:"use-observations",id:"use-observations",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Descreva a título mais detalhadamente ou insira informações adicionais","onUpdate:modelValue":n[2]||(n[2]=t=>s.use.observations=t),disabled:b.value},null,8,Le),[[S,s.use.observations]]),s.use.errors.observations?(a(),c("p",Oe,m(s.use.errors.observations),1)):h("",!0)])])])]),I.value||M.value?(a(),c("section",Te,[je,Fe,e("div",Ee,[M.value?h("",!0):(a(),c("div",Ne,[Be,e("div",ze,[v(de,{options:s.items,"onUpdate:modelValue":R},null,8,["options"])])])),e("div",Re,[d.use.items_list.length?(a(),c("table",Qe,[e("thead",We,[e("tr",null,[Ge,Pe,Ze,He,Je,Ke,s.modal.mode!=="see"?(a(),c("th",Xe," Deletar")):h("",!0)])]),e("tbody",null,[(a(!0),c(F,null,N(d.use.items_list,t=>(a(),c("tr",{key:t.id,class:T(["border-b transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid",{"bg-yellow-100":t.movement_quantity==t.quantity,"bg-red-100":t.movement_quantity>t.quantity}])},[e("td",Ye,m(t.id),1),e("td",et,m(t.name),1),e("td",{class:T(["whitespace-nowrap py-4 text-center font-medium",{"text-blue-500":t.quantity!=0&&t.quantity>=t.max_quantity,"text-green-500":t.quantity<t.max_quantity&&t.quantity>=t.min_quantity,"text-yellow-500":t.quantity<t.min_quantity&&t.quantity>0,"text-red-500":t.quantity==0}])},m(t.quantity),3),e("td",tt,[e("input",{type:"number",min:"0.01",step:"0.01",value:t.movement_quantity,onInput:u=>{t.movement_quantity=parseFloat(u.target.value),t.amount=t.price*u.target.value,w()},class:"simple-input disabled:bg-gray-200 w-2/3",disabled:b.value},null,40,st)]),e("td",ot,m(t.measurement_unit),1),e("td",at,[f(e("select",{name:"use-employee",class:"simple-select disabled:bg-gray-200",placeholder:"Nome do funcionario","onUpdate:modelValue":u=>t.employee_id=u,onChange:n[3]||(n[3]=u=>D.value=u.target.value),required:"",disabled:!I.value||b.value},[lt,(a(!0),c(F,null,N(s.employees_list,u=>(a(),c("option",{key:u.id,value:u.id},m(u.name)+" "+m(u.surname),9,nt))),128))],40,it),[[H,t.employee_id]])]),s.modal.mode!=="see"?(a(),c("td",rt,[e("button",{onClick:u=>B(t.id),title:"Remover "+t.name},"×",8,dt)])):h("",!0)],2))),128))])])):(a(),c("p",ct," Nenhum item selecionado até o momento!"))])])])):h("",!0)])],32)]),footer:k(()=>[s.modal.mode!=="see"?(a(),C(ne,{key:0,class:T({disabled:s.use.processing}),onClick:n[4]||(n[4]=t=>y())},{default:k(()=>[j(" Cancelar ")]),_:1},8,["class"])):h("",!0),v(le,{class:T({disabled:s.use.processing||!q.value}),disabled:s.use.processing||!q.value,onClick:n[5]||(n[5]=t=>s.use.processing||!q.value?t.preventDefault():r())},{default:k(()=>[j(m(s.modal.primary_button_txt),1)]),_:1},8,["class","disabled"])]),_:1},8,["show","maxWidth"]))}},mt={class:"font-semibold text-xl text-gray-800 leading-tight"},pt={key:0},_t={class:"pt-12 print:hidden print:pt-0"},ht={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 print:w-full"},yt={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-5"},vt={class:"flex flex-row items-center space-x-3"},xt={class:"cursor-help select-none",title:"O campo de pesquisa ao lado filtra as informações carregadas na pagina. O formulário de pesquisa abaixo busca as informações filtradas no banco de dados e lista na página."},ft={class:"mt-3 grid grid-cols-4 gap-2"},bt={class:"col-span-4 md:col-span-1"},gt=e("label",{for:"search-by-employee",class:"block text-sm font-medium leading-6 text-gray-900"},"Funcionário",-1),wt={class:"mt-2"},$t=e("option",{value:0},"Todos",-1),kt=["value"],qt={key:0,class:"text-red-500 text-sm"},Ct={class:"col-span-4 md:col-span-1"},Ut=e("label",{for:"search-by-motive",class:"block text-sm font-medium leading-6 text-gray-900"},"Motivo",-1),Vt={class:"mt-2"},St={key:0,class:"text-red-500 text-sm"},It={class:"col-span-2 md:col-span-1"},Mt=e("label",{for:"search-by-start-date",class:"block text-sm font-medium leading-6 text-gray-900"},"Data (início)",-1),Dt={class:"mt-2"},At={key:0,class:"text-red-500 text-sm"},Lt={class:"col-span-2 md:col-span-1"},Ot=e("label",{for:"search-by-end-date",class:"block text-sm font-medium leading-6 text-gray-900"},"Data (fim)",-1),Tt={class:"mt-2"},jt={key:0,class:"text-red-500 text-sm"},Ft=["href"],Et={class:"py-12 print:py-0"},Nt={class:"max-w-7xl mx-auto print:max-w-full"},Bt={class:"px-0 print:px-0"},zt={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg print:shadow-none"},Rt={class:"flex flex-col"},Qt={class:"overflow-x-auto sm:-mx-6 lg:-mx-8"},Wt={class:"inline-block min-w-full py-2 sm:px-6 lg:px-8"},Gt={class:"overflow-hidden"},Pt={class:"min-w-full text-left text-sm font-light"},Zt=e("thead",{class:"border-b font-medium"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-4 text-center"},"#"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Motivo"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Data do Uso "),e("th",{scope:"col",class:"px-6 py-4 text-center print:hidden",colspan:"2"}," Ações")])],-1),Ht={class:"border-b transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid"},Jt={class:"whitespace-nowrap py-4 text-center font-medium"},Kt={class:"whitespace-nowrap px-2 py-4 text-center"},Xt=["title"],Yt={class:"whitespace-nowrap px-2 py-4 text-center"},es=["onClick"],ts=["onClick"],ss={key:1,class:"transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid"},os=e("td",{class:"whitespace-nowrap px-6 py-4 text-center",colspan:"9"},"Não há usos cadastradas no momento!",-1),as=[os],gs={__name:"Uses",props:{page:Object,page_options:{type:Array,default:null},uses_list:Object,employees_list:Array,items:Object,parameters:Object,services_list:Array},setup(s){const x=s,_=G({id:null,employee:"",employee_id:null,motive:"",date:W(),total_value:0,observations:"",items_list:[]}),d=V(!x.parameters.default),p=G({employee_id:x.parameters.employee_id,motive:x.parameters.motive,start_date:x.parameters.start_date,end_date:x.parameters.end_date}),I=Z.useToast(),q=V(""),b=U(()=>{const y=q.value.toLowerCase();return x.uses_list.filter(r=>{const{id:i,entity_name:o,motive:n,observations:t,date:u,items:L}=r,$=[i.toString(),(o==null?void 0:o.toLowerCase())??"",(n==null?void 0:n.toLowerCase())??"",(t==null?void 0:t.toLowerCase())??"",(u==null?void 0:u.toLowerCase())??""];for(let O of $)if(O.includes(y))return!0;return L.some(O=>O.name.toLowerCase().includes(y))})}),M=U(()=>x.uses_list.reduce((y,r)=>y+r.accounting.partial_value,0)),g=V({mode:"create",show:!1,get title(){switch(this.mode){case"create":return"Criar uso";case"update":return"Editar uso";case"see":return"Ver informações da uso"}},get primary_button_txt(){switch(this.mode){case"create":return"Cadastrar";case"update":return"Atualizar";case"see":return"Fechar"}}}),E=(y,r=null)=>{const i=["update","see"].includes(y);if(r!==null&&i){const o=x.uses_list.find(n=>n.id===r);if(o){const{id:n,entity_name:t,employee_id:u,date:L,motive:$,observations:O,accounting:Q,items:K}=o;_.id=n,_.employee=t,_.date=L,_.motive=$,_.estimated_value=Q.estimated_value,_.total_value=Q.total_value,_.partial_value=Q.partial_value,_.observations=O,_.items_list=K,_.employee_id=u}}g.value.mode=y,g.value.show=!0},w=()=>{_.reset(),g.value.show=!1},D=()=>{_.post(route("uses.store"),{preserveScroll:!0,onSuccess:()=>w(),onError:y=>{console.log(y)}})},A=()=>{p.post(route("uses.filter"),{preserveScroll:!0})},B=()=>{_.put(route("uses.update",_.id),{preserveScroll:!0,onSuccess:()=>w()})},z=(y,r)=>{confirm(`Você tem certeza que deseja excluir a uso de material para "${r}"? Todos os materiais comprados voltarão para o estoque! Esta ação não poderá ser desfeita!`)&&_.delete(route("uses.destroy",y),{preserveScroll:!0,onSuccess:()=>I.success("Uso deletado com sucesso!")})},R=()=>{switch(g.value.mode){case"create":return D();case"update":return B();case"see":return w();default:I.error("Método desconhecido. Informar o Técnico.")}};return(y,r)=>(a(),c(F,null,[v(l(Y),{class:"print:hidden",title:s.page.name},null,8,["title"]),v(ae,{page:s.page,page_options:s.page_options},{header:k(()=>[e("h2",mt,[j(m(s.page.name)+" ",1),y.$page.props.auth.user.hierarchy<2?(a(),c("span",pt,"| "+m(l(P)(M.value)),1)):h("",!0)]),v(_e,{icon:"plus",onClick:r[0]||(r[0]=i=>E("create")),title:"Cadastrar Use",class:"print:hidden"})]),default:k(()=>[e("div",_t,[e("div",ht,[e("div",yt,[e("div",vt,[v(l(he),{class:"w-5 y-5"}),f(e("input",{type:"text",name:"search_term",id:"search_term",autocomplete:"on",class:"simple-input",autofocus:"true",placeholder:"Pesquisar termo...","onUpdate:modelValue":r[1]||(r[1]=i=>q.value=i)},null,512),[[S,q.value]]),e("span",xt,[v(l(ce),{class:"w-5 h-5"})]),d.value?(a(),c("span",{key:1,class:"select-none cursor-pointer",title:"Fechar opções de filtro",onClick:r[3]||(r[3]=i=>d.value=!1)},[v(l(oe),{class:"w-5 y-5"})])):(a(),c("span",{key:0,class:"select-none cursor-pointer",title:"Abrir opções de filtro",onClick:r[2]||(r[2]=i=>d.value=!0)},[v(l(se),{class:"w-5 y-5"})]))]),f(e("div",ft,[e("div",bt,[gt,e("div",wt,[f(e("select",{name:"search-by-employee",id:"search-by-employee",class:"simple-select disabled:bg-gray-200","onUpdate:modelValue":r[4]||(r[4]=i=>l(p).employee_id=i),onChange:A},[$t,(a(!0),c(F,null,N(s.employees_list,i=>(a(),c("option",{key:i.id,value:i.id},m(i.name)+" "+m(i.surname),9,kt))),128))],544),[[H,l(p).employee_id]]),l(p).errors.employee_id?(a(),c("p",qt,m(l(p).errors.employee_id),1)):h("",!0)])]),e("div",Ct,[Ut,e("div",Vt,[f(e("input",{type:"text",name:"search-by-motive",id:"search-by-motive",class:"simple-input disabled:bg-gray-200",placeholder:"Filtrar por motivo","onUpdate:modelValue":r[5]||(r[5]=i=>l(p).motive=i),onInput:A,required:""},null,544),[[S,l(p).motive]]),l(p).errors.motive?(a(),c("p",St,m(l(p).errors.motive),1)):h("",!0)])]),e("div",It,[Mt,e("div",Dt,[f(e("input",{type:"date",name:"search-by-start-date",id:"search-by-start-date",class:"simple-input disabled:bg-gray-200",placeholder:"Filtrar por período (início)","onUpdate:modelValue":r[6]||(r[6]=i=>l(p).start_date=i),onInput:A,required:""},null,544),[[S,l(p).start_date]]),l(p).errors.start_date?(a(),c("p",At,m(l(p).errors.start_date),1)):h("",!0)])]),e("div",Lt,[Ot,e("div",Tt,[f(e("input",{type:"date",name:"search-by-end-date",id:"search-by-end-date",class:"simple-input disabled:bg-gray-200",placeholder:"Filtrar por período (fim)","onUpdate:modelValue":r[7]||(r[7]=i=>l(p).end_date=i),onInput:A,required:""},null,544),[[S,l(p).end_date]]),l(p).errors.end_date?(a(),c("p",jt,m(l(p).errors.end_date),1)):h("",!0)])]),e("a",{href:y.route("uses.index"),class:"text-red-500 hover:text-red-700 active:text-red-900 text-sm select-none mt-2",onClick:r[8]||(r[8]=i=>l(p).reset())},"Resetar busca",8,Ft)],512),[[ee,d.value]])])])]),e("div",Et,[e("div",Nt,[e("div",Bt,[e("div",zt,[e("div",Rt,[e("div",Qt,[e("div",Wt,[e("div",Gt,[e("table",Pt,[Zt,e("tbody",null,[b.value.length?(a(!0),c(F,{key:0},N(b.value,i=>(a(),c("tr",Ht,[e("td",Jt,m(i.id),1),e("td",Kt,[j(m(l(P)(i.motive))+" ",1),i.observations?(a(),c("span",{key:0,title:i.observations,class:"inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10 cursor-help"},"OBS",8,Xt)):h("",!0)]),e("td",Yt,m(l(W)(i.date,!0)),1),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-indigo-700 active:text-indigo-900 select-none print:hidden",title:"Ver Uso",onClick:o=>E("see",i.id)},[v(l(J),{class:"w-5 h-5 m-auto"})],8,es),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-red-700 active:text-red-900 select-none print:hidden",title:"Excluir Uso",onClick:o=>z(i.id,i.motive)},[v(l(pe),{class:"w-5 h-5 m-auto"})],8,ts)]))),256)):(a(),c("tr",ss,as))])])])])])])])])])]),v(ut,{modal:g.value,use:l(_),items:s.items,employees_list:s.employees_list,services_list:s.services_list,onSubmit:R,onClose:w},null,8,["modal","use","items","employees_list","services_list"])]),_:1},8,["page","page_options"])],64))}};export{gs as default};
