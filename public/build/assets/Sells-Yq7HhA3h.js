import{l as S,d as N,o as n,c as R,w as q,a as e,n as U,u,h as c,f as b,t as i,i as X,q as V,v as C,e as d,F as B,g as F,b as k,y as Z,T as H,Z as J}from"./app-CQCMULRS.js";import{r as K,_ as Y}from"./AppLayout-DVsrCAOA.js";import{_ as ee}from"./CreateUpdateModal-CL67BBV8.js";import{_ as te}from"./PrimaryButton-CCpSxDR1.js";import{_ as se}from"./SecondaryButton-CJwptiz7.js";import{g as Q,t as v}from"./general-CW50Zh8a.js";import{r as ae}from"./PlusIcon-C8vVEu5u.js";import{r as le,a as oe}from"./XMarkIcon-DDhLJnv-.js";import{r as W}from"./EyeIcon-CE4FUwbj.js";import{_ as ne}from"./FloatButton-C3J_W6e4.js";/* empty css                    */import{r as ie}from"./MagnifyingGlassIcon-4YeFiuBy.js";import"./Modal-15mIg7tU.js";import"./PrinterIcon-CfTT1zCI.js";const de={class:"pb-12 space-y-12 divide-y-2"},re={class:"py-4"},ce=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Informações Básicas",-1),ue=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Informações sobre a venda como nome do cliente, data da venda e observações",-1),me={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"},pe={class:"sm:col-span-3"},ge=e("label",{for:"sell-client",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Cliente",-1),_e={class:"mt-2"},xe={key:0,class:"text-red-500 text-sm"},he={class:"sm:col-span-3"},ye=e("label",{for:"sell-date",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Data da Venda",-1),ve={class:"mt-2"},fe=["max"],be={key:0,class:"text-red-500 text-sm"},we={class:"sm:col-span-6"},ke=e("label",{for:"sell-observations",class:"block text-sm font-medium leading-6 text-gray-900"},"Observações",-1),qe={class:"mt-2"},$e={key:0,class:"text-red-500 text-sm"},Ve={key:0,class:"py-4"},Ce=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Lista de Itens",-1),Se=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Adicione os itens da venda bem como descontos e valor de pagamento de entrada.",-1),Ie={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-4"},De={class:"sm:col-span-4"},Le={class:"relative"},Me=e("label",{for:"item-selecter",class:"block text-sm font-medium leading-6 text-gray-900"},"Selecione os itens de venda",-1),Re=["disabled"],Ue={key:0,class:"absolute z-10 w-full mx-auto sm:w-96 bg-white border rounded mt-2 h-96 overflow-y-scroll"},Ee=["onMousedown"],Oe={class:"md:col-span-2 lg:col-span-1"},Te=e("label",{for:"sell-estimated-amount",class:"block text-sm font-medium leading-6 text-gray-900"},"Valor estimado ",-1),je={class:"relative mt-2 rounded-md shadow-sm"},Ae=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1),Ne=["disabled"],Be={key:0,class:"text-red-500 text-sm"},Pe={class:"md:col-span-2 lg:col-span-1"},ze=e("label",{for:"sell-total-amount",class:"block text-sm font-medium leading-6 text-gray-900"},"Valor final ",-1),Fe={class:"relative mt-2 rounded-md shadow-sm"},Qe=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1),We=["disabled","value"],Ge={key:0,class:"text-red-500 text-sm"},Xe={class:"md:col-span-2 lg:col-span-1"},Ze=e("label",{for:"sell-discount-percent",class:"block text-sm font-medium leading-6 text-gray-900"},"Desconto (%) ",-1),He={class:"relative mt-2 rounded-md shadow-sm"},Je=["disabled","value"],Ke=e("div",{class:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3"},[e("span",{class:"text-gray-500 sm:text-sm"},"%")],-1),Ye={key:0,class:"text-red-500 text-sm"},et={class:"md:col-span-2 lg:col-span-1"},tt=e("label",{for:"sell-discount",class:"block text-sm font-medium leading-6 text-gray-900"},"Desconto (R$) ",-1),st={class:"relative mt-2 rounded-md shadow-sm"},at=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1),lt=["disabled","value"],ot={key:0,class:"text-red-500 text-sm"},nt={class:"sm:col-span-4"},it={key:0,class:"min-w-full text-left text-sm font-medium leading-6 text-gray-900"},dt={class:"border-b font-medium"},rt=e("th",{scope:"col",class:"px-6 py-4 text-center"},"#",-1),ct=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Item",-1),ut=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Qtd. Estoque",-1),mt=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Qtd. Venda",-1),pt=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Und. Medida",-1),gt=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Preço unitário",-1),_t=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Preço montante",-1),xt={key:0,scope:"col",class:"px-6 py-4 text-center"},ht={class:"whitespace-nowrap py-4 text-center font-medium"},yt={class:"whitespace-nowrap py-4 text-center font-medium"},vt={class:"whitespace-nowrap py-4 text-center font-medium flex justify-center"},ft=["value","onInput","disabled"],bt={class:"whitespace-nowrap py-4 text-center font-medium"},wt={class:"whitespace-nowrap py-4 text-center font-medium"},kt={class:"whitespace-nowrap py-4 text-center font-medium"},qt={key:0,class:"whitespace-nowrap py-4 text-center font-mono text-2xl"},$t=["onClick","title"],Vt={key:1,class:"p-5 bg-gray-200 rounded-md block text-sm font-medium leading-6 text-gray-900"},Ct={key:1,class:"w-full py-4"},St=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Pagamento de entrada",-1),It=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Após a conclusão da compra, um registro de pagamento será criado na página de PAGAMENTOS. ",-1),Dt=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Se algum pagamento de entrada (ou pagamento total) for realizado, registre aqui.",-1),Lt={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-4"},Mt={class:"md:col-span-2 lg:col-span-1 text-gray-700"},Rt={class:"font-extrabold text-green-500"},Ut={class:"md:col-span-2 lg:col-span-1 text-gray-700"},Et={class:"font-extrabold text-green-500"},Ot={class:"md:col-span-2 lg:col-span-1 text-gray-700"},Tt={class:"font-extrabold text-green-500"},jt={class:"md:col-span-2 lg:col-span-1 text-gray-700"},At={class:"font-extrabold text-green-500"},Nt={class:"sm:col-span-2"},Bt=e("label",{for:"sell-entry-value",class:"block text-sm font-medium leading-6 text-gray-900"},"Pagamento de entrada ",-1),Pt={class:"relative mt-2 rounded-md shadow-sm"},zt=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1),Ft=["disabled"],Qt={key:0,class:"text-red-500 text-sm"},Wt={class:"sm:col-span-2"},Gt=e("label",{for:"sell-partial-value",class:"block text-sm font-medium leading-6 text-gray-900"},"Valor restante ",-1),Xt={class:"relative mt-2 rounded-md shadow-sm"},Zt=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1),Ht=["disabled","value"],Jt={key:0,class:"text-red-500 text-sm"},Kt={__name:"CreateUpdateSellsModal",props:{modal:Object,sell:{type:Object,default:null},items:Array},emits:["close","submit"],setup(s,{emit:E}){const O=E,l=s,I=/^\d{4}-\d{2}-\d{2}$/,D=S(()=>{const{client:o,date:a}=l.sell;return!o||!o.length?!1:a&&I.test(a)}),j=S(()=>{const{client:o,date:a,estimated_value:t,total_value:p,entry_value:x,items_list:G}=l.sell;return!o||!o.length||!a||!I.test(a)||!(t>0&&p>0&&x<=p)?!1:G.every(z=>z.quantity>0&&z.movement_quantity<=z.quantity)}),$=S(()=>l.sell.total_value-l.sell.entry_value),h=S(()=>l.modal.mode==="see"),f=N(""),L=N(!1),P=S(()=>l.items.filter(o=>o.name.toLowerCase().includes(f.value.toLowerCase())&&!l.sell.items_list.some(a=>a.id===o.id))),A=o=>{o==="in"&&(L.value=!0),o==="out"&&(L.value=!1)},T=()=>{l.sell.estimated_value=l.sell.items_list.reduce((o,a)=>o+a.price*a.movement_quantity,0),y("estimated_value")},g=o=>{l.sell.items_list.push({id:o.id,name:o.name,quantity:o.quantity,max_quantity:o.max_quantity,min_quantity:o.min_quantity,movement_quantity:1,measurement_unit:o.measurement_unit.abbreviation,price:o.price,amount:o.price}),f.value="",L.value=!1,T()},m=o=>{l.sell.items_list=l.sell.items_list.filter(a=>a.id!==o),T()},r=(o,a)=>{l.sell[a]=o.target.value,y(a)},_=(o,a)=>{const t=10**a;return Math.floor(o*t)/t},y=o=>{let{estimated_value:a,total_value:t,discount_percent:p,discount:x}=l.sell;switch(o){case"estimated_value":case"discount_percent":t=a*(1-p/100),x=a-t;break;case"total_value":x=a-t,p=x/a*100;break;case"discount":p=x/a*100,t=a-x;break}Object.assign(l.sell,{estimated_value:a,total_value:t,discount_percent:p,discount:x})},w=()=>{O("close")},M=()=>{O("submit")};return(o,a)=>(n(),R(ee,{show:s.modal.show,maxWidth:D.value||h.value?"6xl":"2xl",onClose:w},{icon:q(()=>[e("div",{class:U(["mx-auto shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-400 sm:mx-0 sm:h-10 sm:w-10",{"bg-yellow-400":s.modal.mode==="update","bg-green-400":s.modal.mode==="pay","bg-gray-400":s.modal.mode==="see"}])},[s.modal.mode==="create"?(n(),R(u(ae),{key:0,class:"w-5 h-5 text-white"})):c("",!0),s.modal.mode==="update"?(n(),R(u(le),{key:1,class:"w-5 h-5 text-white"})):c("",!0),s.modal.mode==="pay"?(n(),R(u(K),{key:2,class:"w-5 h-5 text-white"})):c("",!0),s.modal.mode==="see"?(n(),R(u(W),{key:3,class:"w-5 h-5 text-white"})):c("",!0)],2)]),title:q(()=>[b(i(s.modal.title),1)]),content:q(()=>[e("form",{onSubmit:X(M,["prevent"])},[e("div",de,[e("section",re,[ce,ue,e("div",me,[e("div",pe,[ge,e("div",_e,[V(e("input",{type:"text",name:"sell-client",id:"sell-client",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Nome do cliente","onUpdate:modelValue":a[0]||(a[0]=t=>s.sell.client=t),required:""},null,512),[[C,s.sell.client]]),s.sell.errors.client?(n(),d("p",xe,i(s.sell.errors.client),1)):c("",!0)])]),e("div",he,[ye,e("div",ve,[V(e("input",{type:"date",name:"sell-date",id:"sell-date",autocomplete:"on",class:"simple-input disabled:bg-gray-200",autofocus:"true",placeholder:"Data da Venda",max:u(Q)(),"onUpdate:modelValue":a[1]||(a[1]=t=>s.sell.date=t),required:""},null,8,fe),[[C,s.sell.date]]),s.sell.errors.date?(n(),d("p",be,i(s.sell.errors.date),1)):c("",!0)])]),e("div",we,[ke,e("div",qe,[V(e("textarea",{type:"text",observations:"sell-observations",id:"sell-observations",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Descreva a título mais detalhadamente ou insira informações adicionais","onUpdate:modelValue":a[2]||(a[2]=t=>s.sell.observations=t)},null,512),[[C,s.sell.observations]]),s.sell.errors.observations?(n(),d("p",$e,i(s.sell.errors.observations),1)):c("",!0)])])])]),D.value||h.value?(n(),d("section",Ve,[Ce,Se,e("div",Ie,[e("div",De,[e("div",Le,[Me,V(e("input",{id:"item-selecter","onUpdate:modelValue":a[3]||(a[3]=t=>f.value=t),onFocus:a[4]||(a[4]=t=>A("in")),onBlur:a[5]||(a[5]=t=>A("out")),class:"simple-input disabled:bg-gray-200 px-4 py-2 w-full",placeholder:"Digite para pesquisar",disabled:h.value},null,40,Re),[[C,f.value]]),L.value?(n(),d("ul",Ue,[(n(!0),d(B,null,F(P.value,(t,p)=>(n(),d("li",{key:p,class:"py-2 px-4 cursor-pointer hover:bg-gray-200",onMousedown:x=>g(t)},[e("span",{class:U(["inline",{"text-blue-500":t.quantity!=0&&t.quantity>=t.max_quantity,"text-green-500":t.quantity<t.max_quantity&&t.quantity>=t.min_quantity,"text-yellow-500":t.quantity<t.min_quantity&&t.quantity>0,"text-red-500":t.quantity==0}])},"("+i(t.quantity)+")",3),b(" "+i(t.name),1)],40,Ee))),128))])):c("",!0)])]),e("div",Oe,[Te,e("div",je,[Ae,V(e("input",{id:"sell-estimated-amount",type:"number",step:"0.01",min:"0",autocomplete:"off",readonly:"",class:"block w-full rounded-md border-0 py-1.5 pl-9 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6 disabled:bg-gray-200",placeholder:"Valor total estimado",disabled:!s.sell.items_list.length||h.value,"onUpdate:modelValue":a[6]||(a[6]=t=>s.sell.estimated_value=t),required:""},null,8,Ne),[[C,s.sell.estimated_value]]),s.sell.errors.estimated_value?(n(),d("p",Be,i(s.sell.errors.estimated_value),1)):c("",!0)])]),e("div",Pe,[ze,e("div",Fe,[Qe,e("input",{id:"sell-total-amount",type:"number",step:"0.01",min:"0",autocomplete:"off",class:"block w-full rounded-md border-0 py-1.5 pl-9 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6 disabled:bg-gray-200",placeholder:"Valor total estimado",disabled:!s.sell.items_list.length||h.value,value:_(s.sell.total_value,2),onInput:a[7]||(a[7]=t=>r(t,"total_value")),required:""},null,40,We),s.sell.errors.total_value?(n(),d("p",Ge,i(s.sell.errors.total_value),1)):c("",!0)])]),e("div",Xe,[Ze,e("div",He,[e("input",{id:"sell-discount-percent",type:"number",step:"0.01",min:"0",autocomplete:"off",class:"block w-full rounded-md border-0 py-1.5 pr-9 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6 disabled:bg-gray-200",placeholder:"Valor total estimado",disabled:!s.sell.items_list.length||h.value,value:_(s.sell.discount_percent,3),onInput:a[8]||(a[8]=t=>r(t,"discount_percent")),required:""},null,40,Je),Ke,s.sell.errors.discount_percent?(n(),d("p",Ye,i(s.sell.errors.discount_percent),1)):c("",!0)])]),e("div",et,[tt,e("div",st,[at,e("input",{id:"sell-discount",type:"number",step:"0.01",min:"0",autocomplete:"off",class:"block w-full rounded-md border-0 py-1.5 pl-9 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6 disabled:bg-gray-200",placeholder:"Valor total estimado",disabled:!s.sell.items_list.length||h.value,value:_(s.sell.discount,2),onInput:a[9]||(a[9]=t=>r(t,"discount")),required:""},null,40,lt),s.sell.errors.discount?(n(),d("p",ot,i(s.sell.errors.discount),1)):c("",!0)])]),e("div",nt,[l.sell.items_list.length?(n(),d("table",it,[e("thead",dt,[e("tr",null,[rt,ct,ut,mt,pt,gt,_t,s.modal.mode!=="see"?(n(),d("th",xt," Deletar")):c("",!0)])]),e("tbody",null,[(n(!0),d(B,null,F(l.sell.items_list,t=>(n(),d("tr",{key:t.id,class:U(["border-b transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid",{"bg-yellow-100":t.movement_quantity==t.quantity,"bg-red-100":t.movement_quantity>t.quantity}])},[e("td",ht,i(t.id),1),e("td",yt,i(t.name),1),e("td",{class:U(["whitespace-nowrap py-4 text-center font-medium",{"text-blue-500":t.quantity!=0&&t.quantity>=t.max_quantity,"text-green-500":t.quantity<t.max_quantity&&t.quantity>=t.min_quantity,"text-yellow-500":t.quantity<t.min_quantity&&t.quantity>0,"text-red-500":t.quantity==0}])},i(t.quantity),3),e("td",vt,[e("input",{type:"number",min:"0.01",step:"0.01",value:t.movement_quantity,onInput:p=>{t.movement_quantity=p.target.value,t.amount=t.price*p.target.value,T()},class:"simple-input disabled:bg-gray-200 w-2/3",disabled:s.modal.mode!=="create"},null,40,ft)]),e("td",bt,i(t.measurement_unit),1),e("td",wt,i(u(v)(t.price)),1),e("td",kt,i(u(v)(t.amount?t.amount:10)),1),s.modal.mode!=="see"?(n(),d("td",qt,[e("button",{onClick:p=>m(t.id),title:"Remover "+t.name},"×",8,$t)])):c("",!0)],2))),128))])])):(n(),d("p",Vt," Nenhum item selecionado até o momento!"))])])])):c("",!0),D.value&&s.sell.items_list.length&&s.modal.mode==="create"?(n(),d("section",Ct,[St,It,Dt,e("div",Lt,[e("div",Mt,[b("Valor estimado: "),e("span",Rt,i(u(v)(s.sell.estimated_value)),1)]),e("div",Ut,[b("Valor final: "),e("span",Et,i(u(v)(s.sell.total_value)),1)]),e("div",Ot,[b("Desconto (%): "),e("span",Tt,i(_(s.sell.discount_percent,3))+"%",1)]),e("div",jt,[b("Desconto (R$): "),e("span",At,i(u(v)(s.sell.discount)),1)]),e("div",Nt,[Bt,e("div",Pt,[zt,V(e("input",{id:"sell-entry-value",type:"number",step:"0.01",min:"0",autocomplete:"off",class:"block w-full rounded-md border-0 py-1.5 pl-9 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6 disabled:bg-gray-200",placeholder:"Valor de pagamneto de entrada",disabled:!s.sell.items_list.length||h.value,"onUpdate:modelValue":a[10]||(a[10]=t=>s.sell.entry_value=t),required:""},null,8,Ft),[[C,s.sell.entry_value]]),s.sell.errors.entry_value?(n(),d("p",Qt,i(s.sell.errors.entry_value),1)):c("",!0)])]),e("div",Wt,[Gt,e("div",Xt,[Zt,e("input",{id:"sell-partial-value",type:"number",step:"0.01",min:"0",autocomplete:"off",class:"block w-full rounded-md border-0 py-1.5 pl-9 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6 disabled:bg-gray-200",placeholder:"Valor restante para pagamento posterior",disabled:!s.sell.items_list.length||h.value,value:_($.value,2),readonly:"",required:""},null,8,Ht),s.sell.errors.partial_value?(n(),d("p",Jt,i(s.sell.errors.partial_value),1)):c("",!0)])])])])):c("",!0)])],32)]),footer:q(()=>[s.modal.mode!=="see"?(n(),R(se,{key:0,class:U({disabled:s.sell.processing}),onClick:a[11]||(a[11]=t=>w())},{default:q(()=>[b(" Cancelar ")]),_:1},8,["class"])):c("",!0),k(te,{class:U({disabled:s.sell.processing||!j.value}),disabled:s.sell.processing||!j.value,onClick:a[12]||(a[12]=t=>M())},{default:q(()=>[b(i(s.modal.primary_button_txt),1)]),_:1},8,["class","disabled"])]),_:1},8,["show","maxWidth"]))}},Yt={class:"font-semibold text-xl text-gray-800 leading-tight"},es={class:"pt-12 print:hidden print:pt-0"},ts={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 print:w-full"},ss={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-5"},as={class:"flex flex-row items-center space-x-3"},ls={class:"py-12 print:py-6"},os={class:"max-w-7xl mx-auto print:max-w-full"},ns={class:"px-0 print:px-0"},is={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg print:shadow-none"},ds={class:"flex flex-col"},rs={class:"overflow-x-auto sm:-mx-6 lg:-mx-8"},cs={class:"inline-block min-w-full py-2 sm:px-6 lg:px-8"},us={class:"overflow-hidden"},ms={class:"min-w-full text-left text-sm font-light"},ps=e("thead",{class:"border-b font-medium"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-4 text-center"},"#"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Cliente"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"À pagar"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Valor total"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Data da Venda "),e("th",{scope:"col",class:"px-6 py-4 text-center print:hidden",colspan:"2"}," Ações")])],-1),gs={class:"border-b transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid"},_s={class:"whitespace-nowrap py-4 text-center font-medium"},xs={class:"whitespace-normal px-6 py-4 text-center trim"},hs=["title"],ys={class:"whitespace-nowrap px-2 py-4 text-center"},vs={class:"whitespace-nowrap px-2 py-4 text-center"},fs={class:"whitespace-nowrap px-2 py-4 text-center print:hidden"},bs=["title","onClick"],ws=["title","onClick"],ks={key:1,class:"transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid"},qs=e("td",{class:"whitespace-nowrap px-6 py-4 text-center",colspan:"9"},"Não há vendas cadastradas no momento!",-1),$s=[qs],Ps={__name:"Sells",props:{page:Object,page_options:{type:Array,default:null},sells_list:Object,items:Object},setup(s){const E=s,O=Z.useToast(),l=H({id:null,client:"",date:Q(),estimated_value:0,total_value:0,partial_value:0,discount_percent:0,discount:0,entry_value:0,observations:"",items_list:[]}),I=N(""),D=S(()=>{const g=I.value.toLowerCase();return E.sells_list.filter(m=>{const{id:r,entity_name:_,observations:y,date:w,accounting:M,items:o}=m,{total_value:a,partial_value:t}=M,p=[r.toString(),(_==null?void 0:_.toLowerCase())??"",(y==null?void 0:y.toLowerCase())??"",(w==null?void 0:w.toLowerCase())??"",v(a).toLowerCase()??"",v(t).toLowerCase()??""];for(let x of p)if(x.includes(g))return!0;return o.some(x=>x.name.toLowerCase().includes(g))})}),j=S(()=>E.sells_list.reduce((g,m)=>g+m.accounting.partial_value,0)),$=N({mode:"create",show:!1,get title(){switch(this.mode){case"create":return"Criar venda";case"update":return"Editar venda";case"see":return"Ver informações da venda"}},get primary_button_txt(){switch(this.mode){case"create":return"Cadastrar";case"update":return"Atualizar";case"see":return"Fechar"}}}),h=(g,m=null)=>{const r=["update","see"].includes(g);if(m!==null&&r){const _=E.sells_list.find(y=>y.id===m);if(_){const{id:y,entity_name:w,date:M,observations:o,accounting:a,items:t}=_;l.id=y,l.client=w,l.date=M,l.estimated_value=a.estimated_value,l.total_value=a.total_value,l.partial_value=a.partial_value,l.entry_value=0,l.discount=a.estimated_value-a.total_value,l.discount_percent=l.discount/(a.estimated_value||1)*100,l.observations=o,l.items_list=t}}$.value.mode=g,$.value.show=!0},f=()=>{l.reset(),$.value.show=!1},L=()=>{l.post(route("sells.store"),{preserveScroll:!0,onSuccess:()=>f(),onError:g=>{console.log(g)}})},P=()=>{l.put(route("sells.update",l.id),{preserveScroll:!0,onSuccess:()=>f()})},A=(g,m)=>{confirm(`Você tem certeza que deseja excluir a venda de material para "${m}"? Todos os materiais comprados voltarão para o estoque! Esta ação não poderá ser desfeita!`)&&l.delete(route("sells.destroy",g),{preserveScroll:!0,onSuccess:()=>O.success("Venda deletado com sucesso!")})},T=()=>{switch($.value.mode){case"create":return L();case"update":return P();case"see":return f();default:O.error("Método desconhecido. Informar o Técnico.")}};return(g,m)=>(n(),d(B,null,[k(u(J),{title:s.page.name},null,8,["title"]),k(Y,{page:s.page,page_options:s.page_options},{header:q(()=>[e("h2",Yt,i(s.page.name)+" | "+i(u(v)(j.value)),1),k(ne,{icon:"plus",onClick:m[0]||(m[0]=r=>h("create")),title:"Cadastrar Sell",class:"print:hidden"})]),default:q(()=>[e("div",es,[e("div",ts,[e("div",ss,[e("div",as,[k(u(ie),{class:"w-5 y-5"}),V(e("input",{type:"text",name:"search_term",id:"search_term",autocomplete:"on",class:"simple-input",autofocus:"true",placeholder:"Pesquisar termo...","onUpdate:modelValue":m[1]||(m[1]=r=>I.value=r)},null,512),[[C,I.value]])])])])]),e("div",ls,[e("div",os,[e("div",ns,[e("div",is,[e("div",ds,[e("div",rs,[e("div",cs,[e("div",us,[e("table",ms,[ps,e("tbody",null,[D.value.length?(n(!0),d(B,{key:0},F(D.value,r=>(n(),d("tr",gs,[e("td",_s,i(r.id),1),e("td",xs,[b(i(r.entity_name)+" ",1),r.observations?(n(),d("span",{key:0,title:r.observations,class:"inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10 cursor-help"},"OBS",8,hs)):c("",!0)]),e("td",ys,i(u(v)(r.accounting.partial_value)),1),e("td",vs,i(r.accounting.total_value>0?u(v)(r.accounting.total_value):"Pago"),1),e("td",fs,i(u(Q)(r.date,!0)),1),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-indigo-700 active:text-indigo-900 select-none print:hidden",title:"VER: Compra de "+r.entity_name,onClick:_=>h("see",r.id)},[k(u(W),{class:"w-5 h-5 m-auto"})],8,bs),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-red-700 active:text-red-900 select-none print:hidden",title:"EXCLUIR: Compra de "+r.entity_name,onClick:_=>A(r.id,r.entity_name)},[k(u(oe),{class:"w-5 h-5 m-auto"})],8,ws)]))),256)):(n(),d("tr",ks,$s))])])])])])])])])])]),k(Kt,{modal:$.value,sell:u(l),items:s.items,onSubmit:T,onClose:f},null,8,["modal","sell","items"])]),_:1},8,["page","page_options"])],64))}};export{Ps as default};
