import{m as Y,T as D,r as b,p as ee,y as z,k as M,d as a,o as n,b as m,u as p,Z as te,w as B,a as e,e as d,s as N,v as se,H as oe,F as S,g as O,n as L,t as l,f as h}from"./app-nxAEGYom.js";import{_ as ae}from"./AppLayout-CD0ic9x9.js";import{_ as ne}from"./CreateUpdatePayModal-BdKvy0qR.js";import{_ as re}from"./FloatButton-SJT_ARUZ.js";import{_ as ie}from"./ExtraOptionsButton-dJzcEZHb.js";import{t as k,f as U}from"./general-D_37hS-e.js";/* empty css                    */import{r as le}from"./MagnifyingGlassIcon-DL4qMqmq.js";import{r as ce}from"./BanknotesIcon-BbnfpIH-.js";import{r as de}from"./PencilIcon-BWmfVFjA.js";import{r as pe}from"./XMarkIcon-B7I7P2AW.js";import"./CreateUpdateModal-Cr9-t6ta.js";import"./Modal-BAbBhbNO.js";import"./PrimaryButton-DeVtbJBJ.js";import"./SecondaryButton-BQZMIPc2.js";import"./ClientSelector-CaM6P7Eb.js";import"./lodash-Bti6KRHC.js";import"./PlusIcon-C0zORJhm.js";import"./PrinterIcon-CEXel4vh.js";import"./ArrowUturnLeftIcon-CCc7Pjxd.js";const ue={class:"font-semibold text-xl text-gray-800 leading-tight"},me={key:0},_e={key:1,class:"text-neutral-400"},he=e("span",{class:"text-xs"}," (pagamentos + serviços)",-1),xe={class:"pt-12 print:hidden"},ve={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},ye={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-5"},ge={class:"flex flex-row items-center space-x-3"},fe={class:"ml-8 mt-1"},we=["checked"],be=e("label",{for:"show-services",class:"ml-3 text-xs text-neutral-500 select-none"},"Mostrar serviços",-1),ke={class:"py-12 print:py-0"},Ce={class:"max-w-7xl mx-auto print:max-w-full"},$e={class:"w-full flex justify-end pb-3 print:hidden"},Pe={class:"px-0 print:px-0"},Me={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg print:shadow-none"},Se={class:"flex flex-col"},Te={class:"overflow-x-auto sm:-mx-6 lg:-mx-8"},Ee={class:"inline-block min-w-full py-2 sm:px-6 lg:px-8"},je={class:"overflow-hidden"},Ve={class:"w-full text-left text-sm font-light"},Ae={class:"border-b font-medium"},De=e("th",{scope:"col",class:"px-6 py-4 text-center"},"#",-1),ze=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Dívida",-1),Be=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Devedor",-1),Ne=e("th",{scope:"col",class:"px-6 py-4 text-center"},"À pagar",-1),Oe=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Valor total",-1),Le=e("th",{scope:"col",class:"px-6 py-4 text-center print:hidden"},"Pagar ",-1),Ue=e("th",{scope:"col",class:"px-6 py-4 text-center print:hidden"},"Editar ",-1),Fe=e("th",{scope:"col",class:"px-6 py-4 text-center print:hidden"},"Excluir ",-1),He={key:0,scope:"col",class:"px-6 py-4 text-center print:hidden"},Ie={key:1,scope:"col",class:"px-6 py-4 text-center print:hidden"},Re={key:2,scope:"col",class:"px-6 py-4 text-center print:hidden"},qe={key:3,scope:"col",class:"px-6 py-4 text-center print:hidden"},Ge={class:"whitespace-nowrap py-4 text-center font-medium"},Xe={class:"break-words px-6 py-4 text-center"},Ze=["title"],Je={class:"whitespace-normal px-6 py-4 text-center"},Ke={class:"whitespace-nowrap px-2 py-4 text-center"},Qe={class:"whitespace-nowrap px-2 py-4 text-center"},We=["title","onClick"],Ye=["title","onClick"],et=["title","onClick"],tt={key:1,class:"whitespace-nowrap px-4 py-4 text-center select-none print:hidden"},st={key:2,class:"whitespace-nowrap px-2 py-4 text-center print:hidden"},ot={key:3,class:"whitespace-nowrap px-2 py-4 text-center print:hidden"},at={key:4,class:"whitespace-nowrap px-2 py-4 text-center print:hidden"},nt={key:5,class:"whitespace-nowrap px-2 py-4 text-center print:hidden"},rt={key:1,class:"transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid"},it=e("td",{class:"whitespace-nowrap px-6 py-4 text-center",colspan:"9"},"Não há pagamentos cadastrados no momento!",-1),lt=[it],ct={key:0,class:"print:hidden flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6"},dt={class:"flex flex-1 justify-between sm:hidden"},pt=["disabled"],ut=["disabled"],mt={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},_t={class:"text-sm text-gray-700"},ht={class:"font-medium"},xt={class:"font-medium"},vt={class:"font-medium"},yt={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},gt=["onClick","disabled","innerHTML"],Ft={__name:"Payment",props:{page:Object,page_options:{type:Array,default:null},payments_list:Object,filters:Object},setup(i){var j;const v=i,T=Y.useToast(),r=D({id:null,debt:"",client_id:"",total_value:0,partial_value:0,observations:"",records_list:{enable_records:!1,data:[]}}),y=b(((j=v.filters)==null?void 0:j.search)||""),g=b(!0),c=b(!1);let C=null;ee(y,s=>{C&&clearTimeout(C),C=setTimeout(()=>{z.get(route("payments.index"),{search:s},{preserveState:!0,replace:!0})},300)});const E=M(()=>v.payments_list.data),F=M(()=>v.payments_list.data.reduce((s,o)=>s+o.accounting.partial_value,0)),H=M(()=>v.payments_list.data.filter(s=>s.type!==1).reduce((s,o)=>s+o.accounting.partial_value,0)),x=b({mode:"create",show:!1,get title(){switch(this.mode){case"create":return"Criar pagamento";case"update":return"Editar pagamento";case"pay":return"Pagar pagamento"}},get primary_button_txt(){switch(this.mode){case"create":return"Cadastrar";case"update":return"Atualizar";case"pay":return"Pagar"}}}),$=(s,o=null)=>{const t=["update","pay"].includes(s);if(o!==null&&t){const u=v.payments_list.data.find(_=>_.id===o);if(u){const{id:_,type:w,client_id:Z,client:J,motive:K,entity_name:ft,observations:Q,records:V,accounting:A}=u;r.id=_,r.type=w,r.debt=K,r.client_id=Z,r.client=J,r.total_value=A.total_value,r.partial_value=A.partial_value,r.observations=Q,r.records_list.enable_records=!!V.length,r.records_list.data=V.map(W=>D(W))}}x.value.mode=s,x.value.show=!0},f=()=>{r.reset(),x.value.show=!1},P=s=>{s&&z.get(s,{search:y.value},{preserveState:!0,preserveScroll:!0})},I=()=>{r.post(route("payments.store"),{preserveScroll:!0,onSuccess:()=>f(),onError:s=>{console.log(s)}})},R=()=>{r.put(route("payments.update",r.id),{preserveScroll:!0,onSuccess:()=>f()})},q=()=>{r.put(route("payments.pay",r.id),{preserveScroll:!0,onSuccess:()=>f(),onError:s=>{console.log(s)}})},G=(s,o)=>{confirm(`Você tem certeza que deseja excluir o pagamento "${o}"? Esta ação não poderá ser desfeita!`)&&r.delete(route("payments.destroy",s),{preserveScroll:!0,onSuccess:()=>T.success("Pagamento deletado com sucesso!")})},X=()=>{switch(x.value.mode){case"create":return I();case"update":return R();case"pay":return q();default:T.error("Método desconhecido. Informar o Técnico.")}};return(s,o)=>(n(),a(S,null,[m(p(te),{title:i.page.name},null,8,["title"]),m(ae,{page:i.page,page_options:i.page_options},{header:B(()=>[e("h2",ue,[h(l(i.page.name)+" ",1),s.$page.props.auth.user.hierarchy<2?(n(),a("span",me,"| "+l(p(k)(H.value)),1)):d("",!0),s.$page.props.auth.user.hierarchy<2?(n(),a("span",_e,[h(" | "+l(p(k)(F.value))+" ",1),he])):d("",!0)]),m(re,{icon:"plus",onClick:o[0]||(o[0]=t=>$("create")),title:"Cadastrar Payment",class:"print:hidden"})]),default:B(()=>[e("div",xe,[e("div",ve,[e("div",ye,[e("div",ge,[m(p(le),{class:"w-5 y-5"}),N(e("input",{type:"text",name:"search_term",id:"search_term",autocomplete:"on",class:"simple-input",autofocus:"true",placeholder:"Pesquisar termo...","onUpdate:modelValue":o[1]||(o[1]=t=>y.value=t)},null,512),[[se,y.value]])]),e("div",fe,[N(e("input",{type:"checkbox",id:"show-services",class:"focus:ring-green-700 text-green-700 border-neutral-500 rounded-sm disabled:opacity-50","onUpdate:modelValue":o[2]||(o[2]=t=>g.value=t),checked:g.value},null,8,we),[[oe,g.value]]),be])])])]),e("div",ke,[e("div",Ce,[e("div",$e,[c.value?d("",!0):(n(),a("button",{key:0,class:"text-blue-500 text-xs justify-end",onClick:o[3]||(o[3]=t=>c.value=!c.value)},"Mostrar dados de usuário")),c.value?(n(),a("button",{key:1,class:"text-red-500 text-xs justify-end",onClick:o[4]||(o[4]=t=>c.value=!c.value)},"Esconder dados de usuário")):d("",!0)]),e("div",Pe,[e("div",Me,[e("div",Se,[e("div",Te,[e("div",Ee,[e("div",je,[e("table",Ve,[e("thead",Ae,[e("tr",null,[De,ze,Be,Ne,Oe,Le,Ue,Fe,c.value?(n(),a("th",He,"Criado em")):d("",!0),c.value?(n(),a("th",Ie,"Criado por")):d("",!0),c.value?(n(),a("th",Re," Modificado em")):d("",!0),c.value?(n(),a("th",qe," Modificado por ")):d("",!0)])]),e("tbody",null,[E.value.length?(n(!0),a(S,{key:0},O(E.value,t=>{var u,_;return n(),a("tr",{key:t.id,class:L(["border-b transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid",{hidden:t.type===1&&g.value===!1}])},[e("td",Ge,l(t.id),1),e("td",Xe,[h(l(t.motive)+" ",1),t.observations?(n(),a("span",{key:0,title:t.observations,class:"inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10 cursor-help"},"OBS",8,Ze)):d("",!0)]),e("td",Je,l(((u=t==null?void 0:t.client)==null?void 0:u.name)||t.entity_name),1),e("td",Ke,l(p(k)(t.accounting.partial_value)),1),e("td",Qe,l(p(k)(t.accounting.total_value)),1),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-green-700 active:text-green-900 select-none print:hidden",title:"PAGAR: "+t.motive+"("+t.entity_name+")",onClick:w=>$("pay",t.id)},[m(p(ce),{class:"w-5 h-5 m-auto"})],8,We),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-yellow-700 active:text-yellow-900 select-none print:hidden",title:"EDITAR: "+t.motive+"("+t.entity_name+")",onClick:w=>$("update",t.id)},[m(p(de),{class:"w-5 h-5 m-auto"})],8,Ye),t.type!==2?(n(),a("td",{key:0,class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-red-700 active:text-red-900 select-none print:hidden",title:"EXCLUIR: "+t.motive+"("+t.entity_name+")",onClick:w=>G(t.id,t.motive)},[m(p(pe),{class:"w-5 h-5 m-auto"})],8,et)):(n(),a("td",tt," Venda ")),c.value?(n(),a("td",st,l(p(U)(t.created_at,"reading_date_time")),1)):d("",!0),c.value?(n(),a("td",ot,l(t.procedures[0].user.name),1)):d("",!0),c.value?(n(),a("td",at,l(p(U)(t.updated_at,"reading_date_time")),1)):d("",!0),c.value?(n(),a("td",nt,l(t.procedures[((_=t.procedures)==null?void 0:_.length)-1].user.name),1)):d("",!0)],2)}),128)):(n(),a("tr",rt,lt))])])])])])])])])])]),i.payments_list.total>0?(n(),a("div",ct,[e("div",dt,[e("button",{onClick:o[5]||(o[5]=t=>P(i.payments_list.prev_page_url)),disabled:!i.payments_list.prev_page_url,class:"relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50"},"Anterior",8,pt),e("button",{onClick:o[6]||(o[6]=t=>P(i.payments_list.next_page_url)),disabled:!i.payments_list.next_page_url,class:"relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50"},"Próximo",8,ut)]),e("div",mt,[e("div",null,[e("p",_t,[h(" Mostrando de "),e("span",ht,l(i.payments_list.from),1),h(" a "),e("span",xt,l(i.payments_list.to),1),h(" de "),e("span",vt,l(i.payments_list.total),1),h(" resultados ")])]),e("div",null,[e("nav",yt,[(n(!0),a(S,null,O(i.payments_list.links,(t,u)=>(n(),a("button",{key:u,onClick:_=>P(t.url),disabled:!t.url,class:L(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20",{"z-10 bg-green-600 text-white focus-visible:outline-green-600":t.active,"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:outline-offset-0 disabled:opacity-50":!t.active,"rounded-l-md":u===0,"rounded-r-md":u===i.payments_list.links.length-1}]),innerHTML:t.label},null,10,gt))),128))])])])])):d("",!0),m(ne,{show:x.value.show,modal:x.value,payment:p(r),onSubmit:X,onClose:f},null,8,["show","modal","payment"]),m(ie,{mode:["rollup","print_page","link"],link_type:["previous"],link:[s.route("payments.previous")]},null,8,["link"])]),_:1},8,["page","page_options"])],64))}};export{Ft as default};
