import{d as j,l as w,p as F,y as H,G as X,e as o,o as s,q as h,f as r,v as f,a as t,i as I,F as O,h as P,t as u,u as _,b as E,n as z,s as T,B as M,T as A,c as S,w as U,g as L}from"./app-CZkq5Z-4.js";import{_ as G}from"./CreateUpdateModal-BgXUm0af.js";import{_ as W}from"./PrimaryButton-d3GyyHQH.js";import{_ as J}from"./SecondaryButton-BvordoBr.js";import{f as q,k as K,t as N,j as Q}from"./general-NIAW1A15.js";import{a as Y,r as Z}from"./XMarkIcon-BdHH6tt4.js";import{r as ee}from"./PlusIcon-BzKLYwAn.js";import{r as te}from"./AppLayout-D2xbGot6.js";import{r as se}from"./EyeIcon-DZjMa3-U.js";const oe={class:"relative dropdown-container"},ae=["disabled"],de={key:0,class:"absolute w-full mt-2 bg-white border rounded shadow-md max-h-40 overflow-y-auto z-10"},ie=["onClick"],re={key:0},le={class:"flex gap-2 justify-between"},ne={class:"flex gap-2"},ce={class:"font-bold text-gray-800"},ue={class:"text-gray-600"},me={class:"text-gray-600 justify-end"},ve={class:"text-gray-600"},_e={key:1},ge=t("div",{class:"flex gap-2"},[t("div",{class:"text-gray-600"},"Nenhuma venda relacionada")],-1),be=[ge],he={key:0,class:"px-4 py-2 text-gray-500"},xe={__name:"SelectSearchSell",props:{options:{type:Array,required:!0,default:()=>[]},disable_services_inputs:{type:Boolean,default:!0},initialValue:{type:Number,default:null}},emits:["update:modelValue"],setup(e,{emit:k}){const l=e,a=k,b=j(""),g=j(!1),x=j(l.options.find(i=>i.id===l.initialValue)),y=()=>{g.value=!0},v=()=>{g.value=!1},d=i=>{var n,m;i&&i.id!==null?(b.value=`#${i.id} ${i.entity_name||"-"} | R$ ${((m=(n=i.accounting)==null?void 0:n.total_value)==null?void 0:m.toFixed(2))||"0.00"} (${i.date?new Date(i.date).toLocaleDateString():"-"})`,x.value=i.id):(b.value="",x.value=null)},D=i=>{typeof i=="string"?(b.value=i,x.value=null):(d(i!=null&&i.id?i:null),v()),a("update:modelValue",x.value)},c=w(()=>{const i=l.options.filter(n=>n.motive&&n.motive.toLowerCase().includes(b.value.toLowerCase())||n.entity_name&&n.entity_name.toLowerCase().includes(b.value.toLowerCase())||String(n.id).includes(b.value));return[{id:null,entity_name:"Nenhuma venda relacionada",motive:null,date:null,accounting:{total_value:0}},...i]}),V=i=>{i.target.closest(".dropdown-container")||v()};return F(()=>{if(document.addEventListener("click",V),l.initialValue!==null&&l.initialValue!==void 0){const i=l.options.find(n=>n.id===l.initialValue);i&&(d(i),a("update:modelValue",i.id))}}),H(()=>l.initialValue,i=>{if(i!=null){const n=l.options.find(m=>m.id===i);n&&(d(n),a("update:modelValue",n.id))}else d(null)}),X(()=>{document.removeEventListener("click",V)}),(i,n)=>(s(),o("div",oe,[h(t("input",{"onUpdate:modelValue":n[0]||(n[0]=m=>b.value=m),onFocus:y,onClick:n[1]||(n[1]=I(()=>{},["stop"])),onInput:n[2]||(n[2]=m=>D(m.target.value)),disabled:e.disable_services_inputs,class:"simple-input disabled:bg-gray-200",type:"text",placeholder:"Selecione ou escreva o ID, cliente ou motivo da venda"},null,40,ae),[[f,b.value]]),g.value?(s(),o("ul",de,[(s(!0),o(O,null,P(c.value,(m,R)=>(s(),o("li",{key:R,onClick:B=>D(m),class:"px-4 py-2 space-y-1 cursor-pointer hover:bg-gray-200 text-sm"},[m.id!==null?(s(),o("div",re,[t("div",le,[t("div",ne,[t("div",ce,"#"+u(m.id),1),t("div",ue,u(m.entity_name||"-"),1)]),t("div",me,u(m.date?new Date(m.date).toLocaleDateString():"-"),1)]),t("div",ve,"R$"+u(m.accounting?m.accounting.total_value.toFixed(2):"0.00"),1)])):(s(),o("div",_e,be))],8,ie))),128)),c.value.length===0?(s(),o("li",he," Nenhuma opção encontrada ")):r("",!0)])):r("",!0)]))}},ye={class:"py-4"},fe=t("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Informações Básicas",-1),pe=t("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Informações sobre o serviço como título do serviço, nome do cliente, valores de pagamento e prazo para conclusão",-1),$e={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"},we={class:"sm:col-span-6"},ke=t("label",{for:"service-title",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Título",-1),Ve={class:"mt-2"},De=["disabled"],Ce={key:0,class:"text-red-500 text-sm"},Se={class:"sm:col-span-3"},qe=t("label",{for:"service-client",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Cliente",-1),Ue={class:"mt-2"},Re=["disabled"],Ee={key:0,class:"text-red-500 text-sm"},je={class:"sm:col-span-3"},ze=t("label",{for:"service-total-amount",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Valor total",-1),Ne={class:"mt-2"},Be=["disabled"],Le={key:0,class:"text-red-500 text-sm"},Te={class:"sm:col-span-6"},Ae=t("label",{for:"service-deadline",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Prazo para conclusão",-1),Ie={class:"mt-2"},Oe=["min","disabled"],Pe={key:0,class:"text-red-500 text-sm"},Me={key:0,class:"sm:col-span-6"},Fe=t("label",{for:"service-delay-reason",class:"block text-sm font-medium leading-6 text-gray-900"},"Motivo do Atraso",-1),He={class:"mt-2"},Xe=["disabled"],Ge={key:0,class:"text-red-500 text-sm"},We={class:"sm:col-span-6"},Je=t("label",{for:"service-observations",class:"block text-sm font-medium leading-6 text-gray-900"},"Observações",-1),Ke={class:"mt-2"},Qe=["disabled"],Ye={key:0,class:"text-red-500 text-sm"},Ze={class:"sm:col-span-6"},et=t("label",{for:"service-sell",class:"block text-sm font-medium leading-6 text-gray-900"},"Venda relacionada",-1),tt={class:"mt-2"},st={key:0,class:"text-red-500 text-sm"},ot={__name:"ServiceBasicInfoSection",props:{service:Object,sells_list:Array,disable_services_inputs:Boolean,modal_mode:String},setup(e){return(k,l)=>(s(),o("section",ye,[fe,pe,t("div",$e,[t("div",we,[ke,t("div",Ve,[h(t("input",{type:"text",name:"service-title",id:"service-title",autocomplete:"on",class:"simple-input disabled:bg-gray-200",autofocus:"true",placeholder:"Título da título",disabled:e.disable_services_inputs,"onUpdate:modelValue":l[0]||(l[0]=a=>e.service.title=a),required:""},null,8,De),[[f,e.service.title]]),e.service.errors.title?(s(),o("p",Ce,u(e.service.errors.title),1)):r("",!0)])]),t("div",Se,[qe,t("div",Ue,[h(t("input",{type:"text",name:"service-client",id:"service-client",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Nome do cliente",disabled:e.disable_services_inputs,"onUpdate:modelValue":l[1]||(l[1]=a=>e.service.client=a),required:""},null,8,Re),[[f,e.service.client]]),e.service.errors.client?(s(),o("p",Ee,u(e.service.errors.client),1)):r("",!0)])]),t("div",je,[ze,t("div",Ne,[h(t("input",{id:"service-total-amount",name:"service-total-amount",type:"number",step:"0.01",min:"0",autocomplete:"off",class:"simple-input disabled:bg-gray-200",placeholder:"Valor total inicial da título",disabled:e.disable_services_inputs,"onUpdate:modelValue":l[2]||(l[2]=a=>e.service.total_value=a),required:""},null,8,Be),[[f,e.service.total_value]]),e.service.errors.total_value?(s(),o("p",Le,u(e.service.errors.total_value),1)):r("",!0)])]),t("div",Te,[Ae,t("div",Ie,[h(t("input",{type:"date",name:"service-deadline",id:"service-deadline",autocomplete:"on",class:"simple-input disabled:bg-gray-200",autofocus:"true",placeholder:"Prazo para conclusão",min:_(q)(),disabled:e.disable_services_inputs||e.modal_mode!=="create","onUpdate:modelValue":l[3]||(l[3]=a=>e.service.deadline=a),required:""},null,8,Oe),[[f,e.service.deadline]]),e.service.errors.deadline?(s(),o("p",Pe,u(e.service.errors.deadline),1)):r("",!0)])]),e.modal_mode!=="create"&&_(K)(e.service.deadline)<4?(s(),o("div",Me,[Fe,t("div",He,[h(t("textarea",{type:"text",name:"service-delay-reason",id:"service-delay-reason",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Descreva o motivo do atraso do serviço",disabled:e.disable_services_inputs,"onUpdate:modelValue":l[4]||(l[4]=a=>e.service.delay_reason=a)},null,8,Xe),[[f,e.service.delay_reason]]),e.service.errors.delay_reason?(s(),o("p",Ge,u(e.service.errors.delay_reason),1)):r("",!0)])])):r("",!0),t("div",We,[Je,t("div",Ke,[h(t("textarea",{type:"text",name:"service-observations",id:"service-observations",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Descreva a título mais detalhadamente ou insira informações adicionais",disabled:e.disable_services_inputs,"onUpdate:modelValue":l[5]||(l[5]=a=>e.service.observations=a)},null,8,Qe),[[f,e.service.observations]]),e.service.errors.observations?(s(),o("p",Ye,u(e.service.errors.observations),1)):r("",!0)])]),t("div",Ze,[et,t("div",tt,[E(xe,{options:e.sells_list,"onUpdate:modelValue":l[6]||(l[6]=a=>e.service.previous_id=a),disable_services_inputs:e.disable_services_inputs,initialValue:e.service.previous_id},null,8,["options","disable_services_inputs","initialValue"]),e.service.errors.previous_id?(s(),o("p",st,u(e.service.errors.previous_id),1)):r("",!0)])])])]))}},at={key:0,class:"py-4"},dt={class:"sm:col-span-6"},it=["title"],rt={class:"flex h-6 items-center"},lt=["disabled","checked"],nt={class:"text-sm leading-6"},ct={__name:"ServiceEnableRecordsSection",props:{modal_mode:String,can_add_record:Boolean,enable_records:Boolean},emits:["toggle-enable-records"],setup(e,{emit:k}){const l=k,a=()=>{l("toggle-enable-records")};return(b,g)=>e.modal_mode==="create"?(s(),o("section",at,[t("div",dt,[t("div",{class:"mt-2 relative flex gap-x-3",title:e.can_add_record?"":"Preencha ao menos a título, o cliente e o valor total."},[t("div",rt,[t("input",{id:"service-enable-records",name:"service-enable-records",type:"checkbox",onChange:g[0]||(g[0]=x=>a()),disabled:!e.can_add_record,class:"h-4 w-4 rounded border-gray-300 text-green-600 focus:ring-green-600 disabled:border-gray-100 disabled:text-green-200 disabled:bg-gray-300",checked:e.enable_records},null,40,lt)]),t("div",nt,[t("label",{for:"service-enable-records",class:z(["font-medium text-gray-900 select-none cursor-pointer",{"text-gray-300":!e.can_add_record,"cursor-not-allowed":!e.can_add_record}])},"Adicionar pagamentos concluídos",2)])],8,it)])])):r("",!0)}},ut={class:"py-4"},mt={key:0},vt=t("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Pagamentos concluídos",-1),_t=t("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Insira o adiantamento ou os serviços parciais já realizando desta título",-1),gt=[vt,_t],bt={key:1},ht=t("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Lista de pagamentos concluídos",-1),xt=t("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Abaixo está listado os registros de serviços realizados. Para adicionar novos serviços, ou remover algum serviço existente, entre na seção de serviço.",-1),yt=[ht,xt],ft={key:2},pt=t("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Realize um novo pagamento",-1),$t=t("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Adicione um serviço ou remova um serviço existente.",-1),wt=[pt,$t],kt={key:3},Vt=t("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Veja a lista de pagamentos realizados",-1),Dt=t("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Abaixo segue a lista dos pagamentos concluídos deste serviço ",-1),Ct=[Vt,Dt],St={key:4,class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-4 sm:grid-cols-6"},qt={class:"col-span-2"},Ut=t("label",{for:"record-amount",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Valor (R$)",-1),Rt={class:"mt-2"},Et=["max","disabled"],jt={class:"text-gray-400 text-xs py-1"},zt={key:0,class:"text-red-500 text-sm"},Nt={class:"sm:col-span-2"},Bt=t("label",{for:"record-date",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Data do serviço",-1),Lt={class:"mt-2"},Tt=["max","disabled"],At=t("p",{class:"text-gray-400 text-xs py-1"},"Não aceita datas no futuro",-1),It={key:0,class:"text-red-500 text-sm"},Ot={class:"sm:col-span-2"},Pt=t("label",{for:"record-date",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Forma de Pagamento",-1),Mt={class:"mt-2"},Ft=M('<option value="pix">PIX</option><option value="dinheiro">Dinheiro</option><option value="cartao_credito">Cartão de Crédito</option><option value="cartao_debito">Cartão de Débito</option><option value="ted">TED</option><option value="cheque">Cheque</option>',6),Ht=[Ft],Xt={key:0,class:"text-red-500 text-sm"},Gt={key:5,class:"w-full py-5 flex justify-end"},Wt=["disabled"],Jt={key:6,class:"flex flex-col"},Kt={class:"overflow-x-auto sm:-mx-6 lg:-mx-8"},Qt={class:"inline-block min-w-full py-2 sm:px-6 lg:px-8"},Yt={class:"overflow-hidden"},Zt={class:"min-w-full text-left text-sm font-light"},es={class:"border-b bg-white font-medium"},ts=t("th",{scope:"col",class:"px-6 py-4 text-center"},"Valor",-1),ss=t("th",{scope:"col",class:"px-6 py-4 text-center"},"Data",-1),os=t("th",{scope:"col",class:"px-6 py-4 text-center"},"Método de Pagamento",-1),as={key:0,scope:"col",class:"px-6 py-4 text-center"},ds={key:1,scope:"col",class:"px-6 py-4 text-center"},is={class:"whitespace-nowrap px-1 text-center"},rs={key:0,class:"w-full relative flex flex-wrap items-stretch"},ls=t("span",{class:"w-1/4 select-none flex items-center whitespace-nowrap rounded-l border border-r-0 border-solid border-neutral-300 px-1 py-[0.25rem] text-center text-xs font-normal leading-[1.6] text-neutral-700",id:"basic-addon1"},"R$",-1),ns=["max","onUpdate:modelValue"],cs={key:1},us={class:"whitespace-nowrap px-1 py-4 text-center"},ms={key:0,class:"w-full relative flex flex-wrap items-stretch"},vs=["max","onUpdate:modelValue"],_s={key:1},gs={class:"whitespace-nowrap px-1 py-4 text-center"},bs={key:0,class:"w-full relative flex flex-wrap items-stretch"},hs=["onUpdate:modelValue"],xs=M('<option value="pix">PIX</option><option value="dinheiro">Dinheiro</option><option value="cartao_credito">Cartão de Crédito</option><option value="cartao_debito">Cartão de Débito</option><option value="ted">TED</option><option value="cheque">Cheque</option>',6),ys=[xs],fs={key:1},ps={key:0,class:"whitespace-nowrap px-6 py-4 select-none"},$s={key:1,class:"whitespace-nowrap px-6 py-4 select-none"},ws={key:2,class:"text-red-500 text-sm"},ks={key:3,class:"text-red-500 text-sm"},Vs={key:0,class:"text-red-500 text-sm py-5 text-center"},Ds={key:1,class:"text-red-500 text-sm py-5 text-center"},Cs={key:2,class:"text-red-500 text-sm py-5 text-center"},Ss={key:7,class:"py-5 text-gray-400 text-center"},qs={__name:"ServiceRecordsListSection",props:{modal_mode:String,service:Object,record_form:Object,remaining_amount:Number,invalid_record_date:Boolean,invalid_record_amount:Boolean},emits:["add-record","remove-record"],setup(e,{emit:k}){const l=k,a=e,b=w(()=>a.service.records_list.data.sort((y,v)=>new Date(y.date)-new Date(v.date))),g=()=>{l("add-record")},x=(y,v)=>{l("remove-record",y,v)};return(y,v)=>(s(),o("section",ut,[e.modal_mode==="create"?(s(),o("div",mt,gt)):r("",!0),e.modal_mode==="update"?(s(),o("div",bt,yt)):r("",!0),e.modal_mode==="pay"?(s(),o("div",ft,wt)):r("",!0),e.modal_mode==="see"?(s(),o("div",kt,Ct)):r("",!0),e.modal_mode!=="update"&&e.modal_mode!=="see"?(s(),o("div",St,[t("div",qt,[Ut,t("div",Rt,[h(t("input",{id:"record-amount",name:"record-amount",type:"number",step:"0.01",min:"0",max:e.remaining_amount,autocomplete:"off",class:"simple-input disabled:bg-gray-200 disabled:opacity-75",disabled:e.remaining_amount==0,placeholder:"Valor do serviço parcial","onUpdate:modelValue":v[0]||(v[0]=d=>e.record_form.amount=d)},null,8,Et),[[f,e.record_form.amount]]),t("p",jt,"Valor Restante: "+u(_(N)(e.remaining_amount)),1),e.record_form.errors.amount?(s(),o("p",zt,u(e.record_form.errors.amount),1)):r("",!0)])]),t("div",Nt,[Bt,t("div",Lt,[h(t("input",{id:"record-date",name:"record-date",type:"date",max:_(q)(),autocomplete:"off",class:"simple-input disabled:bg-gray-200",disabled:e.remaining_amount==0,placeholder:"Data de serviço do valor parcial","onUpdate:modelValue":v[1]||(v[1]=d=>e.record_form.register_date=d)},null,8,Tt),[[f,e.record_form.register_date]]),At,e.record_form.errors.register_date?(s(),o("p",It,u(e.record_form.errors.register_date),1)):r("",!0)])]),t("div",Ot,[Pt,t("div",Mt,[h(t("select",{name:"payment_method",class:"simple-input","onUpdate:modelValue":v[2]||(v[2]=d=>e.record_form.payment_method=d)},Ht,512),[[T,e.record_form.payment_method]]),e.record_form.errors.payment_method?(s(),o("p",Xt,u(e.record_form.errors.payment_method),1)):r("",!0)])])])):r("",!0),e.modal_mode!=="update"&&e.modal_mode!=="see"?(s(),o("div",Gt,[t("button",{type:"button",class:"w-full px-4 py-2 bg-blue-600 border border-gray-300 rounded-md font-semibold text-xs text-white uppercase tracking-widest shadow-sm hover:bg-blue-700 focus:outline-none focus:border-blue-300 focus:ring focus:ring-blue-200 active:text-gray-800 active:bg-gray-50 disabled:opacity-25 transition",disabled:!e.record_form.amount||!e.record_form.register_date||!e.record_form.payment_method||e.record_form.amount>e.remaining_amount,onClick:v[3]||(v[3]=d=>g())}," Inserir registro ",8,Wt)])):r("",!0),e.service.records_list.data.length?(s(),o("div",Jt,[t("div",Kt,[t("div",Qt,[t("div",Yt,[t("table",Zt,[t("thead",es,[t("tr",null,[ts,ss,os,e.modal_mode!=="create"?(s(),o("th",as,"Usuário ")):r("",!0),e.modal_mode!=="pay"&&e.modal_mode!=="see"?(s(),o("th",ds,"Excluir")):r("",!0)])]),t("tbody",null,[(s(!0),o(O,null,P(b.value,d=>{var D,c,V,i;return s(),o("tr",{class:"border-b bg-white",key:d.id},[t("td",is,[e.modal_mode!=="update"&&!d.past?(s(),o("div",rs,[ls,h(t("input",{id:"record_item-amount-edit",name:"record_item-amount-edit",type:"number",step:"0.01",min:"0",max:e.remaining_amount,autocomplete:"off",class:"relative m-0 block min-w-0 flex-auto rounded-r border border-solid border-neutral-300 bg-transparent bg-clip-padding px-1 py-[0.25rem] text-xs font-normal leading-[1.6] text-neutral-700 outline-none transition duration-200 ease-in-out focus:z-[3] focus:border-primary focus:text-neutral-700 focus:shadow-[inset_0_0_0_1px_rgb(59,113,202)] focus:outline-none disabled:bg-gray-200",placeholder:"Editar serviço parcial","onUpdate:modelValue":n=>d.amount=n},null,8,ns),[[f,d.amount]])])):(s(),o("p",cs,u(_(N)(d.amount)),1))]),t("td",us,[e.modal_mode!=="update"&&!d.past?(s(),o("div",ms,[h(t("input",{id:"record-date",name:"record-date",type:"date",max:_(q)(),autocomplete:"off",class:"w-full relative m-0 block min-w-0 flex-auto rounded-r border border-solid border-neutral-300 bg-transparent bg-clip-padding px-1 py-[0.25rem] text-xs font-normal leading-[1.6] text-neutral-700 outline-none transition duration-200 ease-in-out focus:z-[3] focus:border-primary focus:text-neutral-700 focus:shadow-[inset_0_0_0_1px_rgb(59,113,202)] focus:outline-none disabled:bg-gray-200",placeholder:"Data de serviço do valor parcial","onUpdate:modelValue":n=>d.register_date=n},null,8,vs),[[f,d.register_date]])])):(s(),o("p",_s,u(_(q)(d.register_date,!0)),1))]),t("td",gs,[e.modal_mode!=="update"&&!d.past?(s(),o("div",bs,[h(t("select",{name:"payment_method",class:"w-full relative m-0 block min-w-0 flex-auto rounded-r border border-solid border-neutral-300 bg-transparent bg-clip-padding px-1 py-[0.25rem] text-xs font-normal leading-[1.6] text-neutral-700 outline-none transition duration-200 ease-in-out focus:z-[3] focus:border-primary focus:text-neutral-700 focus:shadow-[inset_0_0_0_1px_rgb(59,113,202)] focus:outline-none disabled:bg-gray-200","onUpdate:modelValue":n=>d.payment_method=n},ys,8,hs),[[T,d.payment_method]])])):(s(),o("p",fs,u(_(Q)(d.payment_method)),1))]),e.modal_mode!=="create"?(s(),o("td",ps,u(((c=(D=d==null?void 0:d.procedure)==null?void 0:D.user)==null?void 0:c.name)||y.$page.props.auth.user.name||"Não identificado"),1)):r("",!0),e.modal_mode!=="pay"&&e.modal_mode!=="see"?(s(),o("td",$s,[E(_(Y),{class:"w-5 h-5 cursor-pointer m-auto text-gray-700 hover:text-red-500 active:text-red-700",onClick:n=>x(d.id,d),title:"Remover este registro"},null,8,["onClick"])])):r("",!0),(V=d.errors)!=null&&V.amount?(s(),o("p",ws,u(d.errors.amount),1)):r("",!0),(i=d.errors)!=null&&i.date?(s(),o("p",ks,u(d.errors.date),1)):r("",!0)])}),128))])]),e.remaining_amount<0?(s(),o("p",Vs,"A soma dos serviços não pode ser maior que "+u(_(N)(e.service.total_value)),1)):r("",!0),e.invalid_record_date?(s(),o("p",Ds,"Todas as datas de registro devem ser não nulas e menores ou iguais a "+u(_(q)(new Date)),1)):r("",!0),e.invalid_record_amount?(s(),o("p",Cs,"Todos os valores devem ser maiores que R$ 0,00")):r("",!0)])])])])):(s(),o("div",Ss,"Não há registro de pagamento no momento."))]))}},Us={class:"pb-12 space-y-12 divide-y-2"},Is={__name:"CreateUpdatePayModal",props:{modal:Object,service:{type:Object,default:null},sells_list:{type:Array,default:[]}},emits:["close","submit"],setup(e,{emit:k}){const l=k,a=e,b=w(()=>a.service.records_list.data.length+1),g=w(()=>d.value&&a.service.total_value-a.service.records_list.data.reduce((p,$)=>p+$.amount,0)),x=w(()=>{const p=new Date;return a.service.records_list.data.some($=>new Date($.date)>p)}),y=w(()=>a.service.records_list.data.some(p=>p.amount<=0)),v=w(()=>a.modal.mode==="pay"||a.modal.mode==="see"),d=w(()=>a.modal.mode!=="create"||a.service.records_list.enable_records),D=w(()=>!!(a.service.title.length&&a.service.client.length&&a.service.total_value>0)),c=A({amount:0,past:!1,register_date:q(),payment_method:"cartao_credito",filepath:null}),V=j(!1),i=()=>{if(a.service.records_list.enable_records&&a.service.records_list.data.length)if(confirm("Tem certeza que deseja desmarcar? Todos os registros serão excluídos!"))a.service.records_list.data.length=0,c.reset();else return;a.service.records_list.enable_records=!a.service.records_list.enable_records},n=()=>{if(!c.amount||c.amount>g.value){c.errors.amount=`O valor do registro deve ser maior que R$ 0,00 e menor que ${N(g.value)}`;return}if(c.errors.amount="",!c.register_date||new Date(c.register_date)>new Date){c.errors.date=`A data do registro deve ser menor ou igual a ${q()}`;return}if(c.errors.date="",!c.payment_method){c.errors.payment_method="Um método de pagamento deve ser selecionado";return}c.errors.payment_method="",V.value||(c.filepath=null),a.service.records_list.data.push({id:b.value,amount:c.amount,past:c.past,register_date:c.register_date,payment_method:c.payment_method,filepath:c.filepath}),V.value=!1,c.reset()},m=(p,$=null)=>{if(a.modal.mode==="create"){a.service.records_list.data=a.service.records_list.data.filter(C=>C.id!==p);return}else confirm("Você tem certeza que deseja excluir esse registro? (Essa ação não pode ser desfeita)")&&A({}).delete(route("records.destroy",p),{preserveScroll:!0,onSuccess:()=>{a.service.records_list.data=a.service.records_list.data.filter(C=>C.id!==p)},onError:C=>{console.error("Erro ao deletar registro:",C),alert("Erro ao deletar registro. Verifique o console para mais detalhes.")}})},R=()=>{l("close")},B=()=>{l("submit")};return(p,$)=>(s(),S(G,{show:e.modal.show,onClose:R},{icon:U(()=>[t("div",{class:z(["mx-auto shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-400 sm:mx-0 sm:h-10 sm:w-10",{"bg-yellow-400":e.modal.mode==="update","bg-green-400":e.modal.mode==="pay","bg-gray-400":e.modal.mode==="see"}])},[e.modal.mode==="create"?(s(),S(_(ee),{key:0,class:"w-5 h-5 text-white"})):r("",!0),e.modal.mode==="update"?(s(),S(_(Z),{key:1,class:"w-5 h-5 text-white"})):r("",!0),e.modal.mode==="pay"?(s(),S(_(te),{key:2,class:"w-5 h-5 text-white"})):r("",!0),e.modal.mode==="see"?(s(),S(_(se),{key:3,class:"w-5 h-5 text-white"})):r("",!0)],2)]),title:U(()=>[L(u(e.modal.title),1)]),content:U(()=>[t("form",{onSubmit:I(B,["prevent"])},[t("div",Us,[E(ot,{service:e.service,sells_list:e.sells_list,disable_services_inputs:v.value,modal_mode:e.modal.mode},null,8,["service","sells_list","disable_services_inputs","modal_mode"]),E(ct,{modal_mode:e.modal.mode,can_add_record:D.value,enable_records:e.service.records_list.enable_records,onToggleEnableRecords:i},null,8,["modal_mode","can_add_record","enable_records"]),d.value?(s(),S(qs,{key:0,modal_mode:e.modal.mode,service:e.service,record_form:_(c),remaining_amount:g.value,invalid_record_date:x.value,invalid_record_amount:y.value,onAddRecord:n,onRemoveRecord:m},null,8,["modal_mode","service","record_form","remaining_amount","invalid_record_date","invalid_record_amount"])):r("",!0)])],32)]),footer:U(()=>[e.modal.mode!=="see"?(s(),S(J,{key:0,class:z({disabled:e.service.processing}),onClick:$[0]||($[0]=C=>R())},{default:U(()=>[L(" Cancelar ")]),_:1},8,["class"])):r("",!0),E(W,{class:z({disabled:e.service.processing||g.value<0||x.value||y.value}),disabled:e.service.processing||g.value<0||x.value||y.value,onClick:$[1]||($[1]=C=>e.modal.mode==="see"?R():B())},{default:U(()=>[L(u(e.modal.primary_button_txt),1)]),_:1},8,["class","disabled"])]),_:1},8,["show"]))}};export{Is as _};
