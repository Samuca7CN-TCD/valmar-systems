import{y as W,d as A,l as $,o as n,c as V,w as q,a as e,n as M,u as _,h as p,f as L,t as d,i as Z,e as i,F as j,g as O,q as S,s as G,v as T,b as w,T as H,Z as J}from"./app-CQCMULRS.js";import{r as K,_ as Y}from"./AppLayout-DVsrCAOA.js";import{_ as ee}from"./CreateUpdateModal-CL67BBV8.js";import{_ as te}from"./PrimaryButton-CCpSxDR1.js";import{_ as se}from"./SecondaryButton-CJwptiz7.js";import{g as z,t as Q}from"./general-CW50Zh8a.js";/* empty css                    */import{r as oe}from"./PlusIcon-C8vVEu5u.js";import{r as ae,a as ne}from"./XMarkIcon-DDhLJnv-.js";import{r as P}from"./EyeIcon-CE4FUwbj.js";import{_ as le}from"./FloatButton-C3J_W6e4.js";import{r as ie}from"./MagnifyingGlassIcon-4YeFiuBy.js";import"./Modal-15mIg7tU.js";import"./PrinterIcon-CfTT1zCI.js";const re={class:"pb-12 space-y-12 divide-y-2"},de={class:"py-4"},ue=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Informações Básicas",-1),ce=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Informações sobre a uso como nome do funcionário, data da uso e observações",-1),me={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"},pe={class:"sm:col-span-3"},ye=e("label",{for:"use-employee",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Responsável",-1),_e={key:0,class:"mt-2"},he=["value","disabled"],ve=e("option",{value:null,disabled:"",selected:""},"Escolha um funcionário",-1),xe=["value"],fe={key:0,class:"text-red-500 text-sm"},be={key:1,class:"mt-2"},ge=["value","disabled"],we={key:0,class:"text-red-500 text-sm"},qe={class:"flex flex-row align-middle items-center space-x-2 mt-2"},ke=["disabled"],$e=e("label",{for:"switch_entity_type",class:"text-sm text-neutral-500 select-none"}," Funcionário?",-1),Ce={class:"sm:col-span-3"},Ue=e("label",{for:"use-date",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Data do Uso",-1),Ie={class:"mt-2"},Ve=["max","disabled"],Me={key:0,class:"text-red-500 text-sm"},Se={class:"sm:col-span-6"},De=e("label",{for:"use-motive",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Motivo",-1),Ee={class:"mt-2"},Le=["disabled"],Te={key:0,class:"text-red-500 text-sm"},Ae={class:"sm:col-span-6"},je=e("label",{for:"use-observations",class:"block text-sm font-medium leading-6 text-gray-900"},"Observações",-1),Fe={class:"mt-2"},Ne=["disabled"],Oe={key:0,class:"text-red-500 text-sm"},Be={key:0,class:"py-4"},Re=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Lista de Itens",-1),ze=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Adicione os itens do uso.",-1),Qe={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-4"},We={class:"sm:col-span-4"},Pe={class:"relative"},Xe=e("label",{for:"item-selecter",class:"block text-sm font-medium leading-6 text-gray-900"},"Selecione os itens de uso",-1),Ze=["disabled"],Ge={key:0,class:"absolute z-10 w-full mx-auto sm:w-96 bg-white border rounded mt-2 h-96 overflow-y-scroll"},He=["onMousedown"],Je={class:"sm:col-span-4"},Ke={key:0,class:"min-w-full text-left text-sm font-medium leading-6 text-gray-900"},Ye={class:"border-b font-medium"},et=e("th",{scope:"col",class:"px-6 py-4 text-center"},"#",-1),tt=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Item",-1),st=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Qtd. Estoque",-1),ot=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Qtd. Uso",-1),at=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Und. Medida",-1),nt={key:0,scope:"col",class:"px-6 py-4 text-center"},lt={class:"whitespace-nowrap py-4 text-center font-medium"},it={class:"whitespace-nowrap py-4 text-center font-medium"},rt={class:"whitespace-nowrap py-4 text-center font-medium flex justify-center"},dt=["value","onInput","disabled"],ut={class:"whitespace-nowrap py-4 text-center font-medium"},ct={key:0,class:"whitespace-nowrap py-4 text-center font-mono text-2xl"},mt=["onClick","title"],pt={key:1,class:"p-5 bg-gray-200 rounded-md block text-sm font-medium leading-6 text-gray-900"},yt={__name:"CreateUpdateUsesModal",props:{modal:Object,use:{type:Object,default:null},items:Array,employees_list:Array},emits:["close","submit"],setup(s,{emit:D}){const u=D,l=s,E=W.useToast(),b=A(!0),B=/^\d{4}-\d{2}-\d{2}$/,x=$(()=>{const{motive:a,employee_id:o,employee:t,date:v}=l.use;if(b.value){if(!o)return!1}else if(!t)return!1;return!a||!a.length?!1:v&&B.test(v)}),C=$(()=>{const{items_list:a}=l.use;return!x||!a.length?!1:a.every(t=>t.movement_quantity>0&&t.movement_quantity<=t.quantity)}),y=$(()=>l.modal.mode==="see"),F=$(()=>l.modal.mode==="see"),N=a=>{if(b.value){const o=l.employees_list.find(t=>t.id===parseInt(a));if(!o){E.error("Funcionário não encontrado");return}l.use.employee_id=a,l.use.employee=o.name+" "+o.surname}else l.use.employee_id=null,l.use.employee_name=a},R=()=>{l.use.employee_id=null,l.use.employee=""},U=A(""),c=A(!1),m=$(()=>l.items.filter(a=>a.name.toLowerCase().includes(U.value.toLowerCase())&&!l.use.items_list.some(o=>o.id===a.id))),r=a=>{a==="in"&&(c.value=!0),a==="out"&&(c.value=!1)},h=()=>{l.use.estimated_value=l.use.items_list.reduce((a,o)=>a+o.price*o.movement_quantity,0),l.use.total_value=l.use.estimated_value},f=a=>{l.use.items_list.push({id:a.id,name:a.name,quantity:a.quantity,max_quantity:a.max_quantity,min_quantity:a.min_quantity,movement_quantity:1,measurement_unit:a.measurement_unit.abbreviation,price:a.price,amount:a.price}),U.value="",c.value=!1,h()},k=a=>{l.use.items_list=l.use.items_list.filter(o=>o.id!==a),h()},g=()=>{u("close")},I=()=>{u("submit")};return(a,o)=>(n(),V(ee,{show:s.modal.show,maxWidth:x.value||F.value?"3xl":"2xl",onClose:g},{icon:q(()=>[e("div",{class:M(["mx-auto shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-400 sm:mx-0 sm:h-10 sm:w-10",{"bg-yellow-400":s.modal.mode==="update","bg-green-400":s.modal.mode==="pay","bg-gray-400":s.modal.mode==="see"}])},[s.modal.mode==="create"?(n(),V(_(oe),{key:0,class:"w-5 h-5 text-white"})):p("",!0),s.modal.mode==="update"?(n(),V(_(ae),{key:1,class:"w-5 h-5 text-white"})):p("",!0),s.modal.mode==="pay"?(n(),V(_(K),{key:2,class:"w-5 h-5 text-white"})):p("",!0),s.modal.mode==="see"?(n(),V(_(P),{key:3,class:"w-5 h-5 text-white"})):p("",!0)],2)]),title:q(()=>[L(d(s.modal.title),1)]),content:q(()=>[e("form",{onSubmit:Z(I,["prevent"])},[e("div",re,[e("section",de,[ue,ce,e("div",me,[e("div",pe,[ye,b.value?(n(),i("div",_e,[e("select",{name:"use-employee",id:"use-employee",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Nome do funcionario",value:s.use.employee_id,onChange:o[0]||(o[0]=t=>N(t.target.value)),required:"",disabled:y.value},[ve,(n(!0),i(j,null,O(s.employees_list,t=>(n(),i("option",{key:t.id,value:t.id},d(t.name)+" "+d(t.surname),9,xe))),128))],40,he),s.use.errors.employee?(n(),i("p",fe,d(s.use.errors.employee),1)):p("",!0)])):(n(),i("div",be,[e("input",{type:"text",name:"use-entity",id:"use-entity",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Nome do responsável",value:s.use.employee,onInput:o[1]||(o[1]=t=>N(t.target.value)),disabled:y.value,required:""},null,40,ge),s.use.errors.employee?(n(),i("p",we,d(s.use.errors.employee),1)):p("",!0)])),e("span",qe,[S(e("input",{id:"switch_entity_type",type:"checkbox",class:"rounded border-gray-500 text-green-600 shadow-sm focus:border-green-300 focus:ring focus:ring-green-200 focus:ring-opacity-50","onUpdate:modelValue":o[2]||(o[2]=t=>b.value=t),onChange:R,disabled:y.value},null,40,ke),[[G,b.value]]),$e])]),e("div",Ce,[Ue,e("div",Ie,[S(e("input",{type:"date",name:"use-date",id:"use-date",autocomplete:"on",class:"simple-input disabled:bg-gray-200",autofocus:"true",placeholder:"Data do Uso",max:_(z)(),"onUpdate:modelValue":o[3]||(o[3]=t=>s.use.date=t),disabled:y.value,required:""},null,8,Ve),[[T,s.use.date]]),s.use.errors.date?(n(),i("p",Me,d(s.use.errors.date),1)):p("",!0)])]),e("div",Se,[De,e("div",Ee,[S(e("input",{type:"text",name:"use-motive",id:"use-motive",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Motivo do Uso","onUpdate:modelValue":o[4]||(o[4]=t=>s.use.motive=t),disabled:y.value,required:""},null,8,Le),[[T,s.use.motive]]),s.use.errors.motive?(n(),i("p",Te,d(s.use.errors.motive),1)):p("",!0)])]),e("div",Ae,[je,e("div",Fe,[S(e("textarea",{type:"text",observations:"use-observations",id:"use-observations",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Descreva a título mais detalhadamente ou insira informações adicionais","onUpdate:modelValue":o[5]||(o[5]=t=>s.use.observations=t),disabled:y.value},null,8,Ne),[[T,s.use.observations]]),s.use.errors.observations?(n(),i("p",Oe,d(s.use.errors.observations),1)):p("",!0)])])])]),x.value||F.value?(n(),i("section",Be,[Re,ze,e("div",Qe,[e("div",We,[e("div",Pe,[Xe,S(e("input",{id:"item-selecter","onUpdate:modelValue":o[6]||(o[6]=t=>U.value=t),onFocus:o[7]||(o[7]=t=>r("in")),onBlur:o[8]||(o[8]=t=>r("out")),class:"simple-input disabled:bg-gray-200 px-4 py-2 w-full",placeholder:"Digite para pesquisar",disabled:y.value},null,40,Ze),[[T,U.value]]),c.value?(n(),i("ul",Ge,[(n(!0),i(j,null,O(m.value,(t,v)=>(n(),i("li",{key:v,class:"py-2 px-4 cursor-pointer hover:bg-gray-200",onMousedown:X=>f(t)},[e("span",{class:M(["inline",{"text-blue-500":t.quantity!=0&&t.quantity>=t.max_quantity,"text-green-500":t.quantity<t.max_quantity&&t.quantity>=t.min_quantity,"text-yellow-500":t.quantity<t.min_quantity&&t.quantity>0,"text-red-500":t.quantity==0}])},"("+d(t.quantity)+")",3),L(" "+d(t.name),1)],40,He))),128))])):p("",!0)])]),e("div",Je,[l.use.items_list.length?(n(),i("table",Ke,[e("thead",Ye,[e("tr",null,[et,tt,st,ot,at,s.modal.mode!=="see"?(n(),i("th",nt," Deletar")):p("",!0)])]),e("tbody",null,[(n(!0),i(j,null,O(l.use.items_list,t=>(n(),i("tr",{key:t.id,class:M(["border-b transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid",{"bg-yellow-100":t.movement_quantity==t.quantity,"bg-red-100":t.movement_quantity>t.quantity}])},[e("td",lt,d(t.id),1),e("td",it,d(t.name),1),e("td",{class:M(["whitespace-nowrap py-4 text-center font-medium",{"text-blue-500":t.quantity!=0&&t.quantity>=t.max_quantity,"text-green-500":t.quantity<t.max_quantity&&t.quantity>=t.min_quantity,"text-yellow-500":t.quantity<t.min_quantity&&t.quantity>0,"text-red-500":t.quantity==0}])},d(t.quantity),3),e("td",rt,[e("input",{type:"number",min:"0.01",step:"0.01",value:t.movement_quantity,onInput:v=>{t.movement_quantity=parseFloat(v.target.value),t.amount=t.price*v.target.value,h()},class:"simple-input disabled:bg-gray-200 w-2/3",disabled:y.value},null,40,dt)]),e("td",ut,d(t.measurement_unit),1),s.modal.mode!=="see"?(n(),i("td",ct,[e("button",{onClick:v=>k(t.id),title:"Remover "+t.name},"×",8,mt)])):p("",!0)],2))),128))])])):(n(),i("p",pt," Nenhum item selecionado até o momento!"))])])])):p("",!0)])],32)]),footer:q(()=>[s.modal.mode!=="see"?(n(),V(se,{key:0,class:M({disabled:s.use.processing}),onClick:o[9]||(o[9]=t=>g())},{default:q(()=>[L(" Cancelar ")]),_:1},8,["class"])):p("",!0),w(te,{class:M({disabled:s.use.processing||!C.value}),disabled:s.use.processing||!C.value,onClick:o[10]||(o[10]=t=>s.use.processing||!C.value?t.preventDefault():I())},{default:q(()=>[L(d(s.modal.primary_button_txt),1)]),_:1},8,["class","disabled"])]),_:1},8,["show","maxWidth"]))}},_t={class:"font-semibold text-xl text-gray-800 leading-tight"},ht={class:"pt-12 print:hidden print:pt-0"},vt={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 print:w-full"},xt={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-5"},ft={class:"flex flex-row items-center space-x-3"},bt={class:"py-12 print:py-6"},gt={class:"max-w-7xl mx-auto print:max-w-full"},wt={class:"px-0 print:px-0"},qt={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg print:shadow-none"},kt={class:"flex flex-col"},$t={class:"overflow-x-auto sm:-mx-6 lg:-mx-8"},Ct={class:"inline-block min-w-full py-2 sm:px-6 lg:px-8"},Ut={class:"overflow-hidden"},It={class:"min-w-full text-left text-sm font-light"},Vt=e("thead",{class:"border-b font-medium"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-4 text-center"},"#"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Funcionário"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Motivo"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Data do Uso "),e("th",{scope:"col",class:"px-6 py-4 text-center print:hidden",colspan:"2"}," Ações")])],-1),Mt={class:"border-b transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid"},St={class:"whitespace-nowrap py-4 text-center font-medium"},Dt={class:"whitespace-normal px-6 py-4 text-center trim"},Et=["title"],Lt={class:"whitespace-nowrap px-2 py-4 text-center"},Tt={class:"whitespace-nowrap px-2 py-4 text-center print:hidden"},At=["title","onClick"],jt=["title","onClick"],Ft={key:1,class:"transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid"},Nt=e("td",{class:"whitespace-nowrap px-6 py-4 text-center",colspan:"9"},"Não há usos cadastradas no momento!",-1),Ot=[Nt],ts={__name:"Uses",props:{page:Object,page_options:{type:Array,default:null},uses_list:Object,employees_list:Array,items:Object},setup(s){const D=s,u=H({id:null,employee:"",employee_id:null,motive:"",date:z(),total_value:0,observations:"",items_list:[]}),l=W.useToast(),E=A(""),b=$(()=>{const c=E.value.toLowerCase();return D.uses_list.filter(m=>{const{id:r,entity_name:h,motive:f,observations:k,date:g,items:I}=m,a=[r.toString(),(h==null?void 0:h.toLowerCase())??"",(f==null?void 0:f.toLowerCase())??"",(k==null?void 0:k.toLowerCase())??"",(g==null?void 0:g.toLowerCase())??""];for(let o of a)if(o.includes(c))return!0;return I.some(o=>o.name.toLowerCase().includes(c))})}),B=$(()=>D.uses_list.reduce((c,m)=>c+m.accounting.partial_value,0)),x=A({mode:"create",show:!1,get title(){switch(this.mode){case"create":return"Criar uso";case"update":return"Editar uso";case"see":return"Ver informações da uso"}},get primary_button_txt(){switch(this.mode){case"create":return"Cadastrar";case"update":return"Atualizar";case"see":return"Fechar"}}}),C=(c,m=null)=>{const r=["update","see"].includes(c);if(m!==null&&r){const h=D.uses_list.find(f=>f.id===m);if(h){const{id:f,entity_name:k,employee_id:g,date:I,motive:a,observations:o,accounting:t,items:v}=h;u.id=f,u.employee=k,u.date=I,u.motive=a,u.estimated_value=t.estimated_value,u.total_value=t.total_value,u.partial_value=t.partial_value,u.observations=o,u.items_list=v,u.employee_id=g}}x.value.mode=c,x.value.show=!0},y=()=>{u.reset(),x.value.show=!1},F=()=>{u.post(route("uses.store"),{preserveScroll:!0,onSuccess:()=>y(),onError:c=>{console.log(c)}})},N=()=>{u.put(route("uses.update",u.id),{preserveScroll:!0,onSuccess:()=>y()})},R=(c,m)=>{confirm(`Você tem certeza que deseja excluir a uso de material para "${m}"? Todos os materiais comprados voltarão para o estoque! Esta ação não poderá ser desfeita!`)&&u.delete(route("uses.destroy",c),{preserveScroll:!0,onSuccess:()=>l.success("Uso deletado com sucesso!")})},U=()=>{switch(x.value.mode){case"create":return F();case"update":return N();case"see":return y();default:l.error("Método desconhecido. Informar o Técnico.")}};return(c,m)=>(n(),i(j,null,[w(_(J),{title:s.page.name},null,8,["title"]),w(Y,{page:s.page,page_options:s.page_options},{header:q(()=>[e("h2",_t,d(s.page.name)+" | "+d(_(Q)(B.value)),1),w(le,{icon:"plus",onClick:m[0]||(m[0]=r=>C("create")),title:"Cadastrar Use",class:"print:hidden"})]),default:q(()=>[e("div",ht,[e("div",vt,[e("div",xt,[e("div",ft,[w(_(ie),{class:"w-5 y-5"}),S(e("input",{type:"text",name:"search_term",id:"search_term",autocomplete:"on",class:"simple-input",autofocus:"true",placeholder:"Pesquisar termo...","onUpdate:modelValue":m[1]||(m[1]=r=>E.value=r)},null,512),[[T,E.value]])])])])]),e("div",bt,[e("div",gt,[e("div",wt,[e("div",qt,[e("div",kt,[e("div",$t,[e("div",Ct,[e("div",Ut,[e("table",It,[Vt,e("tbody",null,[b.value.length?(n(!0),i(j,{key:0},O(b.value,r=>(n(),i("tr",Mt,[e("td",St,d(r.id),1),e("td",Dt,[L(d(r.entity_name)+" ",1),r.observations?(n(),i("span",{key:0,title:r.observations,class:"inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10 cursor-help"},"OBS",8,Et)):p("",!0)]),e("td",Lt,d(_(Q)(r.motive)),1),e("td",Tt,d(_(z)(r.date,!0)),1),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-indigo-700 active:text-indigo-900 select-none print:hidden",title:"VER: Compra de "+r.entity_name,onClick:h=>C("see",r.id)},[w(_(P),{class:"w-5 h-5 m-auto"})],8,At),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-red-700 active:text-red-900 select-none print:hidden",title:"EXCLUIR: Compra de "+r.entity_name,onClick:h=>R(r.id,r.entity_name)},[w(_(ne),{class:"w-5 h-5 m-auto"})],8,jt)]))),256)):(n(),i("tr",Ft,Ot))])])])])])])])])])]),w(yt,{modal:x.value,use:_(u),items:s.items,employees_list:s.employees_list,onSubmit:U,onClose:y},null,8,["modal","use","items","employees_list"])]),_:1},8,["page","page_options"])],64))}};export{ts as default};
