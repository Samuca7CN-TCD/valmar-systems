import{d as L,l as U,o,c as E,w as S,a as e,n as N,u as i,h as m,f as w,t as d,i as ee,q as v,v as $,e as c,F as J,g as X,y as te,b as f,z as se,T as H,Z as ae,G as le}from"./app-wsFqEJLe.js";import{r as oe,a as ne,b as ie,_ as re}from"./AppLayout-CwLqtukj.js";import{_ as de}from"./CreateUpdateModal-C9viO0aZ.js";import{_ as ce}from"./PrimaryButton-DNoApzkO.js";import{_ as ue}from"./SecondaryButton-BwoXe-Mp.js";import{f as Z,t as k}from"./general-DyNoCMvo.js";import{r as me}from"./PlusIcon-BRzD7pfq.js";import{r as pe,a as _e}from"./XMarkIcon-Cpzovx0Q.js";import{r as K}from"./EyeIcon-DOgY_xVS.js";import{_ as ge}from"./FloatButton-DwGAXZ7Z.js";/* empty css                    */import{r as ye}from"./MagnifyingGlassIcon-XqV_6PHw.js";import{r as he}from"./InformationCircleIcon-C2QgF1Y7.js";import"./Modal-BDIjsJKm.js";import"./PrinterIcon-D77e3GdS.js";const ve={class:"pb-12 space-y-12 divide-y-2"},xe={class:"py-4"},fe=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Informações Básicas",-1),be=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Informações sobre a venda como nome do cliente, data da venda e observações",-1),we={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"},$e={class:"sm:col-span-3"},ke=e("label",{for:"sell-client",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Cliente",-1),qe={class:"mt-2"},Ve=["disabled"],Ce={key:0,class:"text-red-500 text-sm"},Se={class:"sm:col-span-3"},Ie=e("label",{for:"sell-date",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Data da Venda",-1),De={class:"mt-2"},Oe=["disabled","max"],Ue={key:0,class:"text-red-500 text-sm"},Le={class:"sm:col-span-6"},Me=e("label",{for:"sell-observations",class:"block text-sm font-medium leading-6 text-gray-900"},"Observações",-1),Re={class:"mt-2"},Ae=["disabled"],je={key:0,class:"text-red-500 text-sm"},Ee={key:0,class:"py-4"},Ne=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Lista de Itens",-1),Te=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Adicione os itens da venda bem como descontos e valor de pagamento de entrada.",-1),Pe={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-4"},Fe={key:0,class:"sm:col-span-4"},Be={class:"relative"},ze=e("label",{for:"item-selecter",class:"block text-sm font-medium leading-6 text-gray-900"},"Selecione os itens de venda",-1),Ge=["disabled"],Je={key:0,class:"absolute z-10 w-full mx-auto sm:w-96 bg-white border rounded mt-2 h-96 overflow-y-scroll"},Qe=["onMousedown"],We={class:"md:col-span-2 lg:col-span-1"},Xe=e("label",{for:"sell-estimated-amount",class:"block text-sm font-medium leading-6 text-gray-900"},"Valor estimado ",-1),Ze={class:"relative mt-2 rounded-md shadow-sm"},He=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1),Ke=["disabled"],Ye={key:0,class:"text-red-500 text-sm"},et={class:"md:col-span-2 lg:col-span-1"},tt=e("label",{for:"sell-total-amount",class:"block text-sm font-medium leading-6 text-gray-900"},"Valor final ",-1),st={class:"relative mt-2 rounded-md shadow-sm"},at=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1),lt=["disabled","value"],ot={key:0,class:"text-red-500 text-sm"},nt={class:"md:col-span-2 lg:col-span-1"},it=e("label",{for:"sell-discount-percent",class:"block text-sm font-medium leading-6 text-gray-900"},"Desconto (%) ",-1),rt={class:"relative mt-2 rounded-md shadow-sm"},dt=["disabled","value"],ct=e("div",{class:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3"},[e("span",{class:"text-gray-500 sm:text-sm"},"%")],-1),ut={key:0,class:"text-red-500 text-sm"},mt={class:"md:col-span-2 lg:col-span-1"},pt=e("label",{for:"sell-discount",class:"block text-sm font-medium leading-6 text-gray-900"},"Desconto (R$) ",-1),_t={class:"relative mt-2 rounded-md shadow-sm"},gt=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1),yt=["disabled","value"],ht={key:0,class:"text-red-500 text-sm"},vt={class:"sm:col-span-4"},xt={key:0,class:"min-w-full text-left text-sm font-medium leading-6 text-gray-900"},ft={class:"border-b font-medium"},bt=e("th",{scope:"col",class:"px-6 py-4 text-center"},"#",-1),wt=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Item",-1),$t=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Qtd. Estoque",-1),kt=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Qtd. Venda",-1),qt=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Und. Medida",-1),Vt=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Preço unitário",-1),Ct=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Preço montante",-1),St={key:0,scope:"col",class:"px-6 py-4 text-center"},It={class:"whitespace-nowrap py-4 text-center font-medium"},Dt={class:"whitespace-nowrap py-4 text-center font-medium"},Ot={class:"whitespace-nowrap py-4 text-center font-medium flex justify-center"},Ut=["value","onInput","disabled"],Lt={class:"whitespace-nowrap py-4 text-center font-medium"},Mt={class:"whitespace-nowrap py-4 text-center font-medium"},Rt={class:"whitespace-nowrap py-4 text-center font-medium"},At={key:0,class:"whitespace-nowrap py-4 text-center font-mono text-2xl"},jt=["onClick","title"],Et={key:1,class:"p-5 bg-gray-200 rounded-md block text-sm font-medium leading-6 text-gray-900"},Nt={key:1,class:"w-full py-4"},Tt=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Pagamento de entrada",-1),Pt=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Após a conclusão da compra, um registro de pagamento será criado na página de PAGAMENTOS. ",-1),Ft=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Se algum pagamento de entrada (ou pagamento total) for realizado, registre aqui.",-1),Bt={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-4"},zt={class:"md:col-span-2 lg:col-span-1 text-gray-700"},Gt={class:"font-extrabold text-green-500"},Jt={class:"md:col-span-2 lg:col-span-1 text-gray-700"},Qt={class:"font-extrabold text-green-500"},Wt={class:"md:col-span-2 lg:col-span-1 text-gray-700"},Xt={class:"font-extrabold text-green-500"},Zt={class:"md:col-span-2 lg:col-span-1 text-gray-700"},Ht={class:"font-extrabold text-green-500"},Kt={class:"sm:col-span-2"},Yt=e("label",{for:"sell-entry-value",class:"block text-sm font-medium leading-6 text-gray-900"},"Pagamento de entrada ",-1),es={class:"relative mt-2 rounded-md shadow-sm"},ts=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1),ss=["disabled"],as={key:0,class:"text-red-500 text-sm"},ls={class:"relative mt-2 rounded-md shadow-sm"},os=["disabled"],ns=e("label",{for:"pay-all",class:"ml-3 text-sm text-neutral-500 select-none"},"Pagar agora",-1),is={class:"sm:col-span-2"},rs=e("label",{for:"sell-partial-value",class:"block text-sm font-medium leading-6 text-gray-900"},"Valor restante ",-1),ds={class:"relative mt-2 rounded-md shadow-sm"},cs=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1),us=["value"],ms={key:0,class:"text-red-500 text-sm"},ps={__name:"CreateUpdateSellsModal",props:{modal:Object,sell:{type:Object,default:null},items:Array},emits:["close","submit"],setup(s,{emit:C}){const T=C,l=s,I=L(JSON.parse(JSON.stringify(l.items))),p=L(!1),M=/^\d{4}-\d{2}-\d{2}$/,R=U(()=>{const{client:n,date:a}=l.sell;return!n||!n.length?!1:a&&M.test(a)}),z=U(()=>{const{client:n,date:a,estimated_value:t,total_value:h,entry_value:V,items_list:Y}=l.sell;return!n||!n.length||!a||!M.test(a)||!(t>0&&h>0&&V<=h)?!1:Y.every(W=>W.quantity>0&&W.movement_quantity<=W.quantity)}),D=U(()=>l.sell.total_value-l.sell.entry_value),_=U(()=>l.modal.mode==="see"),q=L(""),A=L(!1),P=U(()=>I.value.filter(n=>n.name.toLowerCase().includes(q.value.toLowerCase()))),G=n=>{n==="in"&&(A.value=!0),n==="out"&&(A.value=!1)},F=()=>{l.sell.estimated_value=l.sell.items_list.reduce((n,a)=>n+a.price*a.movement_quantity,0),b("estimated_value")},Q=n=>{l.sell.items_list.push({id:n.id,name:n.name,quantity:n.quantity,max_quantity:n.max_quantity,min_quantity:n.min_quantity,movement_quantity:1,measurement_unit:n.measurement_unit.abbreviation,price:n.price,amount:n.price}),u(),q.value="",A.value=!1,F()},g=n=>{l.sell.items_list=l.sell.items_list.filter(a=>a.id!==n),u(),F()},u=()=>{I.value=l.items.filter(n=>!l.sell.items_list.some(a=>a.id===n.id))},r=(n,a)=>{l.sell[a]=n.target.value,b(a)},y=(n,a)=>{const t=10**a;return Math.floor(n*t)/t},b=n=>{let{estimated_value:a,total_value:t,discount_percent:h,discount:V}=l.sell;switch(n){case"estimated_value":case"discount_percent":t=a*(1-h/100),V=a-t;break;case"total_value":V=a-t,h=V/a*100;break;case"discount":h=V/a*100,t=a-V;break}Object.assign(l.sell,{estimated_value:a,total_value:t,discount_percent:h,discount:V})},O=()=>{p.value?l.sell.entry_value=l.sell.total_value:l.sell.entry_value=0},B=()=>{l.sell.partialValue===0?p.value=!0:p.value=!1},j=()=>{T("close")},x=()=>{T("submit")};return(n,a)=>(o(),E(de,{show:s.modal.show,maxWidth:R.value||_.value?"6xl":"2xl",onClose:j},{icon:S(()=>[e("div",{class:N(["mx-auto shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-400 sm:mx-0 sm:h-10 sm:w-10",{"bg-yellow-400":s.modal.mode==="update","bg-green-400":s.modal.mode==="pay","bg-gray-400":s.modal.mode==="see"}])},[s.modal.mode==="create"?(o(),E(i(me),{key:0,class:"w-5 h-5 text-white"})):m("",!0),s.modal.mode==="update"?(o(),E(i(pe),{key:1,class:"w-5 h-5 text-white"})):m("",!0),s.modal.mode==="pay"?(o(),E(i(oe),{key:2,class:"w-5 h-5 text-white"})):m("",!0),s.modal.mode==="see"?(o(),E(i(K),{key:3,class:"w-5 h-5 text-white"})):m("",!0)],2)]),title:S(()=>[w(d(s.modal.title),1)]),content:S(()=>[e("form",{onSubmit:ee(x,["prevent"])},[e("div",ve,[e("section",xe,[fe,be,e("div",we,[e("div",$e,[ke,e("div",qe,[v(e("input",{type:"text",name:"sell-client",id:"sell-client",autocomplete:"on",class:"simple-input disabled:bg-gray-200",disabled:_.value,placeholder:"Nome do cliente","onUpdate:modelValue":a[0]||(a[0]=t=>s.sell.client=t),required:""},null,8,Ve),[[$,s.sell.client]]),s.sell.errors.client?(o(),c("p",Ce,d(s.sell.errors.client),1)):m("",!0)])]),e("div",Se,[Ie,e("div",De,[v(e("input",{type:"date",name:"sell-date",id:"sell-date",autocomplete:"on",class:"simple-input disabled:bg-gray-200",disabled:_.value,autofocus:"true",placeholder:"Data da Venda",max:i(Z)(),"onUpdate:modelValue":a[1]||(a[1]=t=>s.sell.date=t),required:""},null,8,Oe),[[$,s.sell.date]]),s.sell.errors.date?(o(),c("p",Ue,d(s.sell.errors.date),1)):m("",!0)])]),e("div",Le,[Me,e("div",Re,[v(e("textarea",{type:"text",observations:"sell-observations",id:"sell-observations",autocomplete:"on",class:"simple-input disabled:bg-gray-200",disabled:_.value,placeholder:"Descreva a título mais detalhadamente ou insira informações adicionais","onUpdate:modelValue":a[2]||(a[2]=t=>s.sell.observations=t)},null,8,Ae),[[$,s.sell.observations]]),s.sell.errors.observations?(o(),c("p",je,d(s.sell.errors.observations),1)):m("",!0)])])])]),R.value||_.value?(o(),c("section",Ee,[Ne,Te,e("div",Pe,[_.value?m("",!0):(o(),c("div",Fe,[e("div",Be,[ze,v(e("input",{id:"item-selecter","onUpdate:modelValue":a[3]||(a[3]=t=>q.value=t),onFocus:a[4]||(a[4]=t=>G("in")),onBlur:a[5]||(a[5]=t=>G("out")),class:"simple-input disabled:bg-gray-200 px-4 py-2 w-full",placeholder:"Digite para pesquisar",disabled:_.value},null,40,Ge),[[$,q.value]]),A.value?(o(),c("ul",Je,[(o(!0),c(J,null,X(P.value,(t,h)=>(o(),c("li",{key:h,class:"py-2 px-4 cursor-pointer hover:bg-gray-200",onMousedown:V=>Q(t)},[e("span",{class:N(["inline",{"text-blue-500":t.quantity!=0&&t.quantity>=t.max_quantity,"text-green-500":t.quantity<t.max_quantity&&t.quantity>=t.min_quantity,"text-yellow-500":t.quantity<t.min_quantity&&t.quantity>0,"text-red-500":t.quantity==0}])},"("+d(t.quantity)+")",3),w(" "+d(t.name),1)],40,Qe))),128))])):m("",!0)])])),e("div",We,[Xe,e("div",Ze,[He,v(e("input",{id:"sell-estimated-amount",type:"number",step:"0.01",min:"0",autocomplete:"off",readonly:"",class:"block w-full rounded-md border-0 py-1.5 pl-9 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6 disabled:bg-gray-200",placeholder:"Valor total estimado",disabled:!s.sell.items_list.length||_.value,"onUpdate:modelValue":a[6]||(a[6]=t=>s.sell.estimated_value=t),required:""},null,8,Ke),[[$,s.sell.estimated_value]]),s.sell.errors.estimated_value?(o(),c("p",Ye,d(s.sell.errors.estimated_value),1)):m("",!0)])]),e("div",et,[tt,e("div",st,[at,e("input",{id:"sell-total-amount",type:"number",step:"0.01",min:"0",autocomplete:"off",class:"block w-full rounded-md border-0 py-1.5 pl-9 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6 disabled:bg-gray-200",placeholder:"Valor total estimado",disabled:!s.sell.items_list.length||_.value,value:y(s.sell.total_value,2),onInput:a[7]||(a[7]=t=>r(t,"total_value")),required:""},null,40,lt),s.sell.errors.total_value?(o(),c("p",ot,d(s.sell.errors.total_value),1)):m("",!0)])]),e("div",nt,[it,e("div",rt,[e("input",{id:"sell-discount-percent",type:"number",step:"0.01",min:"0",autocomplete:"off",class:"block w-full rounded-md border-0 py-1.5 pr-9 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6 disabled:bg-gray-200",placeholder:"Valor total estimado",disabled:!s.sell.items_list.length||_.value,value:y(s.sell.discount_percent,3),onInput:a[8]||(a[8]=t=>r(t,"discount_percent")),required:""},null,40,dt),ct,s.sell.errors.discount_percent?(o(),c("p",ut,d(s.sell.errors.discount_percent),1)):m("",!0)])]),e("div",mt,[pt,e("div",_t,[gt,e("input",{id:"sell-discount",type:"number",step:"0.01",min:"0",autocomplete:"off",class:"block w-full rounded-md border-0 py-1.5 pl-9 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6 disabled:bg-gray-200",placeholder:"Valor total estimado",disabled:!s.sell.items_list.length||_.value,value:y(s.sell.discount,2),onInput:a[9]||(a[9]=t=>r(t,"discount")),required:""},null,40,yt),s.sell.errors.discount?(o(),c("p",ht,d(s.sell.errors.discount),1)):m("",!0)])]),e("div",vt,[l.sell.items_list.length?(o(),c("table",xt,[e("thead",ft,[e("tr",null,[bt,wt,$t,kt,qt,Vt,Ct,s.modal.mode!=="see"?(o(),c("th",St," Deletar")):m("",!0)])]),e("tbody",null,[(o(!0),c(J,null,X(l.sell.items_list,t=>(o(),c("tr",{key:t.id,class:N(["border-b transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid",{"bg-yellow-100":t.movement_quantity==t.quantity,"bg-red-100":t.movement_quantity>t.quantity}])},[e("td",It,d(t.id),1),e("td",Dt,d(t.name),1),e("td",{class:N(["whitespace-nowrap py-4 text-center font-medium",{"text-blue-500":t.quantity!=0&&t.quantity>=t.max_quantity,"text-green-500":t.quantity<t.max_quantity&&t.quantity>=t.min_quantity,"text-yellow-500":t.quantity<t.min_quantity&&t.quantity>0,"text-red-500":t.quantity==0}])},d(t.quantity),3),e("td",Ot,[e("input",{type:"number",min:"0.01",step:"0.01",value:t.movement_quantity,onInput:h=>{t.movement_quantity=h.target.value,t.amount=t.price*h.target.value,F()},class:"simple-input disabled:bg-gray-200 w-2/3",disabled:s.modal.mode!=="create"},null,40,Ut)]),e("td",Lt,d(t.measurement_unit),1),e("td",Mt,d(i(k)(t.price)),1),e("td",Rt,d(i(k)(t.amount?t.amount:10)),1),s.modal.mode!=="see"?(o(),c("td",At,[e("button",{onClick:h=>g(t.id),title:"Remover "+t.name},"×",8,jt)])):m("",!0)],2))),128))])])):(o(),c("p",Et," Nenhum item selecionado até o momento!"))])])])):m("",!0),R.value&&s.sell.items_list.length&&s.modal.mode==="create"?(o(),c("section",Nt,[Tt,Pt,Ft,e("div",Bt,[e("div",zt,[w("Valor estimado: "),e("span",Gt,d(i(k)(s.sell.estimated_value)),1)]),e("div",Jt,[w("Valor final: "),e("span",Qt,d(i(k)(s.sell.total_value)),1)]),e("div",Wt,[w("Desconto (%): "),e("span",Xt,d(y(s.sell.discount_percent,3))+"%",1)]),e("div",Zt,[w("Desconto (R$): "),e("span",Ht,d(i(k)(s.sell.discount)),1)]),e("div",Kt,[Yt,e("div",es,[ts,v(e("input",{id:"sell-entry-value",type:"number",step:"0.01",min:"0",autocomplete:"off",class:"block w-full rounded-md border-0 py-1.5 pl-9 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6 disabled:bg-gray-200",placeholder:"Valor de pagamneto de entrada",disabled:!s.sell.items_list.length||_.value,"onUpdate:modelValue":a[10]||(a[10]=t=>s.sell.entry_value=t),onInput:a[11]||(a[11]=t=>B()),required:""},null,40,ss),[[$,s.sell.entry_value]]),s.sell.errors.entry_value?(o(),c("p",as,d(s.sell.errors.entry_value),1)):m("",!0)]),e("div",ls,[v(e("input",{type:"checkbox",id:"pay-all",class:"focus:bg-green-700 focus:ring-green-700 text-green-700 border-neutral-400 rounded-sm disabled:opacity-50","onUpdate:modelValue":a[12]||(a[12]=t=>p.value=t),onChange:a[13]||(a[13]=t=>O()),disabled:!s.sell.items_list.length||_.value},null,40,os),[[te,p.value]]),ns])]),e("div",is,[rs,e("div",ds,[cs,e("input",{id:"sell-partial-value",type:"number",step:"0.01",min:"0",autocomplete:"off",class:"block w-full rounded-md border-0 py-1.5 pl-9 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6 disabled:bg-gray-200",placeholder:"Valor restante para pagamento posterior",disabled:!0,value:y(D.value,2),readonly:"",required:""},null,8,us),s.sell.errors.partial_value?(o(),c("p",ms,d(s.sell.errors.partial_value),1)):m("",!0)])])])])):m("",!0)])],32)]),footer:S(()=>[s.modal.mode!=="see"?(o(),E(ue,{key:0,class:N({disabled:s.sell.processing}),onClick:a[14]||(a[14]=t=>j())},{default:S(()=>[w(" Cancelar ")]),_:1},8,["class"])):m("",!0),f(ce,{class:N({disabled:s.sell.processing||!z.value}),disabled:s.sell.processing||!z.value,onClick:a[15]||(a[15]=t=>x())},{default:S(()=>[w(d(s.modal.primary_button_txt),1)]),_:1},8,["class","disabled"])]),_:1},8,["show","maxWidth"]))}},_s={class:"font-semibold text-xl text-gray-800 leading-tight"},gs={key:0},ys={class:"pt-12 print:hidden print:pt-0"},hs={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 print:w-full"},vs={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-5"},xs={class:"flex flex-row items-center space-x-3"},fs={class:"cursor-help select-none",title:"O campo de pesquisa ao lado filtra as informações carregadas na pagina. O formulário de pesquisa abaixo busca as informações filtradas no banco de dados e lista na página."},bs={class:"mt-3 grid grid-cols-3 gap-2"},ws={class:"col-span-3 md:col-span-1"},$s=e("label",{for:"search-by-entity-name",class:"block text-sm font-medium leading-6 text-gray-900"},"Cliente",-1),ks={class:"mt-2"},qs={key:0,class:"text-red-500 text-sm"},Vs={class:"col-span-3 md:col-span-1"},Cs=e("label",{for:"search-by-start-date",class:"block text-sm font-medium leading-6 text-gray-900"},"Data (início)",-1),Ss={class:"mt-2"},Is={key:0,class:"text-red-500 text-sm"},Ds={class:"col-span-3 md:col-span-1"},Os=e("label",{for:"search-by-end-date",class:"block text-sm font-medium leading-6 text-gray-900"},"Data (fim)",-1),Us={class:"mt-2"},Ls={key:0,class:"text-red-500 text-sm"},Ms=["href"],Rs={class:"py-12 print:py-0"},As={class:"max-w-7xl mx-auto print:max-w-full"},js={class:"px-0 print:px-0"},Es={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg print:shadow-none"},Ns={class:"flex flex-col"},Ts={class:"overflow-x-auto sm:-mx-6 lg:-mx-8"},Ps={class:"inline-block min-w-full py-2 sm:px-6 lg:px-8"},Fs={class:"overflow-hidden"},Bs={class:"min-w-full text-left text-sm font-light"},zs=e("thead",{class:"border-b font-medium"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-4 text-center"},"#"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Cliente"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"À pagar"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Valor total"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Data da Venda "),e("th",{scope:"col",class:"px-6 py-4 text-center print:hidden",colspan:"2"}," Ações")])],-1),Gs={class:"border-b transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid"},Js={class:"whitespace-nowrap py-4 text-center font-medium"},Qs={class:"whitespace-normal px-6 py-4 text-center trim"},Ws=["title"],Xs={class:"whitespace-nowrap px-2 py-4 text-center"},Zs={class:"whitespace-nowrap px-2 py-4 text-center"},Hs={class:"whitespace-nowrap px-2 py-4 text-center"},Ks=["title","onClick"],Ys=["title","onClick"],ea={key:1,class:"transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid"},ta=e("td",{class:"whitespace-nowrap px-6 py-4 text-center",colspan:"9"},"Não há vendas cadastradas no momento!",-1),sa=[ta],fa={__name:"Sells",props:{page:Object,page_options:{type:Array,default:null},sells_list:Object,items:Object,parameters:Object},setup(s){const C=s,T=se.useToast(),l=H({id:null,client:"",date:Z(),estimated_value:0,total_value:0,partial_value:0,discount_percent:0,discount:0,entry_value:0,observations:"",items_list:[]}),I=L(!1),p=H({entity_name:C.parameters.entity_name,start_date:C.parameters.start_date,end_date:C.parameters.end_date}),M=L(""),R=U(()=>{const g=M.value.toLowerCase();return C.sells_list.filter(u=>{const{id:r,entity_name:y,observations:b,date:O,accounting:B,items:j}=u,{total_value:x,partial_value:n}=B,a=[r.toString(),(y==null?void 0:y.toLowerCase())??"",(b==null?void 0:b.toLowerCase())??"",(O==null?void 0:O.toLowerCase())??"",k(x).toLowerCase()??"",k(n).toLowerCase()??""];for(let t of a)if(t.includes(g))return!0;return j.some(t=>t.name.toLowerCase().includes(g))})}),z=U(()=>C.sells_list.reduce((g,u)=>g+u.accounting.partial_value,0)),D=L({mode:"create",show:!1,get title(){switch(this.mode){case"create":return"Criar venda";case"update":return"Editar venda";case"see":return"Ver informações da venda"}},get primary_button_txt(){switch(this.mode){case"create":return"Cadastrar";case"update":return"Atualizar";case"see":return"Fechar"}}}),_=(g,u=null)=>{const r=["update","see"].includes(g);if(u!==null&&r){const y=C.sells_list.find(b=>b.id===u);if(y){const{id:b,entity_name:O,date:B,observations:j,accounting:x,items:n}=y;l.id=b,l.client=O,l.date=B,l.estimated_value=x.estimated_value,l.total_value=x.total_value,l.partial_value=x.partial_value,l.entry_value=0,l.discount=x.estimated_value-x.total_value,l.discount_percent=l.discount/(x.estimated_value||1)*100,l.observations=j,l.items_list=n}}D.value.mode=g,D.value.show=!0},q=()=>{l.reset(),D.value.show=!1},A=()=>{l.post(route("sells.store"),{preserveScroll:!0,onSuccess:()=>q(),onError:g=>{console.log(g)}})},P=()=>{p.post(route("sells.filter"),{preserveScroll:!0})},G=()=>{l.put(route("sells.update",l.id),{preserveScroll:!0,onSuccess:()=>q()})},F=(g,u)=>{confirm(`Você tem certeza que deseja excluir a venda de material para "${u}"? Todos os materiais comprados voltarão para o estoque! Esta ação não poderá ser desfeita!`)&&l.delete(route("sells.destroy",g),{preserveScroll:!0,onSuccess:()=>T.success("Venda deletado com sucesso!")})},Q=()=>{switch(D.value.mode){case"create":return A();case"update":return G();case"see":return q();default:T.error("Método desconhecido. Informar o Técnico.")}};return(g,u)=>(o(),c(J,null,[f(i(ae),{class:"print:hidden",title:s.page.name},null,8,["title"]),f(re,{page:s.page,page_options:s.page_options},{header:S(()=>[e("h2",_s,[w(d(s.page.name)+" ",1),g.$page.props.auth.user.hierarchy<2?(o(),c("span",gs,"| "+d(i(k)(z.value)),1)):m("",!0)]),f(ge,{icon:"plus",onClick:u[0]||(u[0]=r=>_("create")),title:"Cadastrar Sell",class:"print:hidden"})]),default:S(()=>[e("div",ys,[e("div",hs,[e("div",vs,[e("div",xs,[f(i(ye),{class:"w-5 y-5"}),v(e("input",{type:"text",name:"search_term",id:"search_term",autocomplete:"on",class:"simple-input",autofocus:"true",placeholder:"Pesquisar termo...","onUpdate:modelValue":u[1]||(u[1]=r=>M.value=r)},null,512),[[$,M.value]]),e("span",fs,[f(i(he),{class:"w-5 h-5"})]),I.value?(o(),c("span",{key:1,class:"select-none cursor-pointer",title:"Fechar opções de filtro",onClick:u[3]||(u[3]=r=>I.value=!1)},[f(i(ie),{class:"w-5 y-5"})])):(o(),c("span",{key:0,class:"select-none cursor-pointer",title:"Abrir opções de filtro",onClick:u[2]||(u[2]=r=>I.value=!0)},[f(i(ne),{class:"w-5 y-5"})]))]),v(e("div",bs,[e("div",ws,[$s,e("div",ks,[v(e("input",{type:"text",name:"search-by-entity-name",id:"search-by-entity-name",class:"simple-input disabled:bg-gray-200",placeholder:"Filtrar por nome do cliente","onUpdate:modelValue":u[4]||(u[4]=r=>i(p).entity_name=r),onInput:P,required:""},null,544),[[$,i(p).entity_name]]),i(p).errors.entity_name?(o(),c("p",qs,d(i(p).errors.entity_name),1)):m("",!0)])]),e("div",Vs,[Cs,e("div",Ss,[v(e("input",{type:"date",name:"search-by-start-date",id:"search-by-start-date",class:"simple-input disabled:bg-gray-200",placeholder:"Filtrar por período (início)","onUpdate:modelValue":u[5]||(u[5]=r=>i(p).start_date=r),onInput:P,required:""},null,544),[[$,i(p).start_date]]),i(p).errors.start_date?(o(),c("p",Is,d(i(p).errors.start_date),1)):m("",!0)])]),e("div",Ds,[Os,e("div",Us,[v(e("input",{type:"date",name:"search-by-end-date",id:"search-by-end-date",class:"simple-input disabled:bg-gray-200",placeholder:"Filtrar por período (fim)","onUpdate:modelValue":u[6]||(u[6]=r=>i(p).end_date=r),onInput:P,required:""},null,544),[[$,i(p).end_date]]),i(p).errors.end_date?(o(),c("p",Ls,d(i(p).errors.end_date),1)):m("",!0)])]),e("a",{href:g.route("sells.index"),class:"text-red-500 hover:text-red-700 active:text-red-900 text-sm select-none mt-2",onClick:u[7]||(u[7]=r=>i(p).reset())},"Resetar busca",8,Ms)],512),[[le,I.value]])])])]),e("div",Rs,[e("div",As,[e("div",js,[e("div",Es,[e("div",Ns,[e("div",Ts,[e("div",Ps,[e("div",Fs,[e("table",Bs,[zs,e("tbody",null,[R.value.length?(o(!0),c(J,{key:0},X(R.value,r=>(o(),c("tr",Gs,[e("td",Js,d(r.id),1),e("td",Qs,[w(d(r.entity_name)+" ",1),r.observations?(o(),c("span",{key:0,title:r.observations,class:"inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10 cursor-help"},"OBS",8,Ws)):m("",!0)]),e("td",Xs,d(i(k)(r.accounting.partial_value)),1),e("td",Zs,d(r.accounting.total_value>0?i(k)(r.accounting.total_value):"Pago"),1),e("td",Hs,d(i(Z)(r.date,!0)),1),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-indigo-700 active:text-indigo-900 select-none print:hidden",title:"VER: Compra de "+r.entity_name,onClick:y=>_("see",r.id)},[f(i(K),{class:"w-5 h-5 m-auto"})],8,Ks),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-red-700 active:text-red-900 select-none print:hidden",title:"EXCLUIR: Compra de "+r.entity_name,onClick:y=>F(r.id,r.entity_name)},[f(i(_e),{class:"w-5 h-5 m-auto"})],8,Ys)]))),256)):(o(),c("tr",ea,sa))])])])])])])])])])]),f(ps,{modal:D.value,sell:i(l),items:s.items,onSubmit:Q,onClose:q},null,8,["modal","sell","items"])]),_:1},8,["page","page_options"])],64))}};export{fa as default};
