import{r as L,k as D,c as E,o as i,w as q,e as m,b as x,n as N,f as $,t as c,a as e,h as K,d as u,s as b,u as n,v as V,F as W,g as X,H as Y,m as ee,T as H,Z as te,z as se}from"./app-CvAlCVsm.js";import{a as ae,b as le,_ as oe}from"./AppLayout-PcgpBm_n.js";import{_ as ne}from"./CreateUpdateModal-BQ3IFhSt.js";import{_ as ie}from"./PrimaryButton-CMcNbFER.js";import{_ as de}from"./SecondaryButton-DmFe0qdl.js";import{f as G,t as w}from"./general-D_37hS-e.js";import{_ as re,r as ce}from"./SelectSearchItem-dYojki8k.js";import{_ as ue}from"./ClientSelector-D2BBdkmY.js";import{r as me}from"./PlusIcon-Egh1AfEM.js";import{r as pe}from"./PencilIcon-G-YSz9bE.js";import{r as _e}from"./BanknotesIcon-DJ1eA1T_.js";import{r as Z}from"./EyeIcon-Be-mZmg-.js";import{_ as ge}from"./FloatButton-D76LaAYh.js";/* empty css                    */import{r as he}from"./MagnifyingGlassIcon-DHls4Nc_.js";import{r as ye}from"./XMarkIcon-B-8YcTZB.js";import"./Modal-BTcRdpT-.js";import"./lodash-BFq6OCGj.js";import"./PrinterIcon-B4PmphTK.js";const xe={class:"pb-12 space-y-12 divide-y-2"},ve={class:"py-4"},fe=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Informações Básicas",-1),be=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Informações sobre a venda como nome do cliente, data da venda e observações",-1),we={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"},$e={class:"sm:col-span-3"},ke=e("label",{for:"sell-client",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Cliente",-1),qe={class:"mt-2"},Ve={key:0,class:"text-red-500 text-sm"},Ce={class:"sm:col-span-3"},Se=e("label",{for:"sell-date",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Data da Venda",-1),Ie={class:"mt-2"},Oe=["disabled","max"],Ue={key:0,class:"text-red-500 text-sm"},De={class:"sm:col-span-6"},Le=e("label",{for:"sell-observations",class:"block text-sm font-medium leading-6 text-gray-900"},"Observações",-1),Re={class:"mt-2"},Ae=["disabled"],Me={key:0,class:"text-red-500 text-sm"},je={key:0,class:"py-4"},Ee=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Lista de Itens",-1),Te=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Adicione os itens da venda bem como descontos e valor de pagamento de entrada.",-1),Ne={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-4"},Pe={key:0,class:"sm:col-span-4"},Fe=e("label",{for:"item-selecter",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Selecione os itens de venda",-1),Be={class:"mt-2"},ze={class:"md:col-span-2 lg:col-span-1"},Je=e("label",{for:"sell-estimated-amount",class:"block text-sm font-medium leading-6 text-gray-900"},"Valor estimado ",-1),Qe={class:"relative mt-2 rounded-md shadow-sm"},We=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1),Ge=["disabled"],He={key:0,class:"text-red-500 text-sm"},Xe={class:"md:col-span-2 lg:col-span-1"},Ze=e("label",{for:"sell-total-amount",class:"block text-sm font-medium leading-6 text-gray-900"},"Valor final ",-1),Ke={class:"relative mt-2 rounded-md shadow-sm"},Ye=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1),et=["disabled","value"],tt={key:0,class:"text-red-500 text-sm"},st={class:"md:col-span-2 lg:col-span-1"},at=e("label",{for:"sell-discount-percent",class:"block text-sm font-medium leading-6 text-gray-900"},"Desconto (%) ",-1),lt={class:"relative mt-2 rounded-md shadow-sm"},ot=["disabled","value"],nt=e("div",{class:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3"},[e("span",{class:"text-gray-500 sm:text-sm"},"%")],-1),it={key:0,class:"text-red-500 text-sm"},dt={class:"md:col-span-2 lg:col-span-1"},rt=e("label",{for:"sell-discount",class:"block text-sm font-medium leading-6 text-gray-900"},"Desconto (R$) ",-1),ct={class:"relative mt-2 rounded-md shadow-sm"},ut=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1),mt=["disabled","value"],pt={key:0,class:"text-red-500 text-sm"},_t={class:"sm:col-span-4"},gt={key:0,class:"min-w-full text-left text-sm font-medium leading-6 text-gray-900"},ht={class:"border-b font-medium"},yt=e("th",{scope:"col",class:"px-6 py-4 text-center"},"#",-1),xt=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Item",-1),vt=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Qtd. Estoque",-1),ft=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Qtd. Venda",-1),bt=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Und. Medida",-1),wt=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Preço unitário",-1),$t=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Preço montante",-1),kt={key:0,scope:"col",class:"px-6 py-4 text-center"},qt={class:"whitespace-nowrap py-4 text-center font-medium"},Vt={class:"whitespace-nowrap py-4 text-center font-medium"},Ct={class:"whitespace-nowrap py-4 text-center font-medium flex justify-center"},St=["value","onInput","disabled"],It={class:"whitespace-nowrap py-4 text-center font-medium"},Ot={class:"whitespace-nowrap py-4 text-center font-medium"},Ut={class:"whitespace-nowrap py-4 text-center font-medium"},Dt={key:0,class:"whitespace-nowrap py-4 text-center font-mono text-2xl"},Lt=["onClick","title"],Rt={key:1,class:"p-5 bg-gray-200 rounded-md block text-sm font-medium leading-6 text-gray-900"},At={key:1,class:"w-full py-4"},Mt=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Pagamento de entrada",-1),jt=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Após a conclusão da compra, um registro de pagamento será criado na página de PAGAMENTOS. ",-1),Et=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Se algum pagamento de entrada (ou pagamento total) for realizado, registre aqui.",-1),Tt={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-4"},Nt={class:"md:col-span-2 lg:col-span-1 text-gray-700"},Pt={class:"font-extrabold text-green-500"},Ft={class:"md:col-span-2 lg:col-span-1 text-gray-700"},Bt={class:"font-extrabold text-green-500"},zt={class:"md:col-span-2 lg:col-span-1 text-gray-700"},Jt={class:"font-extrabold text-green-500"},Qt={class:"md:col-span-2 lg:col-span-1 text-gray-700"},Wt={class:"font-extrabold text-green-500"},Gt={class:"sm:col-span-2"},Ht=e("label",{for:"sell-entry-value",class:"block text-sm font-medium leading-6 text-gray-900"},"Pagamento de entrada ",-1),Xt={class:"relative mt-2 rounded-md shadow-sm"},Zt=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1),Kt=["disabled"],Yt={key:0,class:"text-red-500 text-sm"},es={class:"relative mt-2 rounded-md shadow-sm"},ts=["disabled"],ss=e("label",{for:"pay-all",class:"ml-3 text-sm text-neutral-500 select-none"},"Pagar agora",-1),as={class:"sm:col-span-2"},ls=e("label",{for:"sell-partial-value",class:"block text-sm font-medium leading-6 text-gray-900"},"Valor restante ",-1),os={class:"relative mt-2 rounded-md shadow-sm"},ns=e("div",{class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},[e("span",{class:"text-gray-500 sm:text-sm"},"R$")],-1),is=["value"],ds={key:0,class:"text-red-500 text-sm"},rs={__name:"CreateUpdateSellsModal",props:{modal:Object,sell:{type:Object,default:null},items:Array},emits:["close","submit"],setup(t,{emit:k}){const T=k,l=t,C=L(JSON.parse(JSON.stringify(l.items))),p=L(!1),R=/^\d{4}-\d{2}-\d{2}$/,A=D(()=>{const{client_id:d,date:a}=l.sell;return!!d&&a&&R.test(a)}),P=D(()=>{const{client_id:d,date:a,total_value:s,items_list:h}=l.sell;return!d||!a||!R.test(a)||!(s>0)?!1:h.every(y=>y.quantity>0&&y.movement_quantity<=y.quantity)}),S=D(()=>l.sell.total_value-l.sell.entry_value),g=D(()=>l.modal.mode==="see"),I=L(""),B=L(!1);D(()=>C.value.filter(d=>d.name.toLowerCase().includes(I.value.toLowerCase())));const O=()=>{l.sell.estimated_value=l.sell.items_list.reduce((d,a)=>d+a.price*a.movement_quantity,0),o("estimated_value")},z=d=>{l.sell.items_list.push({id:d.id,name:d.name,quantity:d.quantity,max_quantity:d.max_quantity,min_quantity:d.min_quantity,movement_quantity:1,measurement_unit:d.measurement_unit.abbreviation,price:d.price,amount:d.price}),F(),I.value="",B.value=!1,O()},J=d=>{l.sell.items_list=l.sell.items_list.filter(a=>a.id!==d),F(),O()},F=()=>{C.value=l.items.filter(d=>!l.sell.items_list.some(a=>a.id===d.id))},_=(d,a)=>{l.sell[a]=d.target.value,o(a)},r=(d,a)=>{const s=10**a;return Math.floor(d*s)/s},o=d=>{let{estimated_value:a,total_value:s,discount_percent:h,discount:y}=l.sell;switch(d){case"estimated_value":case"discount_percent":s=a*(1-h/100),y=a-s;break;case"total_value":y=a-s,h=y/a*100;break;case"discount":h=y/a*100,s=a-y;break}Object.assign(l.sell,{estimated_value:a,total_value:s,discount_percent:h,discount:y})},v=()=>{p.value?l.sell.entry_value=l.sell.total_value:l.sell.entry_value=0},f=()=>{l.sell.partialValue===0?p.value=!0:p.value=!1},U=d=>{z(d)},M=()=>{T("close")},j=()=>{T("submit")};return(d,a)=>(i(),E(ne,{show:t.modal.show,maxWidth:A.value||g.value?"6xl":"2xl",onClose:M},{icon:q(()=>[e("div",{class:N(["mx-auto shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-400 sm:mx-0 sm:h-10 sm:w-10",{"bg-yellow-400":t.modal.mode==="update","bg-green-400":t.modal.mode==="pay","bg-gray-400":t.modal.mode==="see"}])},[t.modal.mode==="create"?(i(),E(n(me),{key:0,class:"w-5 h-5 text-white"})):m("",!0),t.modal.mode==="update"?(i(),E(n(pe),{key:1,class:"w-5 h-5 text-white"})):m("",!0),t.modal.mode==="pay"?(i(),E(n(_e),{key:2,class:"w-5 h-5 text-white"})):m("",!0),t.modal.mode==="see"?(i(),E(n(Z),{key:3,class:"w-5 h-5 text-white"})):m("",!0)],2)]),title:q(()=>[$(c(t.modal.title),1)]),content:q(()=>[e("form",{onSubmit:K(j,["prevent"])},[e("div",xe,[e("section",ve,[fe,be,e("div",we,[e("div",$e,[ke,e("div",qe,[x(ue,{modelValue:t.sell.client_id,"onUpdate:modelValue":a[0]||(a[0]=s=>t.sell.client_id=s),disabled:g.value,class:"disabled:bg-gray-200",required:!0},null,8,["modelValue","disabled"]),t.sell.errors.client_id?(i(),u("p",Ve,c(t.sell.errors.client_id),1)):m("",!0)])]),e("div",Ce,[Se,e("div",Ie,[b(e("input",{type:"date",name:"sell-date",id:"sell-date",autocomplete:"on",class:"simple-input disabled:bg-gray-200",disabled:g.value,autofocus:"true",placeholder:"Data da Venda",max:n(G)(),"onUpdate:modelValue":a[1]||(a[1]=s=>t.sell.date=s),required:""},null,8,Oe),[[V,t.sell.date]]),t.sell.errors.date?(i(),u("p",Ue,c(t.sell.errors.date),1)):m("",!0)])]),e("div",De,[Le,e("div",Re,[b(e("textarea",{type:"text",observations:"sell-observations",id:"sell-observations",autocomplete:"on",class:"simple-input disabled:bg-gray-200",disabled:g.value,placeholder:"Descreva a título mais detalhadamente ou insira informações adicionais","onUpdate:modelValue":a[2]||(a[2]=s=>t.sell.observations=s)},null,8,Ae),[[V,t.sell.observations]]),t.sell.errors.observations?(i(),u("p",Me,c(t.sell.errors.observations),1)):m("",!0)])])])]),A.value||g.value?(i(),u("section",je,[Ee,Te,e("div",Ne,[g.value?m("",!0):(i(),u("div",Pe,[Fe,e("div",Be,[x(re,{options:t.items,"onUpdate:modelValue":U},null,8,["options"])])])),e("div",ze,[Je,e("div",Qe,[We,b(e("input",{id:"sell-estimated-amount",type:"number",step:"0.01",min:"0",autocomplete:"off",readonly:"",class:"block w-full rounded-md border-0 py-1.5 pl-9 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6 disabled:bg-gray-200",placeholder:"Valor total estimado",disabled:!t.sell.items_list.length||g.value,"onUpdate:modelValue":a[3]||(a[3]=s=>t.sell.estimated_value=s),required:""},null,8,Ge),[[V,t.sell.estimated_value]]),t.sell.errors.estimated_value?(i(),u("p",He,c(t.sell.errors.estimated_value),1)):m("",!0)])]),e("div",Xe,[Ze,e("div",Ke,[Ye,e("input",{id:"sell-total-amount",type:"number",step:"0.01",min:"0",autocomplete:"off",class:"block w-full rounded-md border-0 py-1.5 pl-9 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6 disabled:bg-gray-200",placeholder:"Valor total estimado",disabled:!t.sell.items_list.length||g.value,value:r(t.sell.total_value,2),onInput:a[4]||(a[4]=s=>_(s,"total_value")),required:""},null,40,et),t.sell.errors.total_value?(i(),u("p",tt,c(t.sell.errors.total_value),1)):m("",!0)])]),e("div",st,[at,e("div",lt,[e("input",{id:"sell-discount-percent",type:"number",step:"0.01",min:"0",autocomplete:"off",class:"block w-full rounded-md border-0 py-1.5 pr-9 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6 disabled:bg-gray-200",placeholder:"Valor total estimado",disabled:!t.sell.items_list.length||g.value,value:r(t.sell.discount_percent,3),onInput:a[5]||(a[5]=s=>_(s,"discount_percent")),required:""},null,40,ot),nt,t.sell.errors.discount_percent?(i(),u("p",it,c(t.sell.errors.discount_percent),1)):m("",!0)])]),e("div",dt,[rt,e("div",ct,[ut,e("input",{id:"sell-discount",type:"number",step:"0.01",min:"0",autocomplete:"off",class:"block w-full rounded-md border-0 py-1.5 pl-9 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6 disabled:bg-gray-200",placeholder:"Valor total estimado",disabled:!t.sell.items_list.length||g.value,value:r(t.sell.discount,2),onInput:a[6]||(a[6]=s=>_(s,"discount")),required:""},null,40,mt),t.sell.errors.discount?(i(),u("p",pt,c(t.sell.errors.discount),1)):m("",!0)])]),e("div",_t,[l.sell.items_list.length?(i(),u("table",gt,[e("thead",ht,[e("tr",null,[yt,xt,vt,ft,bt,wt,$t,t.modal.mode!=="see"?(i(),u("th",kt," Deletar")):m("",!0)])]),e("tbody",null,[(i(!0),u(W,null,X(l.sell.items_list,s=>(i(),u("tr",{key:s.id,class:N(["border-b transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid",{"bg-yellow-100":s.movement_quantity==s.quantity,"bg-red-100":s.movement_quantity>s.quantity}])},[e("td",qt,c(s.id),1),e("td",Vt,c(s.name),1),e("td",{class:N(["whitespace-nowrap py-4 text-center font-medium",{"text-blue-500":s.quantity!=0&&s.quantity>=s.max_quantity,"text-green-500":s.quantity<s.max_quantity&&s.quantity>=s.min_quantity,"text-yellow-500":s.quantity<s.min_quantity&&s.quantity>0,"text-red-500":s.quantity==0}])},c(s.quantity),3),e("td",Ct,[e("input",{type:"number",min:"0.01",step:"0.01",value:s.movement_quantity,onInput:h=>{s.movement_quantity=h.target.value,s.amount=s.price*h.target.value,O()},class:"simple-input disabled:bg-gray-200 w-2/3",disabled:t.modal.mode!=="create"},null,40,St)]),e("td",It,c(s.measurement_unit),1),e("td",Ot,c(n(w)(s.price)),1),e("td",Ut,c(n(w)(s.amount?s.amount:10)),1),t.modal.mode!=="see"?(i(),u("td",Dt,[e("button",{onClick:h=>J(s.id),title:"Remover "+s.name},"×",8,Lt)])):m("",!0)],2))),128))])])):(i(),u("p",Rt," Nenhum item selecionado até o momento!"))])])])):m("",!0),A.value&&t.sell.items_list.length&&t.modal.mode==="create"?(i(),u("section",At,[Mt,jt,Et,e("div",Tt,[e("div",Nt,[$("Valor estimado: "),e("span",Pt,c(n(w)(t.sell.estimated_value)),1)]),e("div",Ft,[$("Valor final: "),e("span",Bt,c(n(w)(t.sell.total_value)),1)]),e("div",zt,[$("Desconto (%): "),e("span",Jt,c(r(t.sell.discount_percent,3))+"%",1)]),e("div",Qt,[$("Desconto (R$): "),e("span",Wt,c(n(w)(t.sell.discount)),1)]),e("div",Gt,[Ht,e("div",Xt,[Zt,b(e("input",{id:"sell-entry-value",type:"number",step:"0.01",min:"0",autocomplete:"off",class:"block w-full rounded-md border-0 py-1.5 pl-9 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6 disabled:bg-gray-200",placeholder:"Valor de pagamneto de entrada",disabled:!t.sell.items_list.length||g.value,"onUpdate:modelValue":a[7]||(a[7]=s=>t.sell.entry_value=s),onInput:a[8]||(a[8]=s=>f()),required:""},null,40,Kt),[[V,t.sell.entry_value]]),t.sell.errors.entry_value?(i(),u("p",Yt,c(t.sell.errors.entry_value),1)):m("",!0)]),e("div",es,[b(e("input",{type:"checkbox",id:"pay-all",class:"focus:bg-green-700 focus:ring-green-700 text-green-700 border-neutral-400 rounded-sm disabled:opacity-50","onUpdate:modelValue":a[9]||(a[9]=s=>p.value=s),onChange:a[10]||(a[10]=s=>v()),disabled:!t.sell.items_list.length||g.value},null,40,ts),[[Y,p.value]]),ss])]),e("div",as,[ls,e("div",os,[ns,e("input",{id:"sell-partial-value",type:"number",step:"0.01",min:"0",autocomplete:"off",class:"block w-full rounded-md border-0 py-1.5 pl-9 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6 disabled:bg-gray-200",placeholder:"Valor restante para pagamento posterior",disabled:!0,value:r(S.value,2),readonly:"",required:""},null,8,is),t.sell.errors.partial_value?(i(),u("p",ds,c(t.sell.errors.partial_value),1)):m("",!0)])])])])):m("",!0)])],32)]),footer:q(()=>[t.modal.mode!=="see"?(i(),E(de,{key:0,class:N({disabled:t.sell.processing}),onClick:a[11]||(a[11]=s=>M())},{default:q(()=>[$(" Cancelar ")]),_:1},8,["class"])):m("",!0),x(ie,{class:N({disabled:t.sell.processing||!P.value}),disabled:t.sell.processing||!P.value,onClick:a[12]||(a[12]=s=>j())},{default:q(()=>[$(c(t.modal.primary_button_txt),1)]),_:1},8,["class","disabled"])]),_:1},8,["show","maxWidth"]))}},cs={class:"font-semibold text-xl text-gray-800 leading-tight"},us={key:0},ms={class:"pt-12 print:hidden print:pt-0"},ps={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 print:w-full"},_s={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-5"},gs={class:"flex flex-row items-center space-x-3"},hs={class:"cursor-help select-none",title:"O campo de pesquisa ao lado filtra as informações carregadas na pagina. O formulário de pesquisa abaixo busca as informações filtradas no banco de dados e lista na página."},ys={class:"mt-3 grid grid-cols-3 gap-2"},xs={class:"col-span-3 md:col-span-1"},vs=e("label",{for:"search-by-entity-name",class:"block text-sm font-medium leading-6 text-gray-900"},"Cliente",-1),fs={class:"mt-2"},bs={key:0,class:"text-red-500 text-sm"},ws={class:"col-span-3 md:col-span-1"},$s=e("label",{for:"search-by-start-date",class:"block text-sm font-medium leading-6 text-gray-900"},"Data (início)",-1),ks={class:"mt-2"},qs={key:0,class:"text-red-500 text-sm"},Vs={class:"col-span-3 md:col-span-1"},Cs=e("label",{for:"search-by-end-date",class:"block text-sm font-medium leading-6 text-gray-900"},"Data (fim)",-1),Ss={class:"mt-2"},Is={key:0,class:"text-red-500 text-sm"},Os=["href"],Us={class:"py-12 print:py-0"},Ds={class:"max-w-7xl mx-auto print:max-w-full"},Ls={class:"px-0 print:px-0"},Rs={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg print:shadow-none"},As={class:"flex flex-col"},Ms={class:"overflow-x-auto sm:-mx-6 lg:-mx-8"},js={class:"inline-block min-w-full py-2 sm:px-6 lg:px-8"},Es={class:"overflow-hidden"},Ts={class:"min-w-full text-left text-sm font-light"},Ns=e("thead",{class:"border-b font-medium"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-4 text-center"},"#"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Cliente"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"À pagar"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Valor total"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Data da Venda "),e("th",{scope:"col",class:"px-6 py-4 text-center print:hidden",colspan:"2"}," Ações")])],-1),Ps={class:"border-b transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid"},Fs={class:"whitespace-nowrap py-4 text-center font-medium"},Bs={class:"whitespace-normal px-6 py-4 text-center trim"},zs=["title"],Js={class:"whitespace-nowrap px-2 py-4 text-center"},Qs={class:"whitespace-nowrap px-2 py-4 text-center"},Ws={class:"whitespace-nowrap px-2 py-4 text-center"},Gs=["title","onClick"],Hs=["title","onClick"],Xs={key:1,class:"transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid"},Zs=e("td",{class:"whitespace-nowrap px-6 py-4 text-center",colspan:"9"},"Não há vendas cadastradas no momento!",-1),Ks=[Zs],xa={__name:"Sells",props:{page:Object,page_options:{type:Array,default:null},sells_list:Object,items:Object,parameters:Object},setup(t){const k=t,T=ee.useToast(),l=H({id:null,client_id:null,date:G(),estimated_value:0,total_value:0,partial_value:0,discount_percent:0,discount:0,entry_value:0,observations:"",items_list:[]}),C=L(!1),p=H({entity_name:k.parameters.entity_name,start_date:k.parameters.start_date,end_date:k.parameters.end_date}),R=L(""),A=D(()=>{const _=R.value.toLowerCase();return k.sells_list.filter(r=>{var h,y;const{id:o,entity_name:v,observations:f,date:U,accounting:M,items:j}=r,{total_value:d,partial_value:a}=M,s=[o.toString(),(v==null?void 0:v.toLowerCase())??"",(f==null?void 0:f.toLowerCase())??"",(U==null?void 0:U.toLowerCase())??"",((h=w(d))==null?void 0:h.toLowerCase())??"",((y=w(a))==null?void 0:y.toLowerCase())??""];for(let Q of s)if(Q.includes(_))return!0;return j.some(Q=>Q.name.toLowerCase().includes(_))})}),P=D(()=>{var _;return(_=k.sells_list)==null?void 0:_.reduce((r,o)=>r+o.accounting.partial_value,0)}),S=L({mode:"create",show:!1,get title(){switch(this.mode){case"create":return"Criar venda";case"update":return"Editar venda";case"see":return"Ver informações da venda"}},get primary_button_txt(){switch(this.mode){case"create":return"Cadastrar";case"update":return"Atualizar";case"see":return"Fechar"}}}),g=(_,r=null)=>{const o=["update","see"].includes(_);if(r!==null&&o){const v=k.sells_list.find(f=>f.id===r);if(v){const{id:f,client_id:U,client:M,date:j,observations:d,accounting:a,items:s}=v;l.id=f,l.client_id=U,l.client=M,l.date=j,l.estimated_value=a.estimated_value,l.total_value=a.total_value,l.partial_value=a.partial_value,l.entry_value=0,l.discount=a.estimated_value-a.total_value,l.discount_percent=l.discount/(a.estimated_value||1)*100,l.observations=d,l.items_list=s}}S.value.mode=_,S.value.show=!0},I=()=>{l.reset(),S.value.show=!1},B=()=>{l.post(route("sells.store"),{preserveScroll:!0,onSuccess:()=>I(),onError:_=>{console.log(_)}})},O=()=>{p.post(route("sells.filter"),{preserveScroll:!0})},z=()=>{l.put(route("sells.update",l.id),{preserveScroll:!0,onSuccess:()=>I()})},J=(_,r)=>{confirm(`Você tem certeza que deseja excluir a venda de material para "${r}"? Todos os materiais comprados voltarão para o estoque! Esta ação não poderá ser desfeita!`)&&l.delete(route("sells.destroy",_),{preserveScroll:!0,onSuccess:()=>T.success("Venda deletado com sucesso!")})},F=()=>{switch(S.value.mode){case"create":return B();case"update":return z();case"see":return I();default:T.error("Método desconhecido. Informar o Técnico.")}};return(_,r)=>(i(),u(W,null,[x(n(te),{class:"print:hidden",title:t.page.name},null,8,["title"]),x(oe,{page:t.page,page_options:t.page_options},{header:q(()=>[e("h2",cs,[$(c(t.page.name)+" ",1),_.$page.props.auth.user.hierarchy<2?(i(),u("span",us,"| "+c(n(w)(P.value)),1)):m("",!0)]),x(ge,{icon:"plus",onClick:r[0]||(r[0]=o=>g("create")),title:"Cadastrar Sell",class:"print:hidden"})]),default:q(()=>[e("div",ms,[e("div",ps,[e("div",_s,[e("div",gs,[x(n(he),{class:"w-5 y-5"}),b(e("input",{type:"text",name:"search_term",id:"search_term",autocomplete:"on",class:"simple-input",autofocus:"true",placeholder:"Pesquisar termo...","onUpdate:modelValue":r[1]||(r[1]=o=>R.value=o)},null,512),[[V,R.value]]),e("span",hs,[x(n(ce),{class:"w-5 h-5"})]),C.value?(i(),u("span",{key:1,class:"select-none cursor-pointer",title:"Fechar opções de filtro",onClick:r[3]||(r[3]=o=>C.value=!1)},[x(n(le),{class:"w-5 y-5"})])):(i(),u("span",{key:0,class:"select-none cursor-pointer",title:"Abrir opções de filtro",onClick:r[2]||(r[2]=o=>C.value=!0)},[x(n(ae),{class:"w-5 y-5"})]))]),b(e("div",ys,[e("div",xs,[vs,e("div",fs,[b(e("input",{type:"text",name:"search-by-entity-name",id:"search-by-entity-name",class:"simple-input disabled:bg-gray-200",placeholder:"Filtrar por nome do cliente","onUpdate:modelValue":r[4]||(r[4]=o=>n(p).entity_name=o),onInput:O,required:""},null,544),[[V,n(p).entity_name]]),n(p).errors.entity_name?(i(),u("p",bs,c(n(p).errors.entity_name),1)):m("",!0)])]),e("div",ws,[$s,e("div",ks,[b(e("input",{type:"date",name:"search-by-start-date",id:"search-by-start-date",class:"simple-input disabled:bg-gray-200",placeholder:"Filtrar por período (início)","onUpdate:modelValue":r[5]||(r[5]=o=>n(p).start_date=o),onInput:O,required:""},null,544),[[V,n(p).start_date]]),n(p).errors.start_date?(i(),u("p",qs,c(n(p).errors.start_date),1)):m("",!0)])]),e("div",Vs,[Cs,e("div",Ss,[b(e("input",{type:"date",name:"search-by-end-date",id:"search-by-end-date",class:"simple-input disabled:bg-gray-200",placeholder:"Filtrar por período (fim)","onUpdate:modelValue":r[6]||(r[6]=o=>n(p).end_date=o),onInput:O,required:""},null,544),[[V,n(p).end_date]]),n(p).errors.end_date?(i(),u("p",Is,c(n(p).errors.end_date),1)):m("",!0)])]),e("a",{href:_.route("sells.index"),class:"text-red-500 hover:text-red-700 active:text-red-900 text-sm select-none mt-2",onClick:r[7]||(r[7]=o=>n(p).reset())},"Resetar busca",8,Os)],512),[[se,C.value]])])])]),e("div",Us,[e("div",Ds,[e("div",Ls,[e("div",Rs,[e("div",As,[e("div",Ms,[e("div",js,[e("div",Es,[e("table",Ts,[Ns,e("tbody",null,[A.value.length?(i(!0),u(W,{key:0},X(A.value,o=>{var v;return i(),u("tr",Ps,[e("td",Fs,c(o.id),1),e("td",Bs,[$(c(((v=o==null?void 0:o.client)==null?void 0:v.name)||o.entity_name)+" ",1),o.observations?(i(),u("span",{key:0,title:o.observations,class:"inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10 cursor-help"},"OBS",8,zs)):m("",!0)]),e("td",Js,c(n(w)(o.accounting.partial_value)),1),e("td",Qs,c(o.accounting.total_value>0?n(w)(o.accounting.total_value):"Pago"),1),e("td",Ws,c(n(G)(o.date,!0)),1),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-indigo-700 active:text-indigo-900 select-none print:hidden",title:"VER: Compra de "+o.entity_name,onClick:f=>g("see",o.id)},[x(n(Z),{class:"w-5 h-5 m-auto"})],8,Gs),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-red-700 active:text-red-900 select-none print:hidden",title:"EXCLUIR: Compra de "+o.entity_name,onClick:f=>J(o.id,o.entity_name)},[x(n(ye),{class:"w-5 h-5 m-auto"})],8,Hs)])}),256)):(i(),u("tr",Xs,Ks))])])])])])])])])])]),x(rs,{modal:S.value,sell:n(l),items:t.items,onSubmit:F,onClose:I},null,8,["modal","sell","items"])]),_:1},8,["page","page_options"])],64))}};export{xa as default};
