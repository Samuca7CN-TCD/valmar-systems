import{o as c,e as l,a as e,z as F,T as k,d as C,l as S,b as r,u as n,Z as G,w as $,f as A,t as i,h as L,q as Z,v as X,F as D,g as H,n as J}from"./app-CdtJtTu0.js";import{r as K,_ as Q}from"./AppLayout-Z7lV4-ZR.js";import{_ as W}from"./CreateUpdatePayModal-DaGHjVtz.js";import{_ as Y}from"./FloatButton--vsT8axI.js";import{_ as ee}from"./ExtraOptionsButton-B0tFYJNJ.js";import{f as E,t as m,h as M}from"./general-f63YF4ZR.js";/* empty css                    */import{r as te}from"./MagnifyingGlassIcon-BiRmH-Tu.js";import{r as se,a as oe}from"./XMarkIcon-DyBvvPV5.js";import"./CreateUpdateModal-qrZKX1dB.js";import"./Modal-DEGN8BMR.js";import"./PrimaryButton-Cr5ClqRv.js";import"./SecondaryButton-Dn8y9G9l.js";import"./PlusIcon-uMuNa2Lf.js";import"./EyeIcon-CkZAr6Jy.js";import"./PrinterIcon-QaO58D4F.js";function ae(d,_){return c(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12.75 11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.746 3.746 0 0 1 3.296-1.043A3.746 3.746 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 0 1 3.296 1.043 3.746 3.746 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12Z"})])}const ne={class:"font-semibold text-xl text-gray-800 leading-tight"},re={key:0},ie={class:"pt-12 print:hidden print:pt-0"},ce={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 print:w-full"},le={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-5"},de={class:"flex flex-row items-center space-x-3"},pe={class:"py-12 print:py-0"},ue={class:"max-w-7xl mx-auto print:max-w-full"},me={class:"px-0 print:px-0"},_e={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg print:shadow-none"},he={class:"flex flex-col"},xe={class:"overflow-x-auto sm:-mx-6 lg:-mx-8"},ve={class:"inline-block min-w-full py-2 sm:px-6 lg:px-8"},we={class:"overflow-hidden"},fe={class:"min-w-full text-left text-sm font-light"},ye=e("thead",{class:"border-b font-medium"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-4 text-center"},"#"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Prazo"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Título"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Cliente"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"À pagar"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Valor total"),e("th",{scope:"col",class:"px-6 py-4 text-center print:hidden"},"Entrega "),e("th",{scope:"col",class:"px-6 py-4 text-center print:hidden",colspan:"4"},"Ações ")])],-1),ge={class:"border-b transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid"},be={class:"whitespace-nowrap py-4 text-center font-medium"},ke={class:"whitespace-normal px-6 py-4 text-center trim"},Ce=["title"],Se={class:"whitespace-normal px-6 py-4 text-center"},$e={class:"whitespace-nowrap px-2 py-4 text-center"},Ae={class:"whitespace-nowrap px-2 py-4 text-center"},Le={class:"whitespace-nowrap px-2 py-4 text-center print:hidden"},De=["title","onClick"],Ee=["title","onClick"],Me={key:0},Oe={key:1,class:"m-auto text-center"},Te=["title","onClick"],Ve=["title","onClick"],Pe={key:1,class:"transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid"},Be=e("td",{class:"whitespace-nowrap px-6 py-4 text-center",colspan:"9"},"Não há serviços cadastrados no momento!",-1),Ne=[Be],et={__name:"Service",props:{page:Object,page_options:{type:Array,default:null},services_list:Object},setup(d){const _=d,f=F.useToast(),a=k({id:null,title:"",client:"",total_value:0,partial_value:0,observations:"",deadline:E(new Date(Date.now()+15*24*60*60*1e3),"new_date"),records_list:{enable_records:!1,data:[]}}),x=C(""),y=S(()=>{const o=x.value.toLowerCase();return _.services_list.filter(s=>{var t;return s.motive.toLowerCase().includes(o)||s.entity_name.toLowerCase().includes(o)||((t=s.observations)==null?void 0:t.toLowerCase().includes(o))||m(s.accounting.total_value).toString().toLowerCase().includes(o)||m(s.accounting.partial_value).toString().toLowerCase().includes(o)||s.deadline.includes(o)})}),O=S(()=>_.services_list.reduce((o,s)=>o+s.accounting.partial_value,0)),T=o=>{const s=M(o);return s===0?"text-red-500":s>0&&s<8?"text-orange-500":s>7&&s<15?"text-yellow-500":s>14&&s<30?"text-green-500":"text-blue-500"},p=C({mode:"create",show:!1,get title(){switch(this.mode){case"create":return"Criar serviço";case"update":return"Editar serviço";case"pay":return"Pagar serviço";case"see":return"Ver informações do serviço"}},get primary_button_txt(){switch(this.mode){case"create":return"Cadastrar";case"update":return"Atualizar";case"pay":return"Pagar";case"see":return"Fechar"}}}),v=(o,s=null)=>{const t=["update","pay"].includes(o);if(s!==null&&t){const u=_.services_list.find(w=>w.id===s);if(u){const{id:w,motive:I,entity_name:R,observations:U,records:g,accounting:b}=u;a.id=w,a.title=I,a.client=R,a.total_value=b.total_value,a.partial_value=b.partial_value,a.observations=U,a.records_list.enable_records=!!g.length,a.records_list.data=g.map(q=>k(q))}}p.value.mode=o,p.value.show=!0},h=()=>{a.reset(),p.value.show=!1},V=()=>{a.post(route("services.store"),{preserveScroll:!0,onSuccess:()=>h(),onError:o=>{console.log(o)}})},P=()=>{a.put(route("services.update",a.id),{preserveScroll:!0,onSuccess:()=>h()})},B=()=>{a.put(route("services.pay",a.id),{preserveScroll:!0,onSuccess:()=>h()})},N=(o,s)=>{if(s!==0){if(!confirm("O serviço será considerado como concluído e será listado apenas na página de pagamentos"))return}else if(!confirm("O serviço será considerado concluído e pago!"))return;a.put(route("services.conclude",o),{preserveScroll:!0})},z=(o,s)=>{confirm(`Você tem certeza que deseja excluir o serviço "${s}"? Esta ação não poderá ser desfeita!`)&&a.delete(route("services.destroy",o),{preserveScroll:!0,onSuccess:()=>f.success("Serviço deletado com sucesso!")})},j=()=>{switch(p.value.mode){case"create":return V();case"update":return P();case"pay":return B();default:f.error("Método desconhecido. Informar o Técnico.")}};return(o,s)=>(c(),l(D,null,[r(n(G),{title:d.page.name},null,8,["title"]),r(Q,{page:d.page,page_options:d.page_options},{header:$(()=>[e("h2",ne,[A(i(d.page.name)+" ",1),o.$page.props.auth.user.hierarchy<2?(c(),l("span",re,"| "+i(n(m)(O.value)),1)):L("",!0)]),r(Y,{icon:"plus",onClick:s[0]||(s[0]=t=>v("create")),title:"Cadastrar Service",class:"print:hidden"})]),default:$(()=>[e("div",ie,[e("div",ce,[e("div",le,[e("div",de,[r(n(te),{class:"w-5 y-5"}),Z(e("input",{type:"text",name:"search_term",id:"search_term",autocomplete:"on",class:"simple-input",autofocus:"true",placeholder:"Pesquisar termo...","onUpdate:modelValue":s[1]||(s[1]=t=>x.value=t)},null,512),[[X,x.value]])])])])]),e("div",pe,[e("div",ue,[e("div",me,[e("div",_e,[e("div",he,[e("div",xe,[e("div",ve,[e("div",we,[e("table",fe,[ye,e("tbody",null,[y.value.length?(c(!0),l(D,{key:0},H(y.value,t=>(c(),l("tr",ge,[e("td",be,i(t.id),1),e("td",{class:J(["whitespace-nowrap py-4 text-center font-medium",T(t.deadline)])},i(n(M)(t.deadline))+" dias ",3),e("td",ke,[A(i(t.motive)+" ",1),t.observations?(c(),l("span",{key:0,title:t.observations,class:"inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10 cursor-help"},"OBS",8,Ce)):L("",!0)]),e("td",Se,i(t.entity_name),1),e("td",$e,i(n(m)(t.accounting.partial_value)),1),e("td",Ae,i(n(m)(t.accounting.total_value)),1),e("td",Le,i(n(E)(t.deadline,!0)),1),e("td",{class:"whitespace-nowrap px-4 py-4 pl-10 text-center cursor-pointer hover:text-blue-700 active:text-blue-900 select-none print:hidden",title:"CONCLUIR: "+t.motive+"("+t.entity_name+")",onClick:u=>N(t.id,t.accounting.partial_value)},[r(n(ae),{class:"w-4 h-4 m-auto"})],8,De),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-green-700 active:text-green-900 select-none print:hidden",title:"PAGAR: "+t.motive+"("+t.entity_name+")",onClick:u=>v("pay",t.id)},[t.accounting.partial_value!==0?(c(),l("span",Me,[r(n(K),{class:"w-4 h-4 m-auto"})])):(c(),l("span",Oe,"PAGO"))],8,Ee),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-yellow-700 active:text-yellow-900 select-none print:hidden",title:"EDITAR: "+t.motive+"("+t.entity_name+")",onClick:u=>v("update",t.id)},[r(n(se),{class:"w-4 h-4 m-auto"})],8,Te),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-red-700 active:text-red-900 select-none print:hidden",title:"EXCLUIR: "+t.motive+"("+t.entity_name+")",onClick:u=>z(t.id,t.name)},[r(n(oe),{class:"w-4 h-4 m-auto"})],8,Ve)]))),256)):(c(),l("tr",Pe,Ne))])])])])])])])])])]),r(W,{show:p.value.show,modal:p.value,service:n(a),onSubmit:j,onClose:h},null,8,["show","modal","service"]),r(ee,{mode:["rollup","print_page","link"],link_type:["previous"],link:[o.route("services.previous")]},null,8,["link"])]),_:1},8,["page","page_options"])],64))}};export{et as default};
