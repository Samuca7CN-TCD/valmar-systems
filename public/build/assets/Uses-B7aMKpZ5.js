import{d as j,l as I,o as n,c as V,w as k,a as e,n as M,u as h,f as p,g as E,t as d,i as W,e as l,p as b,F as A,h as T,q as P,v as S,s as X,b as w,T as Z,Z as G}from"./app-B9AaS3di.js";import{_ as H}from"./AppLayout-BpgBCMDE.js";import{r as J,f as R,_ as K,t as F,a as Y,b as ee}from"./general-CT66CFmJ.js";import{_ as te}from"./PrimaryButton-C6t27UzX.js";import{_ as se}from"./SecondaryButton-DopaOyGA.js";import{r as oe}from"./PrinterIcon-CisfNOAW.js";import{r as ae}from"./BanknotesIcon-D31jRm2d.js";import{r as z}from"./EyeIcon-EVOI874d.js";import{_ as ne}from"./FloatButton-Ci1qFIeh.js";import"./Modal-tn0Up1zP.js";const le={class:"pb-12 space-y-12 divide-y-2"},ie={class:"py-4"},re=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Informações Básicas",-1),de=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Informações sobre a uso como nome do funcionário, data da uso e observações",-1),ue={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"},ce={class:"sm:col-span-3"},me=e("label",{for:"use-employee",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Responsável",-1),pe={key:0,class:"mt-2"},ye=e("option",{disabled:"",selected:""},"Escolha uma funcionário",-1),he=["value"],xe={key:0,class:"text-red-500 text-sm"},_e={key:1,class:"mt-2"},ve={key:0,class:"text-red-500 text-sm"},fe={class:"flex flex-row align-middle items-center space-x-2 mt-2"},ge=e("label",{for:"switch_entity_type",class:"text-sm text-neutral-500"}," Funcionário?",-1),be={class:"sm:col-span-3"},we=e("label",{for:"use-date",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Data do Uso",-1),ke={class:"mt-2"},qe=["max"],$e={key:0,class:"text-red-500 text-sm"},Ce={class:"sm:col-span-6"},Ue=e("label",{for:"use-motive",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Motivo",-1),Ve={class:"mt-2"},Me={key:0,class:"text-red-500 text-sm"},Se={class:"sm:col-span-6"},Ie=e("label",{for:"use-observations",class:"block text-sm font-medium leading-6 text-gray-900"},"Observações",-1),Le={class:"mt-2"},De={key:0,class:"text-red-500 text-sm"},Ee={key:0,class:"py-4"},je=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Lista de Itens",-1),Ae=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Adicione os itens do uso.",-1),Ne={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-4"},Oe={class:"sm:col-span-4"},Te={class:"relative"},Be=e("label",{for:"item-selecter",class:"block text-sm font-medium leading-6 text-gray-900"},"Selecione os itens de uso",-1),Fe=["disabled"],Re={key:0,class:"absolute z-10 w-full mx-auto sm:w-96 bg-white border rounded mt-2 h-96 overflow-y-scroll"},ze=["onMousedown"],Qe={class:"sm:col-span-4"},We={key:0,class:"min-w-full text-left block text-sm font-medium leading-6 text-gray-900"},Pe={class:"border-b font-medium dark:border-neutral-500"},Xe=e("th",{scope:"col",class:"px-6 py-4 text-center"},"#",-1),Ze=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Item",-1),Ge=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Qtd. Estoque",-1),He=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Qtd. Uso",-1),Je=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Und. Medida",-1),Ke={key:0,scope:"col",class:"px-6 py-4 text-center"},Ye={class:"whitespace-nowrap py-4 text-center font-medium"},et={class:"whitespace-nowrap py-4 text-center font-medium"},tt={class:"whitespace-nowrap py-4 text-center font-medium flex justify-center"},st=["value","onInput","disabled"],ot={class:"whitespace-nowrap py-4 text-center font-medium"},at={key:0,class:"whitespace-nowrap py-4 text-center font-mono text-2xl"},nt=["onClick","title"],lt={key:1,class:"p-5 bg-gray-200 rounded-md block text-sm font-medium leading-6 text-gray-900"},it={__name:"CreateUpdateUsesModal",props:{modal:Object,use:{type:Object,default:null},items:Array,employees_list:Array},emits:["close","submit"],setup(s,{emit:L}){const r=L,u=s,$=j(!0),N=/^\d{4}-\d{2}-\d{2}$/,v=I(()=>{const{motive:a,employee:o,date:t}=u.use;return!o||!o.length||!a||!a.length?!1:t&&N.test(t)}),D=I(()=>{const{employee:a,motive:o,date:t,items_list:y}=u.use;return!a||!a.length||!o||!o.length||!t||!N.test(t)||y.length<1?!1:y.every(g=>g.quantity>0&&g.movement_quantity>0&&g.movement_quantity<=g.quantity)}),f=I(()=>u.modal.mode==="see"),C=j(""),U=j(!1),B=I(()=>u.items.filter(a=>a.name.toLowerCase().includes(C.value.toLowerCase())&&!u.use.items_list.some(o=>o.id===a.id))),O=a=>{a==="in"&&(U.value=!0),a==="out"&&(U.value=!1)},c=()=>{u.use.estimated_value=u.use.items_list.reduce((a,o)=>a+o.price*o.movement_quantity,0),u.use.total_value=u.use.estimated_value},m=a=>{u.use.items_list.push({id:a.id,name:a.name,quantity:a.quantity,max_quantity:a.max_quantity,min_quantity:a.min_quantity,movement_quantity:1,measurement_unit:a.measurement_unit.abbreviation,price:a.price,amount:a.price}),C.value="",U.value=!1,c()},i=a=>{u.use.items_list=u.use.items_list.filter(o=>o.id!==a),c()},x=()=>{r("close")},_=()=>{r("submit")};return(a,o)=>(n(),V(K,{show:s.modal.show,maxWidth:v.value||f.value?"3xl":"2xl",onClose:x},{icon:k(()=>[e("div",{class:M(["mx-auto shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-400 sm:mx-0 sm:h-10 sm:w-10",{"bg-yellow-400":s.modal.mode==="update","bg-green-400":s.modal.mode==="pay","bg-gray-400":s.modal.mode==="see"}])},[s.modal.mode==="create"?(n(),V(h(oe),{key:0,class:"w-5 h-5 text-white"})):p("",!0),s.modal.mode==="update"?(n(),V(h(J),{key:1,class:"w-5 h-5 text-white"})):p("",!0),s.modal.mode==="pay"?(n(),V(h(ae),{key:2,class:"w-5 h-5 text-white"})):p("",!0),s.modal.mode==="see"?(n(),V(h(z),{key:3,class:"w-5 h-5 text-white"})):p("",!0)],2)]),title:k(()=>[E(d(s.modal.title),1)]),content:k(()=>[e("form",{onSubmit:W(_,["prevent"])},[e("div",le,[e("section",ie,[re,de,e("div",ue,[e("div",ce,[me,$.value?(n(),l("div",pe,[b(e("select",{name:"use-employee",id:"use-employee",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Nome do funcionario","onUpdate:modelValue":o[0]||(o[0]=t=>s.use.employee=t),required:""},[ye,(n(!0),l(A,null,T(s.employees_list,t=>(n(),l("option",{key:a.employee.id,value:a.employee.id},"{employee.name} {employee.surname}",8,he))),128))],512),[[P,s.use.employee]]),s.use.errors.employee?(n(),l("p",xe,d(s.use.errors.employee),1)):p("",!0)])):(n(),l("div",_e,[b(e("input",{type:"text",name:"use-entity",id:"use-entity",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Nome do responsável","onUpdate:modelValue":o[1]||(o[1]=t=>s.use.employee=t),required:""},null,512),[[S,s.use.employee]]),s.use.errors.employee?(n(),l("p",ve,d(s.use.errors.employee),1)):p("",!0)])),e("span",fe,[b(e("input",{id:"switch_entity_type",type:"checkbox",class:"rounded border-gray-500 text-green-600 shadow-sm focus:border-green-300 focus:ring focus:ring-green-200 focus:ring-opacity-50","onUpdate:modelValue":o[2]||(o[2]=t=>$.value=t)},null,512),[[X,$.value]]),ge])]),e("div",be,[we,e("div",ke,[b(e("input",{type:"date",name:"use-date",id:"use-date",autocomplete:"on",class:"simple-input disabled:bg-gray-200",autofocus:"true",placeholder:"Data do Uso",max:h(R)(),"onUpdate:modelValue":o[3]||(o[3]=t=>s.use.date=t),required:""},null,8,qe),[[S,s.use.date]]),s.use.errors.date?(n(),l("p",$e,d(s.use.errors.date),1)):p("",!0)])]),e("div",Ce,[Ue,e("div",Ve,[b(e("input",{type:"text",name:"use-motive",id:"use-motive",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Motivo do Uso","onUpdate:modelValue":o[4]||(o[4]=t=>s.use.motive=t),required:""},null,512),[[S,s.use.motive]]),s.use.errors.motive?(n(),l("p",Me,d(s.use.errors.motive),1)):p("",!0)])]),e("div",Se,[Ie,e("div",Le,[b(e("textarea",{type:"text",observations:"use-observations",id:"use-observations",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Descreva a título mais detalhadamente ou insira informações adicionais","onUpdate:modelValue":o[5]||(o[5]=t=>s.use.observations=t)},null,512),[[S,s.use.observations]]),s.use.errors.observations?(n(),l("p",De,d(s.use.errors.observations),1)):p("",!0)])])])]),v.value||f.value?(n(),l("section",Ee,[je,Ae,e("div",Ne,[e("div",Oe,[e("div",Te,[Be,b(e("input",{id:"item-selecter","onUpdate:modelValue":o[6]||(o[6]=t=>C.value=t),onFocus:o[7]||(o[7]=t=>O("in")),onBlur:o[8]||(o[8]=t=>O("out")),class:"simple-input disabled:bg-gray-200 px-4 py-2 w-full",placeholder:"Digite para pesquisar",disabled:f.value},null,40,Fe),[[S,C.value]]),U.value?(n(),l("ul",Re,[(n(!0),l(A,null,T(B.value,(t,y)=>(n(),l("li",{key:y,class:"py-2 px-4 cursor-pointer hover:bg-gray-200",onMousedown:q=>m(t)},[e("span",{class:M(["inline",{"text-blue-500":t.quantity!=0&&t.quantity>=t.max_quantity,"text-green-500":t.quantity<t.max_quantity&&t.quantity>=t.min_quantity,"text-yellow-500":t.quantity<t.min_quantity&&t.quantity>0,"text-red-500":t.quantity==0}])},"("+d(t.quantity)+")",3),E(" "+d(t.name),1)],40,ze))),128))])):p("",!0)])]),e("div",Qe,[u.use.items_list.length?(n(),l("table",We,[e("thead",Pe,[e("tr",null,[Xe,Ze,Ge,He,Je,s.modal.mode!=="see"?(n(),l("th",Ke," Deletar")):p("",!0)])]),e("tbody",null,[(n(!0),l(A,null,T(u.use.items_list,t=>(n(),l("tr",{key:t.id,class:M(["border-b transition duration-300 ease-in-out hover:bg-neutral-100 dark:border-neutral-500 dark:hover:bg-neutral-600",{"bg-yellow-100":t.movement_quantity==t.quantity,"bg-red-100":t.movement_quantity>t.quantity}])},[e("td",Ye,d(t.id),1),e("td",et,d(t.name),1),e("td",{class:M(["whitespace-nowrap py-4 text-center font-medium",{"text-blue-500":t.quantity!=0&&t.quantity>=t.max_quantity,"text-green-500":t.quantity<t.max_quantity&&t.quantity>=t.min_quantity,"text-yellow-500":t.quantity<t.min_quantity&&t.quantity>0,"text-red-500":t.quantity==0}])},d(t.quantity),3),e("td",tt,[e("input",{type:"number",min:"0.01",step:"0.01",value:t.movement_quantity,onInput:y=>{t.movement_quantity=parseFloat(y.target.value),t.amount=t.price*y.target.value,c()},class:"simple-input disabled:bg-gray-200 w-2/3",disabled:s.modal.mode!=="create"},null,40,st)]),e("td",ot,d(t.measurement_unit),1),s.modal.mode!=="see"?(n(),l("td",at,[e("button",{onClick:y=>i(t.id),title:"Remover "+t.name},"×",8,nt)])):p("",!0)],2))),128))])])):(n(),l("p",lt," Nenhum item selecionado até o momento!"))])])])):p("",!0)])],32)]),footer:k(()=>[s.modal.mode!=="see"?(n(),V(se,{key:0,class:M({disabled:s.use.processing}),onClick:o[9]||(o[9]=t=>x())},{default:k(()=>[E(" Cancelar ")]),_:1},8,["class"])):p("",!0),w(te,{class:M({disabled:s.use.processing||!D.value}),disabled:s.use.processing||!D.value,onClick:o[10]||(o[10]=t=>_())},{default:k(()=>[E(d(s.modal.primary_button_txt),1)]),_:1},8,["class","disabled"])]),_:1},8,["show","maxWidth"]))}},rt={class:"font-semibold text-xl text-gray-800 leading-tight"},dt={class:"pt-12 print:hidden print:pt-0"},ut={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 print:w-full"},ct={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-5"},mt={class:"flex flex-row items-center space-x-3"},pt={class:"py-12 print:py-6"},yt={class:"max-w-7xl mx-auto print:max-w-full"},ht={class:"px-0 print:px-0"},xt={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg print:shadow-none"},_t={class:"flex flex-col"},vt={class:"overflow-x-auto sm:-mx-6 lg:-mx-8"},ft={class:"inline-block min-w-full py-2 sm:px-6 lg:px-8"},gt={class:"overflow-hidden"},bt={class:"min-w-full text-left text-sm font-light"},wt=e("thead",{class:"border-b font-medium dark:border-neutral-500"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-4 text-center"},"#"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Funcionário"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Motivo"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Data do Uso "),e("th",{scope:"col",class:"px-6 py-4 text-center print:hidden",colspan:"2"}," Ações")])],-1),kt={class:"border-b transition duration-300 ease-in-out hover:bg-neutral-100 dark:border-neutral-500 dark:hover:bg-neutral-600"},qt={class:"whitespace-nowrap py-4 text-center font-medium"},$t={class:"whitespace-normal px-6 py-4 text-center trim"},Ct=["title"],Ut={class:"whitespace-nowrap px-2 py-4 text-center"},Vt={class:"whitespace-nowrap px-2 py-4 text-center print:hidden"},Mt=["title","onClick"],St=["title","onClick"],It={key:1,class:"transition duration-300 ease-in-out hover:bg-neutral-100 dark:border-neutral-500 dark:hover:bg-neutral-600"},Lt=e("td",{class:"whitespace-nowrap px-6 py-4 text-center",colspan:"9"},"Não há usos cadastradas no momento!",-1),Dt=[Lt],Qt={__name:"Uses",props:{page:Object,page_options:{type:Array,default:null},uses_list:Object,employees_list:Array,items:Object},setup(s){const L=s,r=Z({id:null,employee:"",employee_id:null,motive:"",date:"",total_value:0,observations:"",items_list:[]}),u=j(""),$=I(()=>{const c=u.value.toLowerCase();return L.uses_list.filter(m=>{const{id:i,entity_name:x,motive:_,observations:a,date:o,items:t}=m,y=[i.toString(),(x==null?void 0:x.toLowerCase())??"",(_==null?void 0:_.toLowerCase())??"",(a==null?void 0:a.toLowerCase())??"",(o==null?void 0:o.toLowerCase())??""];for(let q of y)if(q.includes(c))return!0;return t.some(q=>q.name.toLowerCase().includes(c))})}),N=I(()=>L.uses_list.reduce((c,m)=>c+m.accounting.partial_value,0)),v=j({mode:"create",show:!1,get title(){switch(this.mode){case"create":return"Criar uso";case"update":return"Editar uso";case"see":return"Ver informações da uso"}},get primary_button_txt(){switch(this.mode){case"create":return"Cadastrar";case"update":return"Atualizar";case"see":return"Fechar"}}}),D=(c,m=null)=>{const i=["update","see"].includes(c);if(m!==null&&i){const x=L.uses_list.find(_=>_.id===m);if(x){const{id:_,entity_name:a,employee_id:o,date:t,motive:y,observations:q,accounting:g,items:Q}=x;r.id=_,r.employee=a,r.date=t,r.motive=y,r.estimated_value=g.estimated_value,r.total_value=g.total_value,r.partial_value=g.partial_value,r.observations=q,r.items_list=Q,r.employee_id=o}}v.value.mode=c,v.value.show=!0},f=()=>{r.reset(),v.value.show=!1},C=()=>{r.post(route("uses.store"),{preserveScroll:!0,onSuccess:()=>f(),onError:c=>{console.log(c)}})},U=()=>{r.put(route("uses.update",r.id),{preserveScroll:!0,onSuccess:()=>f()})},B=(c,m)=>{confirm(`Você tem certeza que deseja excluir a uso de material para "${m}"? Todos os materiais comprados voltarão para o estoque! Esta ação não poderá ser desfeita!`)&&r.delete(route("uses.destroy",c),{preserveScroll:!0,onSuccess:()=>alert("Uso deletado com sucesso!")})},O=()=>{switch(v.value.mode){case"create":return C();case"update":return U();case"see":return f();default:alert("Método desconhecido. Informar o Técnico.")}};return(c,m)=>(n(),l(A,null,[w(h(G),{title:s.page.name},null,8,["title"]),w(H,{page:s.page,page_options:s.page_options},{header:k(()=>[e("h2",rt,d(s.page.name)+" | "+d(h(F)(N.value)),1),w(ne,{icon:"plus",onClick:m[0]||(m[0]=i=>D("create")),title:"Cadastrar Use",class:"print:hidden"})]),default:k(()=>[e("div",dt,[e("div",ut,[e("div",ct,[e("div",mt,[w(h(Y),{class:"w-5 y-5"}),b(e("input",{type:"text",name:"search_term",id:"search_term",autocomplete:"on",class:"simple-input",autofocus:"true",placeholder:"Pesquisar termo...","onUpdate:modelValue":m[1]||(m[1]=i=>u.value=i)},null,512),[[S,u.value]])])])])]),e("div",pt,[e("div",yt,[e("div",ht,[e("div",xt,[e("div",_t,[e("div",vt,[e("div",ft,[e("div",gt,[e("table",bt,[wt,e("tbody",null,[$.value.length?(n(!0),l(A,{key:0},T($.value,i=>(n(),l("tr",kt,[e("td",qt,d(i.id),1),e("td",$t,[E(d(i.entity_name)+" ",1),i.observations?(n(),l("span",{key:0,title:i.observations,class:"inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10 cursor-help"},"OBS",8,Ct)):p("",!0)]),e("td",Ut,d(h(F)(i.motive)),1),e("td",Vt,d(h(R)(i.date,!0)),1),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-indigo-700 active:text-indigo-900 select-none print:hidden",title:"VER: Compra de "+i.entity_name,onClick:x=>D("see",i.id)},[w(h(z),{class:"w-5 h-5 m-auto"})],8,Mt),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-red-700 active:text-red-900 select-none print:hidden",title:"EXCLUIR: Compra de "+i.entity_name,onClick:x=>B(i.id,i.entity_name)},[w(h(ee),{class:"w-5 h-5 m-auto"})],8,St)]))),256)):(n(),l("tr",It,Dt))])])])])])])])])])]),w(it,{modal:v.value,use:h(r),items:s.items,onSubmit:O,onClose:f},null,8,["modal","use","items"])]),_:1},8,["page","page_options"])],64))}};export{Qt as default};
