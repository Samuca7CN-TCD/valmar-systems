import{z as F,T as E,d as w,l as f,o as n,e as i,b as l,u as r,Z as G,w as V,a as e,f as b,t as c,h as k,q as L,v as X,y as Z,F as M,g as H,n as J}from"./app-DELQ0zun.js";import{r as K,_ as Q}from"./AppLayout-BJZZssQA.js";import{_ as W}from"./CreateUpdatePayModal-BNKHJAk7.js";import{_ as Y}from"./FloatButton-CAjRqyyg.js";import{_ as ee}from"./ExtraOptionsButton-UbqaWiLz.js";import{t as p}from"./general-f63YF4ZR.js";/* empty css                    */import{r as te}from"./MagnifyingGlassIcon-5Z250XQa.js";import{r as se,a as oe}from"./XMarkIcon-DIYaic8A.js";import"./CreateUpdateModal-CJU2VWOl.js";import"./Modal-CenX5dUq.js";import"./PrimaryButton-Dy_Dw-uU.js";import"./SecondaryButton-C_gFdjfS.js";import"./PlusIcon-NVlxZOlH.js";import"./PrinterIcon-DWe8svUD.js";const ae={class:"font-semibold text-xl text-gray-800 leading-tight"},re={key:0},ne={key:1,class:"text-neutral-400"},ie=e("span",{class:"text-xs"}," (pagamentos + serviços)",-1),le={class:"pt-12 print:hidden"},ce={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},de={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-5"},pe={class:"flex flex-row items-center space-x-3"},ue={class:"ml-8 mt-1"},me=["checked"],_e=e("label",{for:"show-services",class:"ml-3 text-xs text-neutral-500 select-none"},"Mostrar serviços",-1),he={class:"py-12 print:py-0"},ve={class:"max-w-7xl mx-auto print:max-w-full"},xe={class:"px-0 print:px-0"},ye={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg print:shadow-none"},ge={class:"flex flex-col"},we={class:"overflow-x-auto sm:-mx-6 lg:-mx-8"},fe={class:"inline-block min-w-full py-2 sm:px-6 lg:px-8"},be={class:"overflow-hidden"},ke={class:"w-full text-left text-sm font-light"},Ce=e("thead",{class:"border-b font-medium"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-4 text-center"},"#"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Dívida"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Devedor"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"À pagar"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Valor total"),e("th",{scope:"col",class:"px-6 py-4 text-center print:hidden"},"Pagar "),e("th",{scope:"col",class:"px-6 py-4 text-center print:hidden"},"Editar "),e("th",{scope:"col",class:"px-6 py-4 text-center print:hidden"},"Excluir ")])],-1),$e={class:"whitespace-nowrap py-4 text-center font-medium"},Pe={class:"break-words px-6 py-4 text-center"},Se=["title"],Ee={class:"whitespace-normal px-6 py-4 text-center"},Ve={class:"whitespace-nowrap px-2 py-4 text-center"},Le={class:"whitespace-nowrap px-2 py-4 text-center"},Me=["title","onClick"],Te=["title","onClick"],Ae=["title","onClick"],Be={key:1,class:"whitespace-nowrap px-4 py-4 text-center select-none print:hidden"},De={key:1,class:"transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid"},Ne=e("td",{class:"whitespace-nowrap px-6 py-4 text-center",colspan:"9"},"Não há pagamentos cadastrados no momento!",-1),ze=[Ne],Ye={__name:"Payment",props:{page:Object,page_options:{type:Array,default:null},payments_list:Object},setup(u){const _=u,C=F.useToast(),a=E({id:null,debt:"",debtor:"",total_value:0,partial_value:0,observations:"",records_list:{enable_records:!1,data:[]}}),x=w(""),h=w(!0),$=f(()=>{const s=x.value.toLowerCase();return _.payments_list.filter(o=>o.motive.toLowerCase().includes(s)||o.entity_name.toLowerCase().includes(s)||p(o.accounting.total_value).toString().toLowerCase().includes(s)||p(o.accounting.partial_value).toString().toLowerCase().includes(s))}),T=f(()=>_.payments_list.reduce((s,o)=>s+o.accounting.partial_value,0)),A=f(()=>_.payments_list.filter(s=>s.type!==1).reduce((s,o)=>s+o.accounting.partial_value,0)),d=w({mode:"create",show:!1,get title(){switch(this.mode){case"create":return"Criar pagamento";case"update":return"Editar pagamento";case"pay":return"Pagar pagamento"}},get primary_button_txt(){switch(this.mode){case"create":return"Cadastrar";case"update":return"Atualizar";case"pay":return"Pagar"}}}),y=(s,o=null)=>{const t=["update","pay"].includes(s);if(o!==null&&t){const m=_.payments_list.find(g=>g.id===o);if(m){const{id:g,type:U,motive:j,entity_name:q,observations:I,records:P,accounting:S}=m;a.id=g,a.type=U,a.debt=j,a.debtor=q,a.total_value=S.total_value,a.partial_value=S.partial_value,a.observations=I,a.records_list.enable_records=!!P.length,a.records_list.data=P.map(R=>E(R))}}d.value.mode=s,d.value.show=!0},v=()=>{a.reset(),d.value.show=!1},B=()=>{a.post(route("payments.store"),{preserveScroll:!0,onSuccess:()=>v(),onError:s=>{console.log(s)}})},D=()=>{a.put(route("payments.update",a.id),{preserveScroll:!0,onSuccess:()=>v()})},N=()=>{a.put(route("payments.pay",a.id),{preserveScroll:!0,onSuccess:()=>v()})},z=(s,o)=>{confirm(`Você tem certeza que deseja excluir o pagamento "${o}"? Esta ação não poderá ser desfeita!`)&&a.delete(route("payments.destroy",s),{preserveScroll:!0,onSuccess:()=>C.success("Pagamento deletado com sucesso!")})},O=()=>{switch(d.value.mode){case"create":return B();case"update":return D();case"pay":return N();default:C.error("Método desconhecido. Informar o Técnico.")}};return(s,o)=>(n(),i(M,null,[l(r(G),{title:u.page.name},null,8,["title"]),l(Q,{page:u.page,page_options:u.page_options},{header:V(()=>[e("h2",ae,[b(c(u.page.name)+" ",1),s.$page.props.auth.user.hierarchy<2?(n(),i("span",re,"| "+c(r(p)(A.value)),1)):k("",!0),s.$page.props.auth.user.hierarchy<2?(n(),i("span",ne,[b(" | "+c(r(p)(T.value))+" ",1),ie])):k("",!0)]),l(Y,{icon:"plus",onClick:o[0]||(o[0]=t=>y("create")),title:"Cadastrar Payment",class:"print:hidden"})]),default:V(()=>[e("div",le,[e("div",ce,[e("div",de,[e("div",pe,[l(r(te),{class:"w-5 y-5"}),L(e("input",{type:"text",name:"search_term",id:"search_term",autocomplete:"on",class:"simple-input",autofocus:"true",placeholder:"Pesquisar termo...","onUpdate:modelValue":o[1]||(o[1]=t=>x.value=t)},null,512),[[X,x.value]])]),e("div",ue,[L(e("input",{type:"checkbox",id:"show-services",class:"focus:ring-green-700 text-green-700 border-neutral-500 rounded-sm disabled:opacity-50","onUpdate:modelValue":o[2]||(o[2]=t=>h.value=t),checked:h.value},null,8,me),[[Z,h.value]]),_e])])])]),e("div",he,[e("div",ve,[e("div",xe,[e("div",ye,[e("div",ge,[e("div",we,[e("div",fe,[e("div",be,[e("table",ke,[Ce,e("tbody",null,[$.value.length?(n(!0),i(M,{key:0},H($.value,t=>(n(),i("tr",{class:J(["border-b transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid",{hidden:t.type===1&&h.value===!1}])},[e("td",$e,c(t.id),1),e("td",Pe,[b(c(t.motive)+" ",1),t.observations?(n(),i("span",{key:0,title:t.observations,class:"inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10 cursor-help"},"OBS",8,Se)):k("",!0)]),e("td",Ee,c(t.entity_name),1),e("td",Ve,c(r(p)(t.accounting.partial_value)),1),e("td",Le,c(r(p)(t.accounting.total_value)),1),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-green-700 active:text-green-900 select-none print:hidden",title:"PAGAR: "+t.motive+"("+t.entity_name+")",onClick:m=>y("pay",t.id)},[l(r(K),{class:"w-5 h-5 m-auto"})],8,Me),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-yellow-700 active:text-yellow-900 select-none print:hidden",title:"EDITAR: "+t.motive+"("+t.entity_name+")",onClick:m=>y("update",t.id)},[l(r(se),{class:"w-5 h-5 m-auto"})],8,Te),t.type!==2?(n(),i("td",{key:0,class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-red-700 active:text-red-900 select-none print:hidden",title:"EXCLUIR: "+t.motive+"("+t.entity_name+")",onClick:m=>z(t.id,t.motive)},[l(r(oe),{class:"w-5 h-5 m-auto"})],8,Ae)):(n(),i("td",Be," Venda "))],2))),256)):(n(),i("tr",De,ze))])])])])])])])])])]),l(W,{show:d.value.show,modal:d.value,payment:r(a),onSubmit:O,onClose:v},null,8,["show","modal","payment"]),l(ee,{mode:["rollup","print_page","link"],link_type:["previous"],link:[s.route("payments.previous")]},null,8,["link"])]),_:1},8,["page","page_options"])],64))}};export{Ye as default};
