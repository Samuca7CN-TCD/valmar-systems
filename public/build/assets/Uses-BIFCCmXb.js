import{d as A,l as $,o as n,c as V,w as k,a as e,n as M,u as _,h as p,f as L,t as d,i as P,e as i,F as j,g as O,q as S,s as X,v as E,b as w,T as Z,Z as G}from"./app-wIlip3pR.js";import{_ as H}from"./AppLayout-BbWcPMzy.js";import{r as J,_ as K,a as Y}from"./CreateUpdateModal-Bn2Rq6uk.js";import{_ as ee}from"./PrimaryButton-CFA6HZtj.js";import{_ as te}from"./SecondaryButton-B18wpBTD.js";import{e as R,t as z}from"./general-B4ZTqOfr.js";import{r as se,_ as oe}from"./FloatButton-Cl9FbEB0.js";import{r as ae}from"./BanknotesIcon-BW4l_CJL.js";import{r as Q}from"./EyeIcon-DKKhZS4j.js";import{r as ne}from"./MagnifyingGlassIcon-Ct-Qocut.js";import"./Modal-DEJQdgPt.js";import"./PrinterIcon-Bt7yR5Wr.js";const le={class:"pb-12 space-y-12 divide-y-2"},ie={class:"py-4"},re=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Informações Básicas",-1),de=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Informações sobre a uso como nome do funcionário, data da uso e observações",-1),ue={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"},ce={class:"sm:col-span-3"},me=e("label",{for:"use-employee",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Responsável",-1),pe={key:0,class:"mt-2"},ye=["value","disabled"],_e=e("option",{value:null,disabled:"",selected:""},"Escolha um funcionário",-1),he=["value"],ve={key:0,class:"text-red-500 text-sm"},xe={key:1,class:"mt-2"},fe=["value","disabled"],be={key:0,class:"text-red-500 text-sm"},ge={class:"flex flex-row align-middle items-center space-x-2 mt-2"},we=["disabled"],ke=e("label",{for:"switch_entity_type",class:"text-sm text-neutral-500 select-none"}," Funcionário?",-1),qe={class:"sm:col-span-3"},$e=e("label",{for:"use-date",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Data do Uso",-1),Ce={class:"mt-2"},Ue=["max","disabled"],Ie={key:0,class:"text-red-500 text-sm"},Ve={class:"sm:col-span-6"},Me=e("label",{for:"use-motive",class:"block text-sm font-medium leading-6 text-gray-900 required-input-label"},"Motivo",-1),Se={class:"mt-2"},De=["disabled"],Le={key:0,class:"text-red-500 text-sm"},Ee={class:"sm:col-span-6"},Ae=e("label",{for:"use-observations",class:"block text-sm font-medium leading-6 text-gray-900"},"Observações",-1),je={class:"mt-2"},Fe=["disabled"],Ne={key:0,class:"text-red-500 text-sm"},Oe={key:0,class:"py-4"},Te=e("h2",{class:"text-base font-semibold leading-7 text-gray-900"},"Lista de Itens",-1),Be=e("p",{class:"mt-1 text-sm leading-6 text-gray-600"},"Adicione os itens do uso.",-1),Re={class:"mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-4"},ze={class:"sm:col-span-4"},Qe={class:"relative"},We=e("label",{for:"item-selecter",class:"block text-sm font-medium leading-6 text-gray-900"},"Selecione os itens de uso",-1),Pe=["disabled"],Xe={key:0,class:"absolute z-10 w-full mx-auto sm:w-96 bg-white border rounded mt-2 h-96 overflow-y-scroll"},Ze=["onMousedown"],Ge={class:"sm:col-span-4"},He={key:0,class:"min-w-full text-left text-sm font-medium leading-6 text-gray-900"},Je={class:"border-b font-medium dark:border-neutral-500"},Ke=e("th",{scope:"col",class:"px-6 py-4 text-center"},"#",-1),Ye=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Item",-1),et=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Qtd. Estoque",-1),tt=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Qtd. Uso",-1),st=e("th",{scope:"col",class:"px-6 py-4 text-center"},"Und. Medida",-1),ot={key:0,scope:"col",class:"px-6 py-4 text-center"},at={class:"whitespace-nowrap py-4 text-center font-medium"},nt={class:"whitespace-nowrap py-4 text-center font-medium"},lt={class:"whitespace-nowrap py-4 text-center font-medium flex justify-center"},it=["value","onInput","disabled"],rt={class:"whitespace-nowrap py-4 text-center font-medium"},dt={key:0,class:"whitespace-nowrap py-4 text-center font-mono text-2xl"},ut=["onClick","title"],ct={key:1,class:"p-5 bg-gray-200 rounded-md block text-sm font-medium leading-6 text-gray-900"},mt={__name:"CreateUpdateUsesModal",props:{modal:Object,use:{type:Object,default:null},items:Array,employees_list:Array},emits:["close","submit"],setup(s,{emit:D}){const u=D,l=s,b=A(!0),T=/^\d{4}-\d{2}-\d{2}$/,x=$(()=>{const{motive:a,employee_id:o,employee:t,date:v}=l.use;if(b.value){if(!o)return!1}else if(!t)return!1;return!a||!a.length?!1:v&&T.test(v)}),C=$(()=>{const{items_list:a}=l.use;return!x||!a.length?!1:a.every(t=>t.movement_quantity>0&&t.movement_quantity<=t.quantity)}),y=$(()=>l.modal.mode==="see"),F=$(()=>l.modal.mode==="see"),N=a=>{if(b.value){const o=l.employees_list.find(t=>t.id===parseInt(a));if(!o){alert("Funcionário não encontrado!");return}l.use.employee_id=a,l.use.employee=o.name+" "+o.surname}else l.use.employee_id=null,l.use.employee_name=a},B=()=>{l.use.employee_id=null,l.use.employee=""},U=A(""),c=A(!1),m=$(()=>l.items.filter(a=>a.name.toLowerCase().includes(U.value.toLowerCase())&&!l.use.items_list.some(o=>o.id===a.id))),r=a=>{a==="in"&&(c.value=!0),a==="out"&&(c.value=!1)},h=()=>{l.use.estimated_value=l.use.items_list.reduce((a,o)=>a+o.price*o.movement_quantity,0),l.use.total_value=l.use.estimated_value},f=a=>{l.use.items_list.push({id:a.id,name:a.name,quantity:a.quantity,max_quantity:a.max_quantity,min_quantity:a.min_quantity,movement_quantity:1,measurement_unit:a.measurement_unit.abbreviation,price:a.price,amount:a.price}),U.value="",c.value=!1,h()},q=a=>{l.use.items_list=l.use.items_list.filter(o=>o.id!==a),h()},g=()=>{u("close")},I=()=>{u("submit")};return(a,o)=>(n(),V(K,{show:s.modal.show,maxWidth:x.value||F.value?"3xl":"2xl",onClose:g},{icon:k(()=>[e("div",{class:M(["mx-auto shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-400 sm:mx-0 sm:h-10 sm:w-10",{"bg-yellow-400":s.modal.mode==="update","bg-green-400":s.modal.mode==="pay","bg-gray-400":s.modal.mode==="see"}])},[s.modal.mode==="create"?(n(),V(_(se),{key:0,class:"w-5 h-5 text-white"})):p("",!0),s.modal.mode==="update"?(n(),V(_(J),{key:1,class:"w-5 h-5 text-white"})):p("",!0),s.modal.mode==="pay"?(n(),V(_(ae),{key:2,class:"w-5 h-5 text-white"})):p("",!0),s.modal.mode==="see"?(n(),V(_(Q),{key:3,class:"w-5 h-5 text-white"})):p("",!0)],2)]),title:k(()=>[L(d(s.modal.title),1)]),content:k(()=>[e("form",{onSubmit:P(I,["prevent"])},[e("div",le,[e("section",ie,[re,de,e("div",ue,[e("div",ce,[me,b.value?(n(),i("div",pe,[e("select",{name:"use-employee",id:"use-employee",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Nome do funcionario",value:s.use.employee_id,onChange:o[0]||(o[0]=t=>N(t.target.value)),required:"",disabled:y.value},[_e,(n(!0),i(j,null,O(s.employees_list,t=>(n(),i("option",{key:t.id,value:t.id},d(t.name)+" "+d(t.surname),9,he))),128))],40,ye),s.use.errors.employee?(n(),i("p",ve,d(s.use.errors.employee),1)):p("",!0)])):(n(),i("div",xe,[e("input",{type:"text",name:"use-entity",id:"use-entity",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Nome do responsável",value:s.use.employee,onInput:o[1]||(o[1]=t=>N(t.target.value)),disabled:y.value,required:""},null,40,fe),s.use.errors.employee?(n(),i("p",be,d(s.use.errors.employee),1)):p("",!0)])),e("span",ge,[S(e("input",{id:"switch_entity_type",type:"checkbox",class:"rounded border-gray-500 text-green-600 shadow-sm focus:border-green-300 focus:ring focus:ring-green-200 focus:ring-opacity-50","onUpdate:modelValue":o[2]||(o[2]=t=>b.value=t),onChange:B,disabled:y.value},null,40,we),[[X,b.value]]),ke])]),e("div",qe,[$e,e("div",Ce,[S(e("input",{type:"date",name:"use-date",id:"use-date",autocomplete:"on",class:"simple-input disabled:bg-gray-200",autofocus:"true",placeholder:"Data do Uso",max:_(R)(),"onUpdate:modelValue":o[3]||(o[3]=t=>s.use.date=t),disabled:y.value,required:""},null,8,Ue),[[E,s.use.date]]),s.use.errors.date?(n(),i("p",Ie,d(s.use.errors.date),1)):p("",!0)])]),e("div",Ve,[Me,e("div",Se,[S(e("input",{type:"text",name:"use-motive",id:"use-motive",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Motivo do Uso","onUpdate:modelValue":o[4]||(o[4]=t=>s.use.motive=t),disabled:y.value,required:""},null,8,De),[[E,s.use.motive]]),s.use.errors.motive?(n(),i("p",Le,d(s.use.errors.motive),1)):p("",!0)])]),e("div",Ee,[Ae,e("div",je,[S(e("textarea",{type:"text",observations:"use-observations",id:"use-observations",autocomplete:"on",class:"simple-input disabled:bg-gray-200",placeholder:"Descreva a título mais detalhadamente ou insira informações adicionais","onUpdate:modelValue":o[5]||(o[5]=t=>s.use.observations=t),disabled:y.value},null,8,Fe),[[E,s.use.observations]]),s.use.errors.observations?(n(),i("p",Ne,d(s.use.errors.observations),1)):p("",!0)])])])]),x.value||F.value?(n(),i("section",Oe,[Te,Be,e("div",Re,[e("div",ze,[e("div",Qe,[We,S(e("input",{id:"item-selecter","onUpdate:modelValue":o[6]||(o[6]=t=>U.value=t),onFocus:o[7]||(o[7]=t=>r("in")),onBlur:o[8]||(o[8]=t=>r("out")),class:"simple-input disabled:bg-gray-200 px-4 py-2 w-full",placeholder:"Digite para pesquisar",disabled:y.value},null,40,Pe),[[E,U.value]]),c.value?(n(),i("ul",Xe,[(n(!0),i(j,null,O(m.value,(t,v)=>(n(),i("li",{key:v,class:"py-2 px-4 cursor-pointer hover:bg-gray-200",onMousedown:W=>f(t)},[e("span",{class:M(["inline",{"text-blue-500":t.quantity!=0&&t.quantity>=t.max_quantity,"text-green-500":t.quantity<t.max_quantity&&t.quantity>=t.min_quantity,"text-yellow-500":t.quantity<t.min_quantity&&t.quantity>0,"text-red-500":t.quantity==0}])},"("+d(t.quantity)+")",3),L(" "+d(t.name),1)],40,Ze))),128))])):p("",!0)])]),e("div",Ge,[l.use.items_list.length?(n(),i("table",He,[e("thead",Je,[e("tr",null,[Ke,Ye,et,tt,st,s.modal.mode!=="see"?(n(),i("th",ot," Deletar")):p("",!0)])]),e("tbody",null,[(n(!0),i(j,null,O(l.use.items_list,t=>(n(),i("tr",{key:t.id,class:M(["border-b transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid",{"bg-yellow-100":t.movement_quantity==t.quantity,"bg-red-100":t.movement_quantity>t.quantity}])},[e("td",at,d(t.id),1),e("td",nt,d(t.name),1),e("td",{class:M(["whitespace-nowrap py-4 text-center font-medium",{"text-blue-500":t.quantity!=0&&t.quantity>=t.max_quantity,"text-green-500":t.quantity<t.max_quantity&&t.quantity>=t.min_quantity,"text-yellow-500":t.quantity<t.min_quantity&&t.quantity>0,"text-red-500":t.quantity==0}])},d(t.quantity),3),e("td",lt,[e("input",{type:"number",min:"0.01",step:"0.01",value:t.movement_quantity,onInput:v=>{t.movement_quantity=parseFloat(v.target.value),t.amount=t.price*v.target.value,h()},class:"simple-input disabled:bg-gray-200 w-2/3",disabled:y.value},null,40,it)]),e("td",rt,d(t.measurement_unit),1),s.modal.mode!=="see"?(n(),i("td",dt,[e("button",{onClick:v=>q(t.id),title:"Remover "+t.name},"×",8,ut)])):p("",!0)],2))),128))])])):(n(),i("p",ct," Nenhum item selecionado até o momento!"))])])])):p("",!0)])],32)]),footer:k(()=>[s.modal.mode!=="see"?(n(),V(te,{key:0,class:M({disabled:s.use.processing}),onClick:o[9]||(o[9]=t=>g())},{default:k(()=>[L(" Cancelar ")]),_:1},8,["class"])):p("",!0),w(ee,{class:M({disabled:s.use.processing||!C.value}),disabled:s.use.processing||!C.value,onClick:o[10]||(o[10]=t=>s.use.processing||!C.value?t.preventDefault():I())},{default:k(()=>[L(d(s.modal.primary_button_txt),1)]),_:1},8,["class","disabled"])]),_:1},8,["show","maxWidth"]))}},pt={class:"font-semibold text-xl text-gray-800 leading-tight"},yt={class:"pt-12 print:hidden print:pt-0"},_t={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 print:w-full"},ht={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-5"},vt={class:"flex flex-row items-center space-x-3"},xt={class:"py-12 print:py-6"},ft={class:"max-w-7xl mx-auto print:max-w-full"},bt={class:"px-0 print:px-0"},gt={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg print:shadow-none"},wt={class:"flex flex-col"},kt={class:"overflow-x-auto sm:-mx-6 lg:-mx-8"},qt={class:"inline-block min-w-full py-2 sm:px-6 lg:px-8"},$t={class:"overflow-hidden"},Ct={class:"min-w-full text-left text-sm font-light"},Ut=e("thead",{class:"border-b font-medium dark:border-neutral-500"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-4 text-center"},"#"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Funcionário"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Motivo"),e("th",{scope:"col",class:"px-6 py-4 text-center"},"Data do Uso "),e("th",{scope:"col",class:"px-6 py-4 text-center print:hidden",colspan:"2"}," Ações")])],-1),It={class:"border-b transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid"},Vt={class:"whitespace-nowrap py-4 text-center font-medium"},Mt={class:"whitespace-normal px-6 py-4 text-center trim"},St=["title"],Dt={class:"whitespace-nowrap px-2 py-4 text-center"},Lt={class:"whitespace-nowrap px-2 py-4 text-center print:hidden"},Et=["title","onClick"],At=["title","onClick"],jt={key:1,class:"transition duration-300 ease-in-out hover:bg-neutral-100 print:break-inside-avoid"},Ft=e("td",{class:"whitespace-nowrap px-6 py-4 text-center",colspan:"9"},"Não há usos cadastradas no momento!",-1),Nt=[Ft],Jt={__name:"Uses",props:{page:Object,page_options:{type:Array,default:null},uses_list:Object,employees_list:Array,items:Object},setup(s){const D=s,u=Z({id:null,employee:"",employee_id:null,motive:"",date:R(),total_value:0,observations:"",items_list:[]}),l=A(""),b=$(()=>{const c=l.value.toLowerCase();return D.uses_list.filter(m=>{const{id:r,entity_name:h,motive:f,observations:q,date:g,items:I}=m,a=[r.toString(),(h==null?void 0:h.toLowerCase())??"",(f==null?void 0:f.toLowerCase())??"",(q==null?void 0:q.toLowerCase())??"",(g==null?void 0:g.toLowerCase())??""];for(let o of a)if(o.includes(c))return!0;return I.some(o=>o.name.toLowerCase().includes(c))})}),T=$(()=>D.uses_list.reduce((c,m)=>c+m.accounting.partial_value,0)),x=A({mode:"create",show:!1,get title(){switch(this.mode){case"create":return"Criar uso";case"update":return"Editar uso";case"see":return"Ver informações da uso"}},get primary_button_txt(){switch(this.mode){case"create":return"Cadastrar";case"update":return"Atualizar";case"see":return"Fechar"}}}),C=(c,m=null)=>{const r=["update","see"].includes(c);if(m!==null&&r){const h=D.uses_list.find(f=>f.id===m);if(h){const{id:f,entity_name:q,employee_id:g,date:I,motive:a,observations:o,accounting:t,items:v}=h;u.id=f,u.employee=q,u.date=I,u.motive=a,u.estimated_value=t.estimated_value,u.total_value=t.total_value,u.partial_value=t.partial_value,u.observations=o,u.items_list=v,u.employee_id=g}}x.value.mode=c,x.value.show=!0},y=()=>{u.reset(),x.value.show=!1},F=()=>{u.post(route("uses.store"),{preserveScroll:!0,onSuccess:()=>y(),onError:c=>{console.log(c)}})},N=()=>{u.put(route("uses.update",u.id),{preserveScroll:!0,onSuccess:()=>y()})},B=(c,m)=>{confirm(`Você tem certeza que deseja excluir a uso de material para "${m}"? Todos os materiais comprados voltarão para o estoque! Esta ação não poderá ser desfeita!`)&&u.delete(route("uses.destroy",c),{preserveScroll:!0,onSuccess:()=>alert("Uso deletado com sucesso!")})},U=()=>{switch(x.value.mode){case"create":return F();case"update":return N();case"see":return y();default:alert("Método desconhecido. Informar o Técnico.")}};return(c,m)=>(n(),i(j,null,[w(_(G),{title:s.page.name},null,8,["title"]),w(H,{page:s.page,page_options:s.page_options},{header:k(()=>[e("h2",pt,d(s.page.name)+" | "+d(_(z)(T.value)),1),w(oe,{icon:"plus",onClick:m[0]||(m[0]=r=>C("create")),title:"Cadastrar Use",class:"print:hidden"})]),default:k(()=>[e("div",yt,[e("div",_t,[e("div",ht,[e("div",vt,[w(_(ne),{class:"w-5 y-5"}),S(e("input",{type:"text",name:"search_term",id:"search_term",autocomplete:"on",class:"simple-input",autofocus:"true",placeholder:"Pesquisar termo...","onUpdate:modelValue":m[1]||(m[1]=r=>l.value=r)},null,512),[[E,l.value]])])])])]),e("div",xt,[e("div",ft,[e("div",bt,[e("div",gt,[e("div",wt,[e("div",kt,[e("div",qt,[e("div",$t,[e("table",Ct,[Ut,e("tbody",null,[b.value.length?(n(!0),i(j,{key:0},O(b.value,r=>(n(),i("tr",It,[e("td",Vt,d(r.id),1),e("td",Mt,[L(d(r.entity_name)+" ",1),r.observations?(n(),i("span",{key:0,title:r.observations,class:"inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10 cursor-help"},"OBS",8,St)):p("",!0)]),e("td",Dt,d(_(z)(r.motive)),1),e("td",Lt,d(_(R)(r.date,!0)),1),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-indigo-700 active:text-indigo-900 select-none print:hidden",title:"VER: Compra de "+r.entity_name,onClick:h=>C("see",r.id)},[w(_(Q),{class:"w-5 h-5 m-auto"})],8,Et),e("td",{class:"whitespace-nowrap px-4 py-4 text-center cursor-pointer hover:text-red-700 active:text-red-900 select-none print:hidden",title:"EXCLUIR: Compra de "+r.entity_name,onClick:h=>B(r.id,r.entity_name)},[w(_(Y),{class:"w-5 h-5 m-auto"})],8,At)]))),256)):(n(),i("tr",jt,Nt))])])])])])])])])])]),w(mt,{modal:x.value,use:_(u),items:s.items,employees_list:s.employees_list,onSubmit:U,onClose:y},null,8,["modal","use","items","employees_list"])]),_:1},8,["page","page_options"])],64))}};export{Jt as default};
