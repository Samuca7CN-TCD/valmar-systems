import{m as U,d as g,y as J,x as _,T as Z,e as n,o as r,b as c,u as l,Z as G,w as y,a as e,f as u,q as M,v as H,s as K,F as b,h as P,t as a,n as V,j as A,g as C}from"./app-BNfw6D98.js";import{_ as Q}from"./AppLayout-BbGSq7ON.js";import{t as W,f as S}from"./general-NIAW1A15.js";/* empty css                    */import{r as X,_ as Y}from"./BudgetRejectionCancellationModal-ClUnkfxO.js";import{_ as ee}from"./FloatButton-BBwdUlJ9.js";import{r as te}from"./MagnifyingGlassIcon-Dxwqr9sQ.js";import{r as se}from"./EyeIcon-BKGeeMbF.js";import{r as oe,a as ae}from"./XMarkIcon-LoPj41DC.js";import{r as ne}from"./DocumentDuplicateIcon-DYl4LG-6.js";import{r as re,a as ie}from"./ChevronRightIcon-Cx9J8zXx.js";import"./CreateUpdateModal-VUiyNreI.js";import"./Modal-DCOq4Sqz.js";import"./PrimaryButton-D8RA7maK.js";import"./SecondaryButton-DeD2VbFJ.js";import"./PlusIcon-4ob3L-3h.js";import"./PrinterIcon-Ch-Iv2XI.js";const le={class:"font-semibold text-xl text-gray-800 leading-tight"},ce={class:"pt-12 print:hidden print:pt-0"},de={class:"max-w-7xl mx-auto sm:px-6 lg:px-8 print:w-full"},ue={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-5"},pe={class:"flex flex-col sm:flex-row sm:items-center space-y-4 sm:space-y-0 sm:space-x-4"},me={class:"flex items-center space-x-3 flex-grow"},he={class:"flex items-center space-x-2"},_e=e("label",{for:"status_filter",class:"text-sm font-medium text-gray-700 whitespace-nowrap"},"Status:",-1),xe=e("option",{value:""},"Todos",-1),fe=e("option",{value:"Rascunho"},"Rascunho",-1),ve=e("option",{value:"Enviado"},"Enviado",-1),ge=e("option",{value:"Aprovado"},"Aprovado",-1),ye=e("option",{value:"Rejeitado"},"Rejeitado",-1),be=e("option",{value:"Cancelado"},"Cancelado",-1),we=[xe,fe,ve,ge,ye,be],Ce={class:"py-12 print:py-0"},je={class:"max-w-fit mx-auto print:max-w-full"},ke={class:"w-full flex justify-end pb-3 print:hidden px-6 sm:px-0"},$e={class:"px-0 sm:px-0 print:px-0"},Ee={class:"bg-white sm:rounded-xl print:shadow-none"},Te={class:"flex flex-col"},Oe={class:"overflow-x-auto"},Ae={class:"inline-block min-w-full"},Se={class:"overflow-hidden"},Re={class:"max-w-fit text-left text-sm font-light"},ze={class:"border-b bg-gray-50 font-medium"},Ne=e("th",{scope:"col",class:"px-6 py-3 text-center"},"#",-1),Me=e("th",{scope:"col",class:"px-6 py-3 text-left"},"Titulo",-1),Pe=e("th",{scope:"col",class:"px-6 py-3 text-left"},"Cliente",-1),Ve=e("th",{scope:"col",class:"px-6 py-3 text-left"},"Itens",-1),Be=e("th",{scope:"col",class:"px-6 py-3 text-center"},"Valor Total",-1),De=e("th",{scope:"col",class:"px-6 py-3 text-center"},"Data Orçamento",-1),qe=e("th",{scope:"col",class:"px-6 py-3 text-center"},"Status",-1),Ie=e("th",{scope:"col",class:"px-6 py-3 text-center print:hidden"},"Ações ",-1),Fe={key:0,scope:"col",class:"px-6 py-3 text-center print:hidden"},Le={key:1,scope:"col",class:"px-6 py-3 text-center print:hidden"},Ue={key:2,scope:"col",class:"px-6 py-3 text-center print:hidden"},Je={key:3,scope:"col",class:"px-6 py-3 text-center print:hidden"},Ze={class:"whitespace-nowrap px-6 py-4 text-center font-medium"},Ge={class:"whitespace-nowrap px-6 py-4 text-left"},He={class:"whitespace-nowrap px-6 py-4 text-left"},Ke=["title"],Qe={class:"max-w-xs truncate"},We={class:"whitespace-nowrap px-6 py-4 text-center"},Xe={class:"whitespace-nowrap px-6 py-4 text-center"},Ye={class:"whitespace-nowrap px-6 py-4 text-center"},et={class:"whitespace-nowrap px-6 py-4 text-center print:hidden"},tt={class:"flex justify-center items-center space-x-5"},st=["onClick"],ot=["onClick"],at=["onClick"],nt={key:0,class:"whitespace-nowrap px-6 py-4 text-center print:hidden"},rt={key:1,class:"whitespace-nowrap px-6 py-4 text-center print:hidden"},it={key:2,class:"whitespace-nowrap px-6 py-4 text-center print:hidden"},lt={key:3,class:"whitespace-nowrap px-6 py-4 text-center print:hidden"},ct={key:1},dt=e("td",{colspan:"10",class:"whitespace-nowrap px-6 py-4 text-center text-gray-500"}," Nenhum orçamento encontrado. ",-1),ut=[dt],pt={key:0,class:"flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6 mt-6"},mt={class:"flex flex-1 justify-between sm:hidden"},ht=["href","disabled"],_t=["href","disabled"],xt={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},ft={class:"text-sm text-gray-700"},vt={class:"font-medium"},gt={class:"font-medium"},yt={class:"font-medium"},bt={class:"isolate inline-flex -space-x-px rounded-md shadow-xs","aria-label":"Pagination"},wt=["href","disabled"],Ct=e("span",{class:"sr-only"},"Previous",-1),jt=["href","disabled","onClick"],kt={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700 ring-1 ring-gray-300 ring-inset focus:outline-offset-0"},$t=["href","disabled"],Et=e("span",{class:"sr-only"},"Next",-1),Jt={__name:"Index",props:{page:Object,budgets_list:Object,filters:Object},setup(o){const j=o,m=U.useToast(),x=g(j.filters.search||""),f=g(j.filters.status||""),k=g(j.filters.client||"");let $=null;J([x,f,k],()=>{$&&clearTimeout($),$=setTimeout(()=>{_.get(route("budgets.index"),{search:x.value,status:f.value,client:k.value},{preserveState:!0,replace:!0})},300)});const d=g(!1),E=g(!1),p=Z({id:null,rejection_reason:null,cancellation_reason:null,actionType:null}),B=(i,s)=>{p.id=i,p.actionType=s,p.rejection_reason=null,p.cancellation_reason=null,E.value=!0},T=()=>{E.value=!1,p.reset()},D=()=>{p.actionType==="reject"?q(p.id,p.rejection_reason):p.actionType==="cancel"&&I(p.id,p.cancellation_reason)},q=(i,s)=>{if(!s||s.length<10){m.error("O motivo da rejeição deve ter pelo menos 10 caracteres.");return}confirm("Tem certeza que deseja REJEITAR este orçamento?")&&_.post(route("budgets.reject",i),{rejection_reason:s},{preserveScroll:!0,onSuccess:()=>{m.success("Orçamento rejeitado!"),T()},onError:t=>{console.error(t),m.error(t.message||"Erro ao rejeitar orçamento.")}})},I=(i,s)=>{if(!s||s.length<10){m.error("O motivo do cancelamento deve ter pelo menos 10 caracteres.");return}confirm("Tem certeza que deseja CANCELAR este orçamento?")&&_.post(route("budgets.cancel",i),{cancellation_reason:s},{preserveScroll:!0,onSuccess:()=>{m.success("Orçamento cancelado!"),T()},onError:t=>{console.error(t),m.error(t.message||"Erro ao cancelar orçamento.")}})},F=i=>{confirm("Tem certeza que deseja DUPLICAR este orçamento?")&&_.get(route("budgets.create",{duplicate_from:i}))},L=i=>{confirm("Tem certeza que deseja marcar este orçamento como ENVIADO?")&&_.post(route("budgets.send",i),{},{preserveScroll:!0,onSuccess:()=>m.success("Orçamento marcado como enviado!"),onError:s=>{console.error(s),m.error(s.message||"Erro ao marcar como enviado.")}})},v=i=>{i&&_.get(i,{search:x.value,status:f.value,client:k.value},{preserveState:!0,replace:!0})};return(i,s)=>(r(),n(b,null,[c(l(G),{title:o.page.name},null,8,["title"]),c(Q,{page:o.page},{header:y(()=>[e("h2",le,a(o.page.name),1),c(l(A),{href:i.route("budgets.create")},{default:y(()=>[c(ee,{icon:"plus",title:"Cadastrar Orçamento",class:"print:hidden"})]),_:1},8,["href"])]),default:y(()=>[e("div",ce,[e("div",de,[e("div",ue,[e("div",pe,[e("div",me,[c(l(te),{class:"w-4 h-4 text-gray-500"}),M(e("input",{type:"text",name:"search_term",id:"search_term",autocomplete:"on",class:"simple-input flex-grow",autofocus:"true",placeholder:"Pesquisar termo...","onUpdate:modelValue":s[0]||(s[0]=t=>x.value=t)},null,512),[[H,x.value]])]),e("div",he,[_e,M(e("select",{id:"status_filter","onUpdate:modelValue":s[1]||(s[1]=t=>f.value=t),class:"simple-input"},we,512),[[K,f.value]])])])])])]),e("div",Ce,[e("div",je,[e("div",ke,[d.value?u("",!0):(r(),n("button",{key:0,class:"text-blue-500 text-xs",onClick:s[2]||(s[2]=t=>d.value=!d.value)},"Mostrar dados de usuário")),d.value?(r(),n("button",{key:1,class:"text-red-500 text-xs",onClick:s[3]||(s[3]=t=>d.value=!d.value)},"Esconder dados de usuário")):u("",!0)]),e("div",$e,[e("div",Ee,[e("div",Te,[e("div",Oe,[e("div",Ae,[e("div",Se,[e("table",Re,[e("thead",ze,[e("tr",null,[Ne,Me,Pe,Ve,Be,De,qe,Ie,d.value?(r(),n("th",Fe,"Criado Em")):u("",!0),d.value?(r(),n("th",Le,"Criado Por")):u("",!0),d.value?(r(),n("th",Ue,"Modificado Em")):u("",!0),d.value?(r(),n("th",Je,"Modificado Por")):u("",!0)])]),e("tbody",null,[o.budgets_list.data.length?(r(!0),n(b,{key:0},P(o.budgets_list.data,t=>{var w,O,R,z,N;return r(),n("tr",{key:t.id,class:"border-b transition duration-300 ease-in-out hover:bg-neutral-100"},[e("td",Ze,a(t.id),1),e("td",Ge,a(t.title),1),e("td",He,a(t.client_name),1),e("td",{class:"whitespace-nowrap px-6 py-4 text-left",title:t.items.map(h=>h.item_name).join("; ")},[e("div",Qe,a(t.items.map(h=>h.item_name).join("; ")),1)],8,Ke),e("td",We,a(l(W)(t.total_value)),1),e("td",Xe,a(l(S)(t.budget_date,!0)),1),e("td",Ye,[e("span",{class:V(["px-2.5 py-0.5 rounded-full text-xs font-medium",{"bg-gray-100 text-gray-800":t.status==="Rascunho","bg-blue-100 text-blue-800":t.status==="Enviado","bg-green-100 text-green-800":t.status==="Aprovado","bg-orange-100 text-orange-800":t.status==="Rejeitado","bg-red-100 text-red-800":t.status==="Cancelado"}])},a(t.status),3)]),e("td",et,[e("div",tt,[c(l(A),{href:i.route("budgets.show",t.id),class:"hover:text-blue-700",title:"Ver Orçamento"},{default:y(()=>[c(l(se),{class:"w-4 h-4"})]),_:2},1032,["href"]),["Rascunho"].includes(t.status)&&!t.generated_service_id?(r(),n(b,{key:0},[c(l(A),{href:i.route("budgets.edit",t.id),class:"hover:text-yellow-700",title:"Editar Orçamento"},{default:y(()=>[c(l(oe),{class:"w-4 h-4"})]),_:2},1032,["href"]),e("button",{onClick:h=>L(t.id),class:"hover:text-blue-700",title:"Enviar Orçamento"},[c(l(X),{class:"w-4 h-4"})],8,st)],64)):u("",!0),e("button",{onClick:h=>F(t.id),class:"hover:text-purple-700",title:"Duplicar Orçamento"},[c(l(ne),{class:"w-4 h-4"})],8,ot),!["Aprovado","Rejeitado","Cancelado"].includes(t.status)&&i.$page.props.auth.user.hierarchy<2?(r(),n("button",{key:1,onClick:h=>B(t.id,"cancel"),class:"hover:text-red-700",title:"Cancelar Orçamento"},[c(l(ae),{class:"w-4 h-4"})],8,at)):u("",!0)])]),d.value?(r(),n("td",nt,a(l(S)(t.created_at,"reading_date_time")),1)):u("",!0),d.value?(r(),n("td",rt,a(((O=(w=t.procedures[0])==null?void 0:w.user)==null?void 0:O.name)||"-"),1)):u("",!0),d.value?(r(),n("td",it,a(l(S)(t.updated_at,"reading_date_time")),1)):u("",!0),d.value?(r(),n("td",lt,a(((N=(z=t.procedures[((R=t.procedures)==null?void 0:R.length)-1])==null?void 0:z.user)==null?void 0:N.name)||"-"),1)):u("",!0)])}),128)):(r(),n("tr",ct,ut))])])])])])])])])])]),o.budgets_list.links.length>3?(r(),n("div",pt,[e("div",mt,[e("button",{href:o.budgets_list.prev_page_url,disabled:!o.budgets_list.prev_page_url,onClick:s[4]||(s[4]=t=>v(o.budgets_list.prev_page_url)),class:"relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"},"Previous",8,ht),e("button",{href:o.budgets_list.next_page_url,disabled:!o.budgets_list.next_page_url,onClick:s[5]||(s[5]=t=>v(o.budgets_list.next_page_url)),class:"relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"},"Next",8,_t)]),e("div",xt,[e("div",null,[e("p",ft,[C(" Showing "+a(" ")+" "),e("span",vt,a(o.budgets_list.from),1),C(" "+a(" ")+" to "+a(" ")+" "),e("span",gt,a(o.budgets_list.to),1),C(" "+a(" ")+" of "+a(" ")+" "),e("span",yt,a(o.budgets_list.total),1),C(" "+a(" ")+" results ")])]),e("div",null,[e("nav",bt,[e("button",{href:o.budgets_list.prev_page_url,disabled:!o.budgets_list.prev_page_url,onClick:s[6]||(s[6]=t=>v(o.budgets_list.prev_page_url)),class:"relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-gray-300 ring-inset hover:bg-gray-50 focus:z-20 focus:outline-offset-0"},[Ct,c(l(re),{class:"size-5","aria-hidden":"true"})],8,wt),(r(!0),n(b,null,P(o.budgets_list.links,(t,w)=>(r(),n(b,null,[t.url&&!["« Previous","Next »","..."].includes(t.label)?(r(),n("button",{key:w,href:t.url,disabled:!t.url,onClick:O=>v(t.url),"aria-current":"page",class:V(["relative inline-flex items-center px-4 py-2 text-sm font-semibold focus:z-20 focus-visible:outline-2 focus-visible:outline-offset-2",{"z-10 bg-indigo-600 text-white focus-visible:outline-indigo-600":t.active,"text-gray-900 ring-1 ring-gray-300 ring-inset hover:bg-gray-50 focus:outline-offset-0":!t.active}])},a(t.label),11,jt)):!t.url&&t.label==="..."?(r(),n("span",kt,"...")):u("",!0)],64))),256)),e("button",{href:o.budgets_list.next_page_url,disabled:!o.budgets_list.next_page_url,onClick:s[7]||(s[7]=t=>v(o.budgets_list.next_page_url)),class:"relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-gray-300 ring-inset hover:bg-gray-50 focus:z-20 focus:outline-offset-0"},[Et,c(l(ie),{class:"size-5","aria-hidden":"true"})],8,$t)])])])])):u("",!0),c(Y,{show:E.value,budget:l(p),onSubmit:D,onClose:T},null,8,["show","budget"])]),_:1},8,["page"])],64))}};export{Jt as default};
